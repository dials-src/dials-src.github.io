


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>scitbx.array_family.flex &#8212; DIALS  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/dials-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="logoheader container">
  <a href="../../../index.html">
  <img class="logoheader" alt="DIALS" src="../../../_static/dials_header.png" />
  </a>
  </div>
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for scitbx.array_family.flex</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">boost.optional</span> <span class="c1"># import dependency</span>
<span class="kn">import</span> <span class="nn">boost.std_pair</span> <span class="c1"># import dependency</span>
<span class="kn">import</span> <span class="nn">boost.python</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span>
<span class="n">boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">import_ext</span><span class="p">(</span><span class="s2">&quot;scitbx_array_family_flex_ext&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scitbx_array_family_flex_ext</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">scitbx_array_family_flex_ext</span> <span class="k">as</span> <span class="nn">ext</span>

<span class="kn">import</span> <span class="nn">scitbx.stl.map</span> <span class="c1"># import dependency</span>
<span class="kn">import</span> <span class="nn">scitbx.random</span>
<span class="kn">from</span> <span class="nn">scitbx.random</span> <span class="kn">import</span> <span class="n">get_random_seed</span><span class="p">,</span> <span class="n">set_random_seed</span>
<span class="kn">from</span> <span class="nn">libtbx.str_utils</span> <span class="kn">import</span> <span class="n">format_value</span>

<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="k">else</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="c1"># Register extension classes that look like a sequence, ie. have a</span>
<span class="c1"># length and adressable elements, as a Sequence. Same for Iterable.</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">ext</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
  <span class="c1"># Only consider types (=classes), not object instances</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span> <span class="k">continue</span>
  <span class="c1"># The Iterable interface means the type contains retrievable items.</span>
  <span class="c1"># If the type fulfills this but is not already a known Iterable then</span>
  <span class="c1"># register it as such.</span>
  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
    <span class="n">Iterable</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
  <span class="c1"># A Sequence is an Iterable that also has a determinable length.</span>
  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> \
      <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
    <span class="n">Sequence</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bool_md5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">bool</span><span class="o">.</span><span class="n">md5</span> <span class="o">=</span> <span class="n">bool_md5</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">show_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;origin:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;last:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;focus:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;all:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="sorted"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.sorted">[docs]</a><span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
    <span class="n">sort_permutation</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">stable</span><span class="o">=</span><span class="n">stable</span><span class="p">))</span></div>

<span class="k">def</span> <span class="nf">as_scitbx_matrix</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">nd</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">is_0_based</span><span class="p">()</span>
  <span class="k">assert</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_padded</span><span class="p">()</span>
  <span class="kn">import</span> <span class="nn">scitbx.matrix</span>
  <span class="k">return</span> <span class="n">scitbx</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">rec</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="o">.</span><span class="n">focus</span><span class="p">())</span>

<div class="viewcode-block" id="show"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.show">[docs]</a><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">as_scitbx_matrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">mathematica_form</span><span class="p">(</span><span class="n">one_row_per_line</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>

<div class="viewcode-block" id="rows"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.rows">[docs]</a><span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">nd</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">is_0_based</span><span class="p">()</span>
  <span class="k">assert</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">is_padded</span><span class="p">()</span>
  <span class="n">nr</span><span class="p">,</span><span class="n">nc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">focus</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">a</span><span class="p">[</span><span class="n">ir</span><span class="o">*</span><span class="n">nc</span><span class="p">:(</span><span class="n">ir</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nc</span><span class="p">]</span></div>

<span class="k">def</span> <span class="nf">upper_bidiagonal</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
  <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">grid</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
  <span class="k">return</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">lower_bidiagonal</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
  <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">grid</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">):</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
  <span class="k">return</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">export_to</span><span class="p">(</span><span class="n">target_module_name</span><span class="p">):</span>
  <span class="n">export_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;sorted&quot;</span><span class="p">,</span>
    <span class="s2">&quot;show&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rows&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_list&quot;</span><span class="p">,</span>
    <span class="s2">&quot;min_default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;max_default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mean_default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;select&quot;</span><span class="p">,</span>
    <span class="s2">&quot;condense_as_ranges&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_random_seed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_generator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;set_random_seed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_size_t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_double&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_bool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_permutation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_selection&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_double_point_on_sphere&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_double_unit_quaternion&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_double_r3_rotation_matrix&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_double_r3_rotation_matrix_arvo_1992&quot;</span><span class="p">,</span>
    <span class="s2">&quot;random_int_gaussian_distribution&quot;</span><span class="p">,</span>
    <span class="s2">&quot;median&quot;</span><span class="p">,</span>
    <span class="s2">&quot;py_object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;linear_correlation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;histogram&quot;</span><span class="p">,</span>
    <span class="s2">&quot;weighted_histogram&quot;</span><span class="p">,</span>
    <span class="s2">&quot;show_count_stats&quot;</span><span class="p">,</span>
    <span class="s2">&quot;permutation_generator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smart_selection&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compare_derivatives&quot;</span><span class="p">]</span>
  <span class="n">target_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">target_module_name</span><span class="p">]</span>
  <span class="n">g</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">export_list</span><span class="p">:</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">target_module</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>

<div class="viewcode-block" id="to_list"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.to_list">[docs]</a><span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Workaround for C++ exception handling bugs</span>
<span class="sd">     (list(array) involves C++ exceptions)&quot;&quot;&quot;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="min_default"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.min_default">[docs]</a><span class="k">def</span> <span class="nf">min_default</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">default</span>
  <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="max_default"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.max_default">[docs]</a><span class="k">def</span> <span class="nf">max_default</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">default</span>
  <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="mean_default"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.mean_default">[docs]</a><span class="k">def</span> <span class="nf">mean_default</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">default</span>
  <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_format_min</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">format_value</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">min_default</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_format_max</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">format_value</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">max_default</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_format_mean</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">format_value</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">mean_default</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">min_max_mean_double</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.6g</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show_n</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">if</span> <span class="n">show_n</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;n:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">format_value</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;min: &quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;max: &quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;mean:&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_min_max_mean_double_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">min_max_mean_double</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_standard_deviation_helper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
  <span class="n">den</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span>
  <span class="k">if</span> <span class="n">den</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
  <span class="k">return</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

<span class="k">def</span> <span class="nf">_standard_deviation_of_the_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">_standard_deviation_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_sample_standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">_standard_deviation_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">double</span><span class="o">.</span><span class="n">format_min</span> <span class="o">=</span> <span class="n">_format_min</span>
<span class="n">double</span><span class="o">.</span><span class="n">format_max</span> <span class="o">=</span> <span class="n">_format_max</span>
<span class="n">double</span><span class="o">.</span><span class="n">format_mean</span> <span class="o">=</span> <span class="n">_format_mean</span>
<span class="n">double</span><span class="o">.</span><span class="n">min_max_mean</span> <span class="o">=</span> <span class="n">_min_max_mean_double_init</span>
<span class="n">double</span><span class="o">.</span><span class="n">standard_deviation_of_the_sample</span> <span class="o">=</span> <span class="n">_standard_deviation_of_the_sample</span>
<span class="n">double</span><span class="o">.</span><span class="n">sample_standard_deviation</span> <span class="o">=</span> <span class="n">_sample_standard_deviation</span>

<div class="viewcode-block" id="select"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.select">[docs]</a><span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">permutation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">permutation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">permutation</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">):</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="condense_as_ranges"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.condense_as_ranges">[docs]</a><span class="k">def</span> <span class="nf">condense_as_ranges</span><span class="p">(</span><span class="n">integer_array</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">integer_array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="p">[]</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">i_start</span> <span class="o">=</span> <span class="n">integer_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">def</span> <span class="nf">store_range</span><span class="p">():</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i_start</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i_start</span><span class="p">,</span> <span class="n">i_start</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">integer_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">i_start</span> <span class="o">+</span> <span class="n">n</span><span class="p">):</span>
      <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">store_range</span><span class="p">()</span>
      <span class="n">i_start</span> <span class="o">=</span> <span class="n">i</span>
      <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">store_range</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">result</span></div>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">mersenne_twister</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">random_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">population_size</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">sample_size</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">sample_size</span> <span class="o">&lt;=</span> <span class="n">population_size</span>
    <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_permutation</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">population_size</span><span class="p">)</span>
    <span class="n">perm</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>

<span class="n">random_generator</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">mersenne_twister</span><span class="p">(</span><span class="n">scitbx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">mt19937</span><span class="p">)</span>

<div class="viewcode-block" id="set_random_seed"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.set_random_seed">[docs]</a><span class="k">def</span> <span class="nf">set_random_seed</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
  <span class="n">random_generator</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
  <span class="n">scitbx</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<span class="n">random_size_t</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_size_t</span>
<span class="n">random_double</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_double</span>
<span class="n">random_bool</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_bool</span>
<span class="n">random_permutation</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_permutation</span>
<span class="n">random_selection</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_selection</span>
<span class="n">random_double_point_on_sphere</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_double_point_on_sphere</span>
<span class="n">random_double_unit_quaternion</span> <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_double_unit_quaternion</span>
<span class="n">random_double_r3_rotation_matrix</span> \
  <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_double_r3_rotation_matrix</span>
<span class="n">random_double_r3_rotation_matrix_arvo_1992</span> \
  <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_double_r3_rotation_matrix_arvo_1992</span>
<span class="n">random_int_gaussian_distribution</span> \
  <span class="o">=</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">random_int_gaussian_distribution</span>

<span class="n">median</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">median_functor</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">get_random_seed</span><span class="p">())</span>


<div class="viewcode-block" id="py_object"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.py_object">[docs]</a><span class="k">class</span> <span class="nc">py_object</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accessor</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_factory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">value_factory</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span> <span class="o">=</span> <span class="n">accessor</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">value_factory</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">accessor</span><span class="o">.</span><span class="n">size_1d</span><span class="p">())]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">accessor</span><span class="o">.</span><span class="n">size_1d</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">values</span><span class="p">[:]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">accessor</span><span class="o">.</span><span class="n">size_1d</span><span class="p">())]</span>

<div class="viewcode-block" id="py_object.accessor"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.py_object.accessor">[docs]</a>  <span class="k">def</span> <span class="nf">accessor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span></div>

<div class="viewcode-block" id="py_object.data"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.py_object.data">[docs]</a>  <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>

  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span>

  <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_accessor</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span></div>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">linear_regression_core</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">show_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;is_well_defined:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_well_defined</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;y_intercept:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_intercept</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;slope:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">matrix_inversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deep_copy</span><span class="p">()</span>
    <span class="n">result</span><span class="o">.</span><span class="n">matrix_inversion_in_place</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>

  <span class="k">def</span> <span class="nf">as_scitbx_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">as_scitbx_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">linear_correlation</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">show_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;is_well_defined:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_well_defined</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;mean_x:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_x</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;mean_y:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_y</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;coefficient:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficient</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">histogram_slot_info</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low_cutoff</span><span class="p">,</span> <span class="n">high_cutoff</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">low_cutoff</span> <span class="o">=</span> <span class="n">low_cutoff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">high_cutoff</span> <span class="o">=</span> <span class="n">high_cutoff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

  <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high_cutoff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_cutoff</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">histogram</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">__getinitargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data_max</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">slot_width</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n_out_of_slot_range</span><span class="p">())</span>

  <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">libtbx.utils</span> <span class="kn">import</span> <span class="n">kludge_show_to_str</span>
    <span class="k">return</span> <span class="n">kludge_show_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">slot_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">low_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">()):</span>
      <span class="n">high_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_width</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">yield</span> <span class="n">histogram_slot_info</span><span class="p">(</span><span class="n">low_cutoff</span><span class="p">,</span> <span class="n">high_cutoff</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
      <span class="n">low_cutoff</span> <span class="o">=</span> <span class="n">high_cutoff</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">format_cutoffs</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.8g</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_str</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">format_cutoffs</span><span class="o">=</span><span class="n">format_cutoffs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">as_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">format_cutoffs</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.8g</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">format_cutoffs</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">format_cutoffs</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_infos</span><span class="p">():</span>
      <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">low_cutoff</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">high_cutoff</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<div class="viewcode-block" id="show_count_stats"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.show_count_stats">[docs]</a><span class="k">def</span> <span class="nf">show_count_stats</span><span class="p">(</span>
      <span class="n">counts</span><span class="p">,</span>
      <span class="n">group_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
      <span class="n">label_0</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
      <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
      <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
  <span class="k">assert</span> <span class="n">counts</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
  <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">max</span>
  <span class="n">counts_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counts_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">group_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">group_size</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">counts_sorted</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
  <span class="n">wt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">label_0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)))</span>
  <span class="n">wc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
  <span class="n">fmt_val</span>  <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;&gt;= </span><span class="si">%%%d</span><span class="s2">d:  </span><span class="si">%%%d</span><span class="s2">d  </span><span class="si">%%</span><span class="s2">7.5f&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wt</span><span class="p">,</span> <span class="n">wc</span><span class="p">)</span>
  <span class="n">fmt_zero</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;   </span><span class="si">%s</span><span class="s2">:  </span><span class="si">%%%d</span><span class="s2">d  </span><span class="si">%%</span><span class="s2">7.5f&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="s2">&quot;</span><span class="si">%%%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">wt</span><span class="p">)</span> <span class="o">%</span> <span class="n">label_0</span><span class="p">,</span> <span class="n">wc</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">count</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts_sorted</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">):</span> <span class="k">continue</span>
    <span class="k">assert</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">fmt_val</span> <span class="o">%</span> <span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">fmt_zero</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">/</span><span class="n">n</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
      <span class="k">break</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">-</span><span class="n">group_size</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fmt_val</span> <span class="o">%</span> <span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">weighted_histogram_slot_info</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low_cutoff</span><span class="p">,</span> <span class="n">high_cutoff</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">low_cutoff</span> <span class="o">=</span> <span class="n">low_cutoff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">high_cutoff</span> <span class="o">=</span> <span class="n">high_cutoff</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

  <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high_cutoff</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_cutoff</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nd">@boost</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">inject_into</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">weighted_histogram</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">__getinitargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data_max</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">slot_width</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">(),</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n_out_of_slot_range</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">slot_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">low_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">()):</span>
      <span class="n">high_cutoff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_min</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_width</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">yield</span> <span class="n">weighted_histogram_slot_info</span><span class="p">(</span><span class="n">low_cutoff</span><span class="p">,</span> <span class="n">high_cutoff</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
      <span class="n">low_cutoff</span> <span class="o">=</span> <span class="n">high_cutoff</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">format_cutoffs</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.8g</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">format_cutoffs</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">format_cutoffs</span> <span class="o">+</span> <span class="s2">&quot;: </span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_infos</span><span class="p">():</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">low_cutoff</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">high_cutoff</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">n</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<div class="viewcode-block" id="permutation_generator"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.permutation_generator">[docs]</a><span class="k">def</span> <span class="nf">permutation_generator</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">size_t</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
  <span class="k">yield</span> <span class="n">result</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">next_permutation</span><span class="p">()):</span> <span class="k">yield</span> <span class="n">result</span></div>

<div class="viewcode-block" id="smart_selection"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.smart_selection">[docs]</a><span class="k">class</span> <span class="nc">smart_selection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="n">bool_element_size</span> <span class="o">=</span> <span class="nb">bool</span><span class="o">.</span><span class="n">element_size</span><span class="p">()</span>
  <span class="n">size_t_element_size</span> <span class="o">=</span> <span class="n">size_t</span><span class="o">.</span><span class="n">element_size</span><span class="p">()</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Self-consistency of flags, indices, all_size is not checked!&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">flags</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="n">indices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span> <span class="o">=</span> <span class="n">all_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="k">def</span> <span class="nf">_get_all_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span>
  <span class="n">all_size</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_all_size</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_get_selected_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
      <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span>
  <span class="n">selected_size</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_selected_size</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_get_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
  <span class="n">flags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_flags</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span>    <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">iselection</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
  <span class="n">indices</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_indices</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_size</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">all_size</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">all_eq</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="o">.</span><span class="n">all_eq</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

  <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">asz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_size</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">asz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">asz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span><span class="p">)</span>
    <span class="n">ssz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_size</span>
    <span class="k">if</span> <span class="p">(</span>  <span class="n">asz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_element_size</span>
        <span class="o">&lt;</span> <span class="n">ssz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_t_element_size</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">asz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">asz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_size</span> <span class="o">=</span> <span class="n">state</span>

<div class="viewcode-block" id="smart_selection.format_summary"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.smart_selection.format_summary">[docs]</a>  <span class="k">def</span> <span class="nf">format_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">asz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_size</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">asz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
      <span class="n">idc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">idc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;None&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">idc</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">ssz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_size</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ssz</span> <span class="o">==</span> <span class="n">asz</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ssz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;None (empty array)&quot;</span>
      <span class="k">return</span> <span class="s2">&quot;all (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">ssz</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ssz</span><span class="p">,</span> <span class="n">asz</span><span class="p">)</span></div>

<div class="viewcode-block" id="smart_selection.show_summary"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.smart_selection.show_summary">[docs]</a>  <span class="k">def</span> <span class="nf">show_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;selected elements: &quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_summary</span><span class="p">(),</span> <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">__show_sizes</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="n">typename_n_size</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
  <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">max</span>
  <span class="n">l</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span> <span class="nb">len</span><span class="p">(</span><span class="n">typename</span><span class="p">)</span> <span class="k">for</span> <span class="n">typename</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">typename_n_size</span> <span class="p">])</span>
  <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%%%i</span><span class="s2">s : </span><span class="si">%%</span><span class="s2">i&quot;</span> <span class="o">%</span> <span class="n">l</span>
  <span class="k">for</span> <span class="n">typename</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">typename_n_size</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

<span class="n">show_sizes_int</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">__show_sizes</span><span class="p">(</span><span class="n">empty_container_sizes_int</span><span class="p">)</span>
<span class="n">show_sizes_double</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">__show_sizes</span><span class="p">(</span><span class="n">empty_container_sizes_double</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">exercise_triple</span><span class="p">(</span><span class="n">flex_triple</span><span class="p">,</span> <span class="n">flex_order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_double</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">libtbx.test_utils</span> <span class="kn">import</span> <span class="n">approx_equal</span>
  <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">cPickle</span> <span class="k">as</span> <span class="n">pickle</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">flex_triple</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">flex_triple</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">132</span>
  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">flex_triple</span><span class="p">(((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)))</span>
  <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>
  <span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
  <span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">flex_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">flex_order</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">as_double</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">approx_equal</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">as_double</span><span class="p">()),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">flex_triple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">as_double</span><span class="p">())</span>
    <span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<div class="viewcode-block" id="compare_derivatives"><a class="viewcode-back" href="../../../documentation/library_reference/array_family/index.html#dials.array_family.flex.compare_derivatives">[docs]</a><span class="k">def</span> <span class="nf">compare_derivatives</span><span class="p">(</span><span class="n">more_reliable</span><span class="p">,</span> <span class="n">less_reliable</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">max</span>
  <span class="n">scale</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">more_reliable</span><span class="p">)))</span>
  <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">more_reliable</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">all_approx_equal</span><span class="p">(</span> <span class="c1"># fast</span>
             <span class="n">other</span><span class="o">=</span><span class="n">less_reliable</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">eps</span><span class="p">)):</span>
    <span class="kn">from</span> <span class="nn">libtbx.test_utils</span> <span class="kn">import</span> <span class="n">approx_equal</span>
    <span class="k">assert</span> <span class="n">approx_equal</span><span class="p">(</span> <span class="c1"># slow but helpful output</span>
      <span class="n">more_reliable</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span> <span class="n">less_reliable</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">flex_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Support for numpy-style summation along an axis.</span>
<span class="sd">      If axis=None then summation is performed over the entire array.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">ext</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">flex_array</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">flex_array</span><span class="o">.</span><span class="n">nd</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">ext</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">flex_array</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">old_dim</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flex_array</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="k">assert</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_dim</span><span class="p">)</span>
    <span class="n">new_dim</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flex_array</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="n">new_dim</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">flex_array_sum</span> <span class="o">=</span> <span class="n">flex_array</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">grid</span><span class="p">(</span><span class="n">new_dim</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">slices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">old_dim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_dim</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">old_dim</span><span class="p">[</span><span class="n">axis</span><span class="p">]):</span>
      <span class="n">slices</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">flex_array_sum</span> <span class="o">+=</span> <span class="n">flex_array</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">flex_array_sum</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation/tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="https://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../../_static/diamond_logo.png" /></a>
  <a href="https://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../../_static/CCP4-logo-plain.png" /></a>
  <a href="https://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="https://dials.github.io/images/logos/ukri-stfc.png" /></a>
  <a href="http://smb.slac.stanford.edu/"><img class="logofooter" alt="SSRL/SMB" src="https://dials.github.io/images/logos/smbssrl.jpg" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2019, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>