<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>DIALS: Diffraction Integration for Advanced Light Sources</title>
<style type="text/css">

/*
:Copyright: This stylesheet has been placed in the public domain.

Stylesheet for Docutils.
Based on ``voidspace.css`` by Ian Bicking and Michael Foord
*/

@import url(html4css1.css);

body {
  font-family: Arial, sans-serif;
  min-width:660px;
  margin-left:10%;
  margin-right:10%;
}

em, i {
  /* Typically serif fonts have much nicer italics */
  font-family: Times New Roman, Times, serif;
}

a.target {
  color: blue;
}

a.target {
  color: blue;
}

a.toc-backref {
  text-decoration: none;
  color: black;
}

a.toc-backref:hover {
  background-color: inherit;
}

a:hover {
  background-color: #cccccc;
}

div.logoheader {
  background-color: #061679;
  border: medium solid black;
  /* This makes the borders rounded on Mozilla, which pleases me */
  -moz-border-radius: 8px;
}

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning {
  background-color: #cccccc;
  padding: 3px;
  width: 80%;
}

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title  {
  text-align: center;
  background-color: #999999;
  display: block;
  margin: 0;
}

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: #cc0000;
  font-family: sans-serif;
  text-align: center;
  background-color: #999999;
  display: block;
  margin: 0;
}

h1, h2, h3, h4, h5, h6 {
  font-family: Helvetica, Arial, sans-serif;
  border: thin solid black;
  /* This makes the borders rounded on Mozilla, which pleases me */
  -moz-border-radius: 8px;
  padding: 4px;
}

h1 {
  background-color: #061679;
  color: #ffffff;
  border: medium solid black;
}

h1 a.toc-backref, h2 a.toc-backref { 
  color: #ffffff;
}

h2 {
  background-color: #666666;
  color: #ffffff;
  border: medium solid black;
}

h3, h4, h5, h6 {
  background-color: #cccccc;
  color: #000000;
}

h3 a.toc-backref, h4 a.toc-backref, h5 a.toc-backref, 
h6 a.toc-backref { 
  color: #000000;
}

h1.title {
  /* do not display as we use the logoheader instead */
  display: none;
  text-align: center;
  background-color: #061679;
  color: #eeeeee;
  border: thick solid black;
  -moz-border-radius: 20px;
}

table.footnote {
  padding-left: 0.5ex;
}

table.citation {
  padding-left: 0.5ex
}

pre.literal-block, pre.doctest-block {
  border: thin black solid;
  padding: 5px;
}

.image img { border-style : solid;
            border-width : 2px;
}

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100%;
}

code, tt {
  color: #000066;
}

</style>
<link href="images/dials_icon.png" type="image/x-icon" rel="shortcut icon" />
</head>
<body>
<div class="document" id="dials-diffraction-integration-for-advanced-light-sources">
<h1 class="title">DIALS: Diffraction Integration for Advanced Light Sources</h1>

<div class="logoheader container">
<img alt="images/dials_header.png" src="images/dials_header.png" />
</div>
<!-- This is a comment.
This document is reStructuredText. -->
<div class="section" id="setting-up-a-development-environment-on-linux-or-mac">
<h1>Setting up a Development Environment on Linux or Mac</h1>
<p>Prerequisites:  make and change to a working directory to contain the new source code
and build. Then download these bootstrap modules:</p>
<pre class="literal-block">
svn export svn://svn.code.sf.net/p/cctbx/code/trunk/libtbx/auto_build/bootstrap.py
</pre>
<p>Then:</p>
<pre class="literal-block">
python bootstrap.py --builder=dials
</pre>
<p>Explanation:  Several steps are performed: hot, update, base, build.  If desired, they can be run individually at the command line:</p>
<pre class="literal-block">
python bootstrap.py --builder=dials hot
python bootstrap.py --builder=dials update
python bootstrap.py --builder=dials base
python bootstrap.py --builder=dials build
</pre>
<ul class="simple">
<li>&quot;hot&quot; downloads static tarballs containing prerequisite dependencies, to the module directory</li>
<li>&quot;update&quot; anonymously checks out or updates source code for dials and cctbx, to the module directory</li>
<li>&quot;base&quot; downloads and installs python and third party python packages to the base directory</li>
<li>&quot;build&quot; configures and compiles dials and cctbx</li>
</ul>
<p>If you are a developer with an account at cci.lbl.gov you can add --cciuser=&lt;your cci user name&gt;. This will allow you to make commits back to the source tree. Similarly, if you have a source forge account, you can add --sfuser=&lt;your source forge user name&gt;. The DIALS builder pulls code from repositories in both locations.</p>
<p>For subsequent login sessions, be sure to set the environment in order to use the command-line dispatchers:</p>
<pre class="literal-block">
source build/setpaths.sh # or setpaths.csh for tcsh
</pre>
<p>Additional packages can be installed in the modules directory, e.g., download the dials_regression tarball from the main dials web
page. Additional modules may be configured as in this example:</p>
<pre class="literal-block">
libtbx.configure dials_regression
</pre>
</div>
<div class="section" id="restarting-the-base-install-if-one-component-fails">
<h1>Restarting the Base Install if One Component Fails</h1>
<p>It has required quite a bit of experimentation to get the &quot;base&quot; install correct.
Here is a procedure to restart the base install if it dies in the middle, and needs to be
restarted.  First, the top of the base output gives a list of python packages to be installed.
On linux it looks something like this:</p>
<pre class="literal-block">
python numpy hdf5 biopython freetype gettext glib expat fontconfig render pixman png tiff cairo gtk fonts wxpython
matplotlib pyopengl imaging reportlab misc
</pre>
<p>Identify the subset of packages that has failed to install; as an example assume that wxpython and subsequent packages still need to be
installed.  Then run the base installer using the just-installed python as the &quot;with-python&quot; base:</p>
<pre class="literal-block">
python modules/cctbx_project/libtbx/auto_build/install_base_packages.py \
--with-python=`pwd`/base/bin/python wxpython matplotlib pyopengl imaging reportlab misc
</pre>
</div>
<div class="section" id="creating-a-relocatable-installer-bundle-on-linux">
<h1>Creating a Relocatable Installer Bundle on Linux</h1>
<p>Starting with the developer build just created, we can create a tarball suitable for public
distribution.  Caveat is that we build our 64-bit installer on Centos 5.4, so that most conceivable users
will be installing on a more modern OS back-compatible with the installer.</p>
<p>Change to the working directory used above.  Then:</p>
<pre class="literal-block">
./modules/dials/installer/dials_installer.sh
</pre>
<p>..creates an installer called tmp/dials-installer-dev.tar.gz</p>
<p>This can be relocated to a new directory, untarred, then:</p>
<pre class="literal-block">
cd dials-installer-dev
./install -h [prints a help message]
./install --prefix=[absolute path for relocated dials installation]
</pre>
</div>
<div class="section" id="building-using-your-own-custom-python">
<h1>Building Using Your Own Custom Python</h1>
<p>Using your own python to configure and build DIALS requires the dependencies listed above to already be installed and properly configured. Instruct the builder to use your python thusly:</p>
<blockquote>
python bootstrap.py --builder=dials --with-python=&lt;absolute path to your python binary&gt;</blockquote>
<p>This will run the 'hot' and 'update' steps as normal, skip the 'base' step that would normally download and build python and necessary DIALS python dependencies, and finally run the 'build' step with the python you specified. Note that the DIALS team doesn't recommend this procedure, but it can be necessary if using DIALS in concert with other packages.</p>
</div>
</div>
</body>
</html>
