
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation for Developers &mdash; DIALS  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dials-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/dials_icon.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="DIALS  documentation" href="../index.html" />
    <link rel="up" title="Documentation" href="index.html" />
    <link rel="next" title="Library Reference" href="library_reference/index.html" />
    <link rel="prev" title="Conventions" href="conventions.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
  <div class="logoheader container">
  <a href="../index.html">
  <img class="logoheader" alt="DIALS" src="../_static/dials_header.png" />
  </a>
  </div>
  


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation-for-developers">
<h1>Installation for Developers<a class="headerlink" href="#installation-for-developers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-a-development-environment-on-linux-or-mac">
<h2>Setting up a Development Environment on Linux or Mac<a class="headerlink" href="#setting-up-a-development-environment-on-linux-or-mac" title="Permalink to this headline">¶</a></h2>
<p>Prerequisites:  make and change to a working directory to contain the new source code
and build. Then download these bootstrap modules:</p>
<div class="highlight-python"><div class="highlight"><pre>svn export svn://svn.code.sf.net/p/cctbx/code/trunk/libtbx/auto_build/bootstrap.py
</pre></div>
</div>
<p>Then:</p>
<div class="highlight-python"><div class="highlight"><pre>python bootstrap.py --builder=dials
</pre></div>
</div>
<p>Explanation:  Several steps are performed: hot, update, base, build.  If desired, they can be run individually at the command line:</p>
<div class="highlight-python"><div class="highlight"><pre>python bootstrap.py --builder=dials hot
python bootstrap.py --builder=dials update
python bootstrap.py --builder=dials base
python bootstrap.py --builder=dials build
</pre></div>
</div>
<ul class="simple">
<li>&#8220;hot&#8221; downloads static tarballs containing prerequisite dependencies, to the module directory</li>
<li>&#8220;update&#8221; anonymously checks out or updates source code for dials and cctbx, to the module directory</li>
<li>&#8220;base&#8221; downloads and installs python and third party python packages to the base directory</li>
<li>&#8220;build&#8221; configures and compiles dials and cctbx</li>
</ul>
<p>If you are a developer with an account at cci.lbl.gov you can add &#8211;cciuser=&lt;your cci user name&gt;. This will allow you to make commits back to the source tree. Similarly, if you have a source forge account, you can add &#8211;sfuser=&lt;your source forge user name&gt;. The DIALS builder pulls code from repositories in both locations.</p>
<p>For subsequent login sessions, be sure to set the environment in order to use the command-line dispatchers:</p>
<div class="highlight-python"><div class="highlight"><pre>source build/setpaths.sh # or setpaths.csh for tcsh
</pre></div>
</div>
<p>Additional packages can be installed in the modules directory, e.g., download the dials_regression tarball from the main dials web
page. Additional modules may be configured as in this example:</p>
<div class="highlight-python"><div class="highlight"><pre>libtbx.configure dials_regression
</pre></div>
</div>
<div class="section" id="restarting-the-base-install-if-one-component-fails">
<h3>Restarting the Base Install if One Component Fails<a class="headerlink" href="#restarting-the-base-install-if-one-component-fails" title="Permalink to this headline">¶</a></h3>
<p>It has required quite a bit of experimentation to get the &#8220;base&#8221; install correct.
Here is a procedure to restart the base install if it dies in the middle, and needs to be
restarted.  First, the top of the base output gives a list of python packages to be installed.
On linux it looks something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>python numpy hdf5 biopython freetype gettext glib expat fontconfig render pixman png tiff cairo gtk fonts wxpython
matplotlib pyopengl imaging reportlab misc
</pre></div>
</div>
<p>Identify the subset of packages that has failed to install; as an example assume that wxpython and subsequent packages still need to be
installed.  Then run the base installer using the just-installed python as the &#8220;with-python&#8221; base:</p>
<div class="highlight-python"><div class="highlight"><pre>python modules/cctbx_project/libtbx/auto_build/install_base_packages.py \
--with-python=`pwd`/base/bin/python wxpython matplotlib pyopengl imaging reportlab misc
</pre></div>
</div>
</div>
<div class="section" id="creating-a-relocatable-installer-bundle-on-linux">
<h3>Creating a Relocatable Installer Bundle on Linux<a class="headerlink" href="#creating-a-relocatable-installer-bundle-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Starting with the developer build just created, we can create a tarball suitable for public
distribution.  Caveat is that we build our 64-bit installer on Centos 5.4, so that most conceivable users
will be installing on a more modern OS back-compatible with the installer.</p>
<p>Change to the working directory used above.  Then:</p>
<div class="highlight-python"><div class="highlight"><pre>./modules/dials/installer/dials_installer.sh
</pre></div>
</div>
<p>..creates an installer called tmp/dials-installer-dev.tar.gz</p>
<p>This can be relocated to a new directory, untarred, then:</p>
<div class="highlight-python"><div class="highlight"><pre>cd dials-installer-dev
./install -h [prints a help message]
./install --prefix=[absolute path for relocated dials installation]
</pre></div>
</div>
</div>
<div class="section" id="building-using-your-own-custom-python">
<h3>Building Using Your Own Custom Python<a class="headerlink" href="#building-using-your-own-custom-python" title="Permalink to this headline">¶</a></h3>
<p>Using your own python to configure and build DIALS requires the dependencies listed above to already be installed and properly configured. Instruct the builder to use your python thusly:</p>
<blockquote>
<div>python bootstrap.py &#8211;builder=dials &#8211;with-python=&lt;absolute path to your python binary&gt;</div></blockquote>
<p>This will run the &#8216;hot&#8217; and &#8216;update&#8217; steps as normal, skip the &#8216;base&#8217; step that would normally download and build python and necessary DIALS python dependencies, and finally run the &#8216;build&#8217; step with the python you specified. Note that the DIALS team doesn&#8217;t recommend this procedure, but it can be necessary if using DIALS in concert with other packages.</p>
</div>
</div>
<div class="section" id="installing-dials-from-svn-on-windows">
<span id="build-dials-windows"></span><h2>Installing DIALS from SVN on Windows<a class="headerlink" href="#installing-dials-from-svn-on-windows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>In order to follow this process, you will need the following programs
installed on your machine:</p>
<blockquote>
<div><ul class="simple">
<li>64bit python (<a class="reference external" href="https://www.python.org/downloads/release/python-278/">https://www.python.org/downloads/release/python-278/</a>)</li>
<li>HDF5 (<a class="reference external" href="http://www.hdfgroup.org/ftp/HDF5/current/bin/windows/hdf5-1.8.14-win64-vs2012-shared.zip">http://www.hdfgroup.org/ftp/HDF5/current/bin/windows/hdf5-1.8.14-win64-vs2012-shared.zip</a>)</li>
<li>A subversion client</li>
</ul>
</div></blockquote>
<p>Before trying to compile anything, you will need to add the path to the hdf5.h
file to the INCLUDE environment variable. If you don&#8217;t have the INCLUDE
enviroment variable, just add it. You will also need a C/C++ compiler (e.g.
visual sudio).</p>
</div>
<div class="section" id="getting-the-cctbx-and-dials-sources">
<h3>Getting the CCTBX and DIALS sources<a class="headerlink" href="#getting-the-cctbx-and-dials-sources" title="Permalink to this headline">¶</a></h3>
<p>To get this started, create a directory to contain the cctbx build.</p>
<div class="highlight-none"><div class="highlight"><pre>mkdir cctbx
cd cctbx
</pre></div>
</div>
<p>Download <a class="reference external" href="http://cci.lbl.gov/cctbx_build/results/current/cctbx_bundle_for_installer.tar.gz">http://cci.lbl.gov/cctbx_build/results/current/cctbx_bundle_for_installer.tar.gz</a>
and unpack into the directory &#8220;cctbxsources&#8221;.</p>
<p>Now checkout the cctbx sources into the &#8220;cctbxsourcescctbx_project&#8221; directory.</p>
<p>In the &#8220;sources&#8221; directory of your cctbx installation, checkout the dials source
in the following way:</p>
<div class="highlight-none"><div class="highlight"><pre>svn checkout https://svn.code.sf.net/p/dials/code/trunk dials
</pre></div>
</div>
<p>This may take some time, but will fetch all the dials source code and deposit in
in a folder called dials within the cctbx source directory.</p>
<p>Now, create a build directory in &#8220;cctbxbuild&#8221;. and configure the cctbx
installation and build the c++ libraries as follows.</p>
<div class="highlight-none"><div class="highlight"><pre>cd ..
mkdir build
cd build
python ..\sources\cctbx_project\libtbx\configure.py dials
setpaths.bat
libtbx.scons
</pre></div>
</div>
<p>Note that the setpaths.bat script needs to be sourced each time you want to build
cctbx or run a cctbx program.</p>
<p>You should now be good to go!</p>
</div>
</div>
<div class="section" id="downloading-the-dials-regression-test-data">
<h2>Downloading the DIALS regression test data<a class="headerlink" href="#downloading-the-dials-regression-test-data" title="Permalink to this headline">¶</a></h2>
<p>To obtain the dials regression test data, needed for some of the dials tests,
you will need access to the CCI server. Checkout the data into the cctbx source
directory and configure as follows, replacing &#8220;USERNAME&#8221; for your username:</p>
<div class="highlight-none"><div class="highlight"><pre>cd ../sources
svn checkout svn+ssh://USERNAME@cci.lbl.gov/dials_regression/trunk dials_regression
libtbx.configure dials_regression
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">DIALS</a></h1>



<p class="blurb">Data Integration for Advanced Light Sources</p>




<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../_static/diamond_logo.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../_static/CCP4-logo-plain.png" /></a>
  <a href="http://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../_static/STFC_logo.png" /></a>
  </div>
  
    <div class="footer">
      &copy;2015, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>