

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installation for Developers &#8212; DIALS  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dials-styles.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Library Reference" href="library_reference/index.html" />
    <link rel="prev" title="Conventions" href="conventions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="logoheader container">
  <a href="../index.html">
  <img class="logoheader" alt="DIALS" src="../_static/dials_header.png" />
  </a>
  </div>
  



  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="installation-for-developers">
<h1>Installation for Developers<a class="headerlink" href="#installation-for-developers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setting-up-a-development-environment-on-linux-or-mac">
<h2>Setting up a Development Environment on Linux or Mac<a class="headerlink" href="#setting-up-a-development-environment-on-linux-or-mac" title="Permalink to this headline">¶</a></h2>
<p>Prerequisites:  make and change to a working directory to contain the new source code
and build. Then download these bootstrap modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cctbx</span><span class="o">/</span><span class="n">cctbx_project</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">libtbx</span><span class="o">/</span><span class="n">auto_build</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>or if wget is not available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cctbx</span><span class="o">/</span><span class="n">cctbx_project</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">libtbx</span><span class="o">/</span><span class="n">auto_build</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span>
</pre></div>
</div>
<p>Explanation:  Several steps are performed: hot, update, base, build.  If desired, they can be run individually at the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span> <span class="n">hot</span>
<span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span> <span class="n">update</span>
<span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span> <span class="n">base</span>
<span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span> <span class="n">build</span>
</pre></div>
</div>
<ul class="simple">
<li>“hot” downloads static tarballs containing prerequisite dependencies, to the module directory</li>
<li>“update” anonymously checks out or updates source code for dials and cctbx, to the module directory</li>
<li>“base” downloads and installs python and third party python packages to the base directory</li>
<li>“build” configures and compiles dials and cctbx</li>
</ul>
<p>The DIALS builder pulls code from repositories in multiple locations. If you are a developer with an account at cci.lbl.gov you can add –cciuser=&lt;your cci user name&gt;. This will allow you to make commits back to the source tree. Similarly, if you have a source forge account, you can add –sfuser=&lt;your source forge user name&gt;. If you have an account at GitHub and have installed a registered SSH key on your machine, you can add –git-ssh.</p>
<p>For subsequent login sessions, be sure to set the environment in order to use the command-line dispatchers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">build</span><span class="o">/</span><span class="n">setpaths</span><span class="o">.</span><span class="n">sh</span> <span class="c1"># or setpaths.csh for tcsh</span>
</pre></div>
</div>
<p>Additional packages can be installed in the modules directory, e.g., download the dials_regression tarball from the main dials web
page. Additional modules may be configured as in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">libtbx</span><span class="o">.</span><span class="n">configure</span> <span class="n">dials_regression</span>
</pre></div>
</div>
<div class="section" id="restarting-the-base-install-if-one-component-fails">
<h3>Restarting the Base Install if One Component Fails<a class="headerlink" href="#restarting-the-base-install-if-one-component-fails" title="Permalink to this headline">¶</a></h3>
<p>It has required quite a bit of experimentation to get the “base” install correct.
Here is a procedure to restart the base install if it dies in the middle, and needs to be
restarted.  First, the top of the base output gives a list of python packages to be installed.
On linux it looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">numpy</span> <span class="n">hdf5</span> <span class="n">biopython</span> <span class="n">freetype</span> <span class="n">gettext</span> <span class="n">glib</span> <span class="n">expat</span> <span class="n">fontconfig</span> <span class="n">render</span> <span class="n">pixman</span> <span class="n">png</span> <span class="n">tiff</span> <span class="n">cairo</span> <span class="n">gtk</span> <span class="n">fonts</span> <span class="n">wxpython</span>
<span class="n">matplotlib</span> <span class="n">pyopengl</span> <span class="n">imaging</span> <span class="n">reportlab</span> <span class="n">misc</span>
</pre></div>
</div>
<p>Identify the subset of packages that has failed to install; as an example assume that wxpython and subsequent packages still need to be
installed.  Then run the base installer using the just-installed python as the “with-python” base:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python modules/cctbx_project/libtbx/auto_build/install_base_packages.py \
--with-python=`pwd`/base/bin/python wxpython matplotlib pyopengl imaging reportlab misc
</pre></div>
</div>
</div>
<div class="section" id="creating-a-relocatable-installer-bundle-on-linux">
<h3>Creating a Relocatable Installer Bundle on Linux<a class="headerlink" href="#creating-a-relocatable-installer-bundle-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Starting with the developer build just created, we can create a tarball suitable for public
distribution.  Caveat is that we build our 64-bit installer on Centos 5.4, so that most conceivable users
will be installing on a more modern OS back-compatible with the installer.</p>
<p>Change to the working directory used above.  Then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">modules</span><span class="o">/</span><span class="n">dials</span><span class="o">/</span><span class="n">installer</span><span class="o">/</span><span class="n">dials_installer</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>..creates an installer called tmp/dials-installer-dev.tar.gz</p>
<p>This can be relocated to a new directory, untarred, then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">dials</span><span class="o">-</span><span class="n">installer</span><span class="o">-</span><span class="n">dev</span>
<span class="o">./</span><span class="n">install</span> <span class="o">-</span><span class="n">h</span> <span class="p">[</span><span class="n">prints</span> <span class="n">a</span> <span class="n">help</span> <span class="n">message</span><span class="p">]</span>
<span class="o">./</span><span class="n">install</span> <span class="o">--</span><span class="n">prefix</span><span class="o">=</span><span class="p">[</span><span class="n">absolute</span> <span class="n">path</span> <span class="k">for</span> <span class="n">relocated</span> <span class="n">dials</span> <span class="n">installation</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="building-using-your-own-custom-python">
<h3>Building Using Your Own Custom Python<a class="headerlink" href="#building-using-your-own-custom-python" title="Permalink to this headline">¶</a></h3>
<p>Using your own python to configure and build DIALS requires the dependencies listed above to already be installed and properly configured. Instruct the builder to use your python thusly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">builder</span><span class="o">=</span><span class="n">dials</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">python</span><span class="o">=&lt;</span><span class="n">absolute</span> <span class="n">path</span> <span class="n">to</span> <span class="n">your</span> <span class="n">python</span> <span class="n">binary</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This will run the ‘hot’ and ‘update’ steps as normal, skip the ‘base’ step that would normally download and build python and necessary DIALS python dependencies, and finally run the ‘build’ step with the python you specified. Note that the DIALS team doesn’t recommend this procedure, but it can be necessary if using DIALS in concert with other packages.</p>
</div>
</div>
<div class="section" id="installing-dials-from-svn-on-windows">
<span id="build-dials-windows"></span><h2>Installing DIALS from SVN on Windows<a class="headerlink" href="#installing-dials-from-svn-on-windows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>In order to follow this process, you will need the following programs
installed on your machine:</p>
<blockquote>
<div><ul class="simple">
<li>64bit python (<a class="reference external" href="https://www.python.org/downloads/release/python-278/">https://www.python.org/downloads/release/python-278/</a>)</li>
<li>HDF5 (<a class="reference external" href="http://www.hdfgroup.org/ftp/HDF5/current/bin/windows/hdf5-1.8.14-win64-vs2012-shared.zip">http://www.hdfgroup.org/ftp/HDF5/current/bin/windows/hdf5-1.8.14-win64-vs2012-shared.zip</a>)</li>
<li>A subversion client</li>
</ul>
</div></blockquote>
<p>Before trying to compile anything, you will need to add the path to the hdf5.h
file to the INCLUDE environment variable. If you don’t have the INCLUDE
enviroment variable, just add it. You will also need a C/C++ compiler (e.g.
visual sudio).</p>
</div>
<div class="section" id="getting-the-cctbx-and-dials-sources">
<h3>Getting the CCTBX and DIALS sources<a class="headerlink" href="#getting-the-cctbx-and-dials-sources" title="Permalink to this headline">¶</a></h3>
<p>To get this started, create a directory to contain the cctbx build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">cctbx</span>
<span class="n">cd</span> <span class="n">cctbx</span>
</pre></div>
</div>
<p>Download <a class="reference external" href="http://cci.lbl.gov/cctbx_build/results/current/cctbx_bundle_for_installer.tar.gz">http://cci.lbl.gov/cctbx_build/results/current/cctbx_bundle_for_installer.tar.gz</a>
and unpack into the directory <code class="docutils literal notranslate"><span class="pre">cctbx\modules</span></code>.</p>
<p>Now checkout the cctbx sources into the <code class="docutils literal notranslate"><span class="pre">cctbx\modules\cctbx_project</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">modules</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cctbx</span><span class="o">/</span><span class="n">cctbx_project</span><span class="o">.</span><span class="n">git</span> <span class="n">cctbx_project</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">modules</span></code> directory of your cctbx installation, checkout the dials source
in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">dials</span><span class="o">/</span><span class="n">dials</span><span class="o">.</span><span class="n">git</span> <span class="n">dials</span>
</pre></div>
</div>
<p>This may take some time, but will fetch all the dials source code and deposit in
in a folder called dials within the cctbx source directory.</p>
<p>Now, create a build directory in <code class="docutils literal notranslate"><span class="pre">cctbx\build</span></code>. and configure the cctbx
installation and build the c++ libraries as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">..</span>
<span class="n">mkdir</span> <span class="n">build</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">python</span> <span class="o">..</span>\<span class="n">modules</span>\<span class="n">cctbx_project</span>\<span class="n">libtbx</span>\<span class="n">configure</span><span class="o">.</span><span class="n">py</span> <span class="n">dials</span>
<span class="n">setpaths</span><span class="o">.</span><span class="n">bat</span>
<span class="n">libtbx</span><span class="o">.</span><span class="n">scons</span>
</pre></div>
</div>
<p>Note that the setpaths.bat script needs to be sourced each time you want to build
cctbx or run a cctbx program.</p>
<p>You should now be good to go!</p>
</div>
</div>
<div class="section" id="downloading-the-dials-regression-test-data">
<h2>Downloading the DIALS regression test data<a class="headerlink" href="#downloading-the-dials-regression-test-data" title="Permalink to this headline">¶</a></h2>
<p>The DIALS regression test data, needed for some of the DIALS tests, can be
obtained <a class="reference external" href="http://dials.diamond.ac.uk/developers/dials_regression.tgz">here</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">modules</span>
<span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">dials</span><span class="o">.</span><span class="n">diamond</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="o">/</span><span class="n">developers</span><span class="o">/</span><span class="n">dials_regression</span><span class="o">.</span><span class="n">tgz</span> <span class="o">&gt;</span> <span class="n">dials_regression</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xzvf</span> <span class="n">dials_regression</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">libtbx</span><span class="o">.</span><span class="n">configure</span> <span class="n">dials_regression</span>
</pre></div>
</div>
<p>For those with svn access to the CCI server, it can also be obtained as
follows. Checkout the data into the cctbx source
directory and configure as follows, replacing “USERNAME” for your username:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">modules</span>
<span class="n">svn</span> <span class="n">checkout</span> <span class="n">svn</span><span class="o">+</span><span class="n">ssh</span><span class="p">:</span><span class="o">//</span><span class="n">USERNAME</span><span class="nd">@cci</span><span class="o">.</span><span class="n">lbl</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">dials_regression</span><span class="o">/</span><span class="n">trunk</span> <span class="n">dials_regression</span>
<span class="n">libtbx</span><span class="o">.</span><span class="n">configure</span> <span class="n">dials_regression</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../_static/diamond_logo.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../_static/CCP4-logo-plain.png" /></a>
  <a href="http://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2018, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>