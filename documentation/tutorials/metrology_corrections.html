
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Refining multi-tile detector metrology with DIALS &mdash; DIALS  documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/dials-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/dials_icon.png"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="DIALS  documentation" href="../../index.html" />
    <link rel="up" title="Tutorials" href="index.html" />
    <link rel="next" title="Developer Tutorial" href="developer_tutorial.html" />
    <link rel="prev" title="Multi-lattice Tutorial" href="multi_lattice_tutorial.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="logoheader container">
  <a href="../../index.html">
  <img class="logoheader" alt="DIALS" src="../../_static/dials_header.png" />
  </a>
  </div>
  


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="refining-multi-tile-detector-metrology-with-dials">
<h1>Refining multi-tile detector metrology with DIALS<a class="headerlink" href="#refining-multi-tile-detector-metrology-with-dials" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This tutorial is out of date! Default parameters and output have changed.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>At the end of the <a class="reference internal" href="processing_in_detail_tutorial.html"><span class="doc">Processing in Detail</span></a>, we showed plots from
<strong class="program">dials.analyse_output</strong>, including images of the positional
residuals as a function of position on the detector face. There were
clearly some systematic effects, suggesting whole-tile shifts or rotations.
Generally, these are small (typically much less than the pixel size) and are
expected. DECTRIS provides calibration tables from factory metrology
experiments, which XDS can use. Currently we are not applying the correction
tables to reflection positions in DIALS. In some situations we may have to work
with a much less well calibrated or characterised detector than the Pilatus
instruments installed at Diamond. Nevertheless, the multi-panel detector models
in DIALS allow us to <em>discover</em> the appropriate corrections assuming we have
good diffraction data to refine against.</p>
<p>Here we have access to a thaumatin dataset collected with low dose to avoid
radiation damage and with the detector 400 mm from the sample to ensure the
coverage of reflections extends right out towards the corners of the images.</p>
</div>
<div class="section" id="preparing-for-multi-tile-refinement">
<h2>Preparing for multi-tile refinement<a class="headerlink" href="#preparing-for-multi-tile-refinement" title="Permalink to this headline">¶</a></h2>
<p>Usually multi-panel detectors like the Pilatus P6M are treated as if they were
single panels (with dead regions) in DIALS. Clearly, if we are to make corrections
to the relative positions and orientations of the panels, we need a more
detailed detector model in which the panels are treated separately. Currently
there isn&#8217;t really a neat way to switch between the single and multiple panel
models, but until we have a native mechanism for doing this in DIALS there is
a hidden workaround that does this. We just need to set an environment variable:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">export</span> <span class="n">P6M_60_PANEL</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>With that in place, we start as usual by importing the dataset:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="kn">import</span> <span class="nn">Thaum_M10S15_3_</span><span class="o">*.</span><span class="n">cbf</span>
</pre></div>
</div>
<p>The fact that the multiple panel detector model was used is clear from the
output of:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">show</span> <span class="n">datablock</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>We can now inspect images from the dataset with:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">image_viewer</span> <span class="n">datablock</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>However, the dataset is at such low dose that it can be difficult to find the
spots. It might be helpful to us a more mature image viewer such as ADXV or
Albula for this.</p>
<p>We have to run spot finding throughout the dataset. It is a 360 degree sweep
so this will take a few minutes. We can use more processes to move a little
quicker:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">find_spots</span> <span class="n">datablock</span><span class="o">.</span><span class="n">json</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">8</span> <span class="n">min_spot_size</span><span class="o">=</span><span class="mi">3</span>
</pre></div>
</div>
<p>Here we chose to set <code class="docutils literal"><span class="pre">min_spot_size=3</span></code>, which overrides the default of 6 used
for this detector model. We did this because otherwise this weakly diffracting
dataset produces rather few strong spots, whereas we want as much coverage as
we can get, right out to the corners</p>
<p>Now to index the data. Although it is a well-diffracting crystal, running indexing
with defaults finds an approximate supercell with the <em>a</em> and <em>b</em> lengths slightly
more than doubled. Inspection of the found spots with <strong class="program">dials.reciprocal_lattice_viewer</strong>
shows curved lines of spots rather than a regular grid, indicating a poor starting
model. There are plenty of things that can be done to get indexing to find the
correct cell here. If you have time you might like to try a few options out.
However, if not, we won&#8217;t worry too much about it, because if we pass
in the known unit cell for thaumatin then it works just fine. We
also chose to apply tetragonal symmetry immediately:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">index</span> <span class="n">datablock</span><span class="o">.</span><span class="n">json</span> <span class="n">strong</span><span class="o">.</span><span class="n">pickle</span> <span class="n">space_group</span><span class="o">=</span><span class="s">&quot;P 4&quot;</span> <span class="n">unit_cell</span><span class="o">=</span><span class="s">&quot;58 58 150 90 90 90&quot;</span>
</pre></div>
</div>
<p>The output of refinement in the highest resolution macrocycle is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c">################################################################################</span>
<span class="n">Starting</span> <span class="n">refinement</span> <span class="p">(</span><span class="n">macro</span><span class="o">-</span><span class="n">cycle</span> <span class="mi">5</span><span class="p">)</span>
<span class="c">################################################################################</span>


  <span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
  <span class="o">--------------------------------------------------------------------------</span>
  <span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>     <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>        <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>    <span class="o">|</span>
  <span class="o">--------------------------------------------------------------------------</span>
  <span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">2.492</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.04261</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.0004832</span> <span class="o">|</span> <span class="mf">0.0424</span>  <span class="o">|</span> <span class="mf">2.131</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">1.697</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.03481</span> <span class="o">|</span> <span class="mf">0.001733</span>   <span class="o">|</span> <span class="mf">0.03682</span> <span class="o">|</span> <span class="mf">1.656</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.9645</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.06454</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.0007655</span> <span class="o">|</span> <span class="mf">0.06379</span> <span class="o">|</span> <span class="mf">0.8353</span> <span class="o">|</span>
  <span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">80.55</span>   <span class="o">|</span> <span class="mf">127.8</span>    <span class="o">|</span> <span class="mf">131.8</span>      <span class="o">|</span> <span class="mf">133.9</span>   <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">77.02</span>   <span class="o">|</span> <span class="mf">127.6</span>    <span class="o">|</span> <span class="mf">131.8</span>      <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">26.58</span>   <span class="o">|</span> <span class="mf">32.59</span>    <span class="o">|</span> <span class="mf">32.65</span>      <span class="o">|</span> <span class="mf">32.65</span>   <span class="o">|</span> <span class="mf">32.65</span>  <span class="o">|</span>
  <span class="o">--------------------------------------------------------------------------</span>


  <span class="n">Refinement</span> <span class="n">steps</span><span class="p">:</span>
  <span class="o">-------------------------------------------------</span>
  <span class="o">|</span> <span class="n">Step</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Phi</span> <span class="o">|</span>
  <span class="o">|</span>      <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>    <span class="o">|</span>
  <span class="o">-------------------------------------------------</span>
  <span class="o">|</span> <span class="mi">0</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067273</span> <span class="o">|</span> <span class="mf">0.063827</span> <span class="o">|</span> <span class="mf">0.086195</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067369</span> <span class="o">|</span> <span class="mf">0.063706</span> <span class="o">|</span> <span class="mf">0.086197</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067439</span> <span class="o">|</span> <span class="mf">0.063629</span> <span class="o">|</span> <span class="mf">0.086155</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">3</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067531</span> <span class="o">|</span> <span class="mf">0.063529</span> <span class="o">|</span> <span class="mf">0.086115</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067587</span> <span class="o">|</span> <span class="mf">0.063456</span> <span class="o">|</span> <span class="mf">0.086122</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067607</span> <span class="o">|</span> <span class="mf">0.063419</span> <span class="o">|</span> <span class="mf">0.086155</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">6</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.067617</span> <span class="o">|</span> <span class="mf">0.063401</span> <span class="o">|</span> <span class="mf">0.086176</span> <span class="o">|</span>
  <span class="o">|</span> <span class="mi">7</span>    <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.06762</span>  <span class="o">|</span> <span class="mf">0.063395</span> <span class="o">|</span> <span class="mf">0.086181</span> <span class="o">|</span>
  <span class="o">-------------------------------------------------</span>
  <span class="n">RMSD</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">decreasing</span>

  <span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
  <span class="o">----------------------------------------------</span>
  <span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
  <span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
  <span class="o">----------------------------------------------</span>
  <span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">18025</span> <span class="o">|</span> <span class="mf">0.39314</span> <span class="o">|</span> <span class="mf">0.36858</span> <span class="o">|</span> <span class="mf">0.24623</span>  <span class="o">|</span>
  <span class="o">----------------------------------------------</span>

  <span class="n">RMSDs</span> <span class="n">by</span> <span class="n">panel</span><span class="p">:</span>
  <span class="o">-----------------------------------------------</span>
  <span class="o">|</span> <span class="n">Panel</span> <span class="o">|</span> <span class="n">Nref</span> <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
  <span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
  <span class="o">-----------------------------------------------</span>
  <span class="o">|</span> <span class="mi">0</span>     <span class="o">|</span> <span class="mi">10</span>   <span class="o">|</span> <span class="mf">0.53322</span> <span class="o">|</span> <span class="mf">0.82846</span> <span class="o">|</span> <span class="mf">0.14379</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span> <span class="mi">140</span>  <span class="o">|</span> <span class="mf">0.37822</span> <span class="o">|</span> <span class="mf">0.43153</span> <span class="o">|</span> <span class="mf">0.26887</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span> <span class="mi">297</span>  <span class="o">|</span> <span class="mf">0.41585</span> <span class="o">|</span> <span class="mf">0.40848</span> <span class="o">|</span> <span class="mf">0.26118</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span> <span class="mi">146</span>  <span class="o">|</span> <span class="mf">0.5563</span>  <span class="o">|</span> <span class="mf">0.40867</span> <span class="o">|</span> <span class="mf">0.27493</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">4</span>     <span class="o">|</span> <span class="mi">17</span>   <span class="o">|</span> <span class="mf">0.49115</span> <span class="o">|</span> <span class="mf">0.43483</span> <span class="o">|</span> <span class="mf">0.21656</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">5</span>     <span class="o">|</span> <span class="mi">44</span>   <span class="o">|</span> <span class="mf">0.41713</span> <span class="o">|</span> <span class="mf">0.46071</span> <span class="o">|</span> <span class="mf">0.27804</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">6</span>     <span class="o">|</span> <span class="mi">405</span>  <span class="o">|</span> <span class="mf">0.44932</span> <span class="o">|</span> <span class="mf">0.51832</span> <span class="o">|</span> <span class="mf">0.26569</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">7</span>     <span class="o">|</span> <span class="mi">758</span>  <span class="o">|</span> <span class="mf">0.33153</span> <span class="o">|</span> <span class="mf">0.28766</span> <span class="o">|</span> <span class="mf">0.25461</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">8</span>     <span class="o">|</span> <span class="mi">478</span>  <span class="o">|</span> <span class="mf">0.38555</span> <span class="o">|</span> <span class="mf">0.40525</span> <span class="o">|</span> <span class="mf">0.26244</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">9</span>     <span class="o">|</span> <span class="mi">96</span>   <span class="o">|</span> <span class="mf">0.47338</span> <span class="o">|</span> <span class="mf">0.45054</span> <span class="o">|</span> <span class="mf">0.24652</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">10</span>    <span class="o">|</span> <span class="mi">152</span>  <span class="o">|</span> <span class="mf">0.40191</span> <span class="o">|</span> <span class="mf">0.959</span>   <span class="o">|</span> <span class="mf">0.2976</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">11</span>    <span class="o">|</span> <span class="mi">701</span>  <span class="o">|</span> <span class="mf">0.31004</span> <span class="o">|</span> <span class="mf">0.3035</span>  <span class="o">|</span> <span class="mf">0.24597</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">12</span>    <span class="o">|</span> <span class="mi">1128</span> <span class="o">|</span> <span class="mf">0.37366</span> <span class="o">|</span> <span class="mf">0.24303</span> <span class="o">|</span> <span class="mf">0.24016</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">13</span>    <span class="o">|</span> <span class="mi">802</span>  <span class="o">|</span> <span class="mf">0.33404</span> <span class="o">|</span> <span class="mf">0.32094</span> <span class="o">|</span> <span class="mf">0.24614</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">14</span>    <span class="o">|</span> <span class="mi">201</span>  <span class="o">|</span> <span class="mf">0.50746</span> <span class="o">|</span> <span class="mf">0.47124</span> <span class="o">|</span> <span class="mf">0.27169</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">15</span>    <span class="o">|</span> <span class="mi">231</span>  <span class="o">|</span> <span class="mf">0.40185</span> <span class="o">|</span> <span class="mf">0.56122</span> <span class="o">|</span> <span class="mf">0.3029</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">16</span>    <span class="o">|</span> <span class="mi">745</span>  <span class="o">|</span> <span class="mf">0.21926</span> <span class="o">|</span> <span class="mf">0.30075</span> <span class="o">|</span> <span class="mf">0.21426</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">17</span>    <span class="o">|</span> <span class="mi">831</span>  <span class="o">|</span> <span class="mf">0.17864</span> <span class="o">|</span> <span class="mf">0.17706</span> <span class="o">|</span> <span class="mf">0.2176</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">18</span>    <span class="o">|</span> <span class="mi">778</span>  <span class="o">|</span> <span class="mf">0.36795</span> <span class="o">|</span> <span class="mf">0.21167</span> <span class="o">|</span> <span class="mf">0.20696</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">19</span>    <span class="o">|</span> <span class="mi">269</span>  <span class="o">|</span> <span class="mf">0.44757</span> <span class="o">|</span> <span class="mf">0.40028</span> <span class="o">|</span> <span class="mf">0.23809</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">20</span>    <span class="o">|</span> <span class="mi">205</span>  <span class="o">|</span> <span class="mf">0.48078</span> <span class="o">|</span> <span class="mf">0.65283</span> <span class="o">|</span> <span class="mf">0.34241</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">21</span>    <span class="o">|</span> <span class="mi">467</span>  <span class="o">|</span> <span class="mf">0.37577</span> <span class="o">|</span> <span class="mf">0.35789</span> <span class="o">|</span> <span class="mf">0.20992</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">22</span>    <span class="o">|</span> <span class="mi">370</span>  <span class="o">|</span> <span class="mf">0.22329</span> <span class="o">|</span> <span class="mf">0.29697</span> <span class="o">|</span> <span class="mf">0.20943</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">23</span>    <span class="o">|</span> <span class="mi">447</span>  <span class="o">|</span> <span class="mf">0.36708</span> <span class="o">|</span> <span class="mf">0.22722</span> <span class="o">|</span> <span class="mf">0.20176</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">24</span>    <span class="o">|</span> <span class="mi">231</span>  <span class="o">|</span> <span class="mf">0.28466</span> <span class="o">|</span> <span class="mf">0.52795</span> <span class="o">|</span> <span class="mf">0.31729</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">25</span>    <span class="o">|</span> <span class="mi">3</span>    <span class="o">|</span> <span class="mf">0.36377</span> <span class="o">|</span> <span class="mf">1.1547</span>  <span class="o">|</span> <span class="mf">0.70452</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">26</span>    <span class="o">|</span> <span class="mi">28</span>   <span class="o">|</span> <span class="mf">0.14842</span> <span class="o">|</span> <span class="mf">0.29869</span> <span class="o">|</span> <span class="mf">0.23437</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">27</span>    <span class="o">|</span> <span class="mi">22</span>   <span class="o">|</span> <span class="mf">0.13375</span> <span class="o">|</span> <span class="mf">0.2666</span>  <span class="o">|</span> <span class="mf">0.17175</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">28</span>    <span class="o">|</span> <span class="mi">17</span>   <span class="o">|</span> <span class="mf">0.1222</span>  <span class="o">|</span> <span class="mf">0.14108</span> <span class="o">|</span> <span class="mf">0.17261</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">29</span>    <span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mf">0.40725</span> <span class="o">|</span> <span class="mf">0.85708</span> <span class="o">|</span> <span class="mf">0.42044</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">30</span>    <span class="o">|</span> <span class="mi">145</span>  <span class="o">|</span> <span class="mf">0.60805</span> <span class="o">|</span> <span class="mf">0.57195</span> <span class="o">|</span> <span class="mf">0.43388</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">31</span>    <span class="o">|</span> <span class="mi">281</span>  <span class="o">|</span> <span class="mf">0.18353</span> <span class="o">|</span> <span class="mf">0.21351</span> <span class="o">|</span> <span class="mf">0.2061</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">32</span>    <span class="o">|</span> <span class="mi">250</span>  <span class="o">|</span> <span class="mf">0.19984</span> <span class="o">|</span> <span class="mf">0.15417</span> <span class="o">|</span> <span class="mf">0.1993</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">33</span>    <span class="o">|</span> <span class="mi">294</span>  <span class="o">|</span> <span class="mf">0.15006</span> <span class="o">|</span> <span class="mf">0.27665</span> <span class="o">|</span> <span class="mf">0.21823</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">34</span>    <span class="o">|</span> <span class="mi">158</span>  <span class="o">|</span> <span class="mf">0.44084</span> <span class="o">|</span> <span class="mf">0.50436</span> <span class="o">|</span> <span class="mf">0.38365</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">35</span>    <span class="o">|</span> <span class="mi">203</span>  <span class="o">|</span> <span class="mf">0.86526</span> <span class="o">|</span> <span class="mf">0.47248</span> <span class="o">|</span> <span class="mf">0.32568</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">36</span>    <span class="o">|</span> <span class="mi">525</span>  <span class="o">|</span> <span class="mf">0.54992</span> <span class="o">|</span> <span class="mf">0.31614</span> <span class="o">|</span> <span class="mf">0.19036</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">37</span>    <span class="o">|</span> <span class="mi">521</span>  <span class="o">|</span> <span class="mf">0.22611</span> <span class="o">|</span> <span class="mf">0.12494</span> <span class="o">|</span> <span class="mf">0.21894</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">38</span>    <span class="o">|</span> <span class="mi">624</span>  <span class="o">|</span> <span class="mf">0.23105</span> <span class="o">|</span> <span class="mf">0.20793</span> <span class="o">|</span> <span class="mf">0.22246</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">39</span>    <span class="o">|</span> <span class="mi">259</span>  <span class="o">|</span> <span class="mf">0.43408</span> <span class="o">|</span> <span class="mf">0.43312</span> <span class="o">|</span> <span class="mf">0.2724</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">40</span>    <span class="o">|</span> <span class="mi">134</span>  <span class="o">|</span> <span class="mf">0.55289</span> <span class="o">|</span> <span class="mf">0.3935</span>  <span class="o">|</span> <span class="mf">0.26933</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">41</span>    <span class="o">|</span> <span class="mi">557</span>  <span class="o">|</span> <span class="mf">0.29543</span> <span class="o">|</span> <span class="mf">0.24331</span> <span class="o">|</span> <span class="mf">0.23127</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">42</span>    <span class="o">|</span> <span class="mi">771</span>  <span class="o">|</span> <span class="mf">0.46252</span> <span class="o">|</span> <span class="mf">0.19655</span> <span class="o">|</span> <span class="mf">0.2348</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">43</span>    <span class="o">|</span> <span class="mi">658</span>  <span class="o">|</span> <span class="mf">0.24901</span> <span class="o">|</span> <span class="mf">0.31232</span> <span class="o">|</span> <span class="mf">0.24217</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">44</span>    <span class="o">|</span> <span class="mi">199</span>  <span class="o">|</span> <span class="mf">0.44994</span> <span class="o">|</span> <span class="mf">0.43547</span> <span class="o">|</span> <span class="mf">0.28695</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">45</span>    <span class="o">|</span> <span class="mi">54</span>   <span class="o">|</span> <span class="mf">0.5679</span>  <span class="o">|</span> <span class="mf">0.44719</span> <span class="o">|</span> <span class="mf">0.23983</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">46</span>    <span class="o">|</span> <span class="mi">333</span>  <span class="o">|</span> <span class="mf">0.44117</span> <span class="o">|</span> <span class="mf">0.44019</span> <span class="o">|</span> <span class="mf">0.24586</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">47</span>    <span class="o">|</span> <span class="mi">592</span>  <span class="o">|</span> <span class="mf">0.3056</span>  <span class="o">|</span> <span class="mf">0.44653</span> <span class="o">|</span> <span class="mf">0.24795</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">48</span>    <span class="o">|</span> <span class="mi">411</span>  <span class="o">|</span> <span class="mf">0.67885</span> <span class="o">|</span> <span class="mf">0.39219</span> <span class="o">|</span> <span class="mf">0.2588</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">49</span>    <span class="o">|</span> <span class="mi">93</span>   <span class="o">|</span> <span class="mf">0.45355</span> <span class="o">|</span> <span class="mf">0.5659</span>  <span class="o">|</span> <span class="mf">0.2611</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">50</span>    <span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="mf">1.0009</span>  <span class="o">|</span> <span class="mf">0.46232</span> <span class="o">|</span> <span class="mf">0.21423</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">51</span>    <span class="o">|</span> <span class="mi">162</span>  <span class="o">|</span> <span class="mf">0.72162</span> <span class="o">|</span> <span class="mf">0.36619</span> <span class="o">|</span> <span class="mf">0.23884</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">52</span>    <span class="o">|</span> <span class="mi">324</span>  <span class="o">|</span> <span class="mf">0.51574</span> <span class="o">|</span> <span class="mf">0.48569</span> <span class="o">|</span> <span class="mf">0.2488</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">53</span>    <span class="o">|</span> <span class="mi">224</span>  <span class="o">|</span> <span class="mf">0.41145</span> <span class="o">|</span> <span class="mf">0.40151</span> <span class="o">|</span> <span class="mf">0.2671</span>   <span class="o">|</span>
  <span class="o">|</span> <span class="mi">54</span>    <span class="o">|</span> <span class="mi">16</span>   <span class="o">|</span> <span class="mf">0.5362</span>  <span class="o">|</span> <span class="mf">0.50568</span> <span class="o">|</span> <span class="mf">0.21454</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">55</span>    <span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mf">0.85351</span> <span class="o">|</span> <span class="mf">0.57076</span> <span class="o">|</span> <span class="mf">0.24389</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">56</span>    <span class="o">|</span> <span class="mi">37</span>   <span class="o">|</span> <span class="mf">0.72428</span> <span class="o">|</span> <span class="mf">0.38373</span> <span class="o">|</span> <span class="mf">0.27121</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">57</span>    <span class="o">|</span> <span class="mi">106</span>  <span class="o">|</span> <span class="mf">0.80208</span> <span class="o">|</span> <span class="mf">0.98469</span> <span class="o">|</span> <span class="mf">0.27939</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">58</span>    <span class="o">|</span> <span class="mi">61</span>   <span class="o">|</span> <span class="mf">0.5144</span>  <span class="o">|</span> <span class="mf">1.3281</span>  <span class="o">|</span> <span class="mf">0.30346</span>  <span class="o">|</span>
  <span class="o">|</span> <span class="mi">59</span>    <span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mf">0.33371</span> <span class="o">|</span> <span class="mf">0.50058</span> <span class="o">|</span> <span class="mf">0.24425</span>  <span class="o">|</span>
  <span class="o">-----------------------------------------------</span>
  <span class="n">Final</span> <span class="n">refined</span> <span class="n">crystal</span> <span class="n">models</span><span class="p">:</span>
  <span class="n">model</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">192715</span> <span class="n">reflections</span><span class="p">):</span>
  <span class="n">Crystal</span><span class="p">:</span>
      <span class="n">Unit</span> <span class="n">cell</span><span class="p">:</span> <span class="p">(</span><span class="mf">57.834</span><span class="p">,</span> <span class="mf">57.834</span><span class="p">,</span> <span class="mf">150.022</span><span class="p">,</span> <span class="mf">90.000</span><span class="p">,</span> <span class="mf">90.000</span><span class="p">,</span> <span class="mf">90.000</span><span class="p">)</span>
      <span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">P</span> <span class="mi">4</span>
      <span class="n">U</span> <span class="n">matrix</span><span class="p">:</span>  <span class="p">{{</span> <span class="mf">0.4122</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9018</span><span class="p">,</span>  <span class="mf">0.1299</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.2361</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0320</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9712</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.8800</span><span class="p">,</span>  <span class="mf">0.4310</span><span class="p">,</span>  <span class="mf">0.1997</span><span class="p">}}</span>
      <span class="n">B</span> <span class="n">matrix</span><span class="p">:</span>  <span class="p">{{</span> <span class="mf">0.0173</span><span class="p">,</span>  <span class="mf">0.0000</span><span class="p">,</span>  <span class="mf">0.0000</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.0000</span><span class="p">,</span>  <span class="mf">0.0173</span><span class="p">,</span>  <span class="mf">0.0000</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.0000</span><span class="p">,</span>  <span class="mf">0.0000</span><span class="p">,</span>  <span class="mf">0.0067</span><span class="p">}}</span>
      <span class="n">A</span> <span class="o">=</span> <span class="n">UB</span><span class="p">:</span>    <span class="p">{{</span> <span class="mf">0.0071</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0156</span><span class="p">,</span>  <span class="mf">0.0009</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.0041</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0006</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0065</span><span class="p">},</span>
                  <span class="p">{</span> <span class="mf">0.0152</span><span class="p">,</span>  <span class="mf">0.0075</span><span class="p">,</span>  <span class="mf">0.0013</span><span class="p">}}</span>
</pre></div>
</div>
<p>This refinement was performed moving all the panels as a rigid block, as usual.
With overall positional RMSDs within 40% of the pixel size and a
quarter of the image width in <img class="math" src="../../_images/math/10e009bdb83f96c5f47c58b34d5d4b12ef268d5b.png" alt="\phi"/> we can see straight away that we are
dealing with a fairly good quality
dataset. There are a few outliers of well over 1 mm on the detector surface and nearly
1 degree in <img class="math" src="../../_images/math/10e009bdb83f96c5f47c58b34d5d4b12ef268d5b.png" alt="\phi"/> though, which we would prefer not to include in
refinement. The outliers are not as bad if we had kept <code class="samp docutils literal"><span class="pre">min_spot_size=6</span></code>,
but the detector coverage is worse in that case. Although from the indexing results
it seems that coverage of reflections on the outer panels is rather low, so far
we let refinement take a random subset of the data in order to index quicker,
so there&#8217;s no need to worry about that yet.</p>
<p>Now we will refine the detector as a rigid block again, turning on outlier
rejection and requesting to use all reflections to get the best we can out
of the dataset. We will also keep the refined reflections file for analysis.
The final parameter here, <code class="samp docutils literal"><span class="pre">close_to_spindle_cutoff=0.01</span></code> allows reflections
closer to the spindle to be included in refinement (default value is 0.05, and
if set to 0.0 no reflections will be rejected for being too close).
Without this option, the central panels are very sparse:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">experiments</span><span class="o">.</span><span class="n">json</span> \
 <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">tukey</span> <span class="n">use_all_reflections</span><span class="o">=</span><span class="n">true</span> <span class="n">close_to_spindle_cutoff</span><span class="o">=</span><span class="mf">0.01</span> \
 <span class="n">output</span><span class="o">.</span><span class="n">reflections</span><span class="o">=</span><span class="n">refined_reflections_lev0</span><span class="o">.</span><span class="n">pickle</span> \
 <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">refined_experiments_lev0</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Here is the output:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">The</span> <span class="n">following</span> <span class="n">parameters</span> <span class="n">have</span> <span class="n">been</span> <span class="n">modified</span><span class="p">:</span>

<span class="n">output</span> <span class="p">{</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="n">refined_reflections_lev0</span><span class="o">.</span><span class="n">pickle</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">refined_experiments_lev0</span><span class="o">.</span><span class="n">json</span>
<span class="p">}</span>
<span class="n">refinement</span> <span class="p">{</span>
  <span class="n">reflections</span> <span class="p">{</span>
    <span class="n">use_all_reflections</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">close_to_spindle_cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">outlier</span> <span class="p">{</span>
      <span class="n">algorithm</span> <span class="o">=</span> <span class="n">null</span> <span class="o">*</span><span class="n">tukey</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">input</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">experiments</span><span class="o">.</span><span class="n">json</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span>
<span class="p">}</span>

<span class="n">Configuring</span> <span class="n">refiner</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">-----------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>    <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>       <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>   <span class="o">|</span>
<span class="o">-----------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">2.487</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.04174</span> <span class="o">|</span> <span class="mf">0.000276</span>  <span class="o">|</span> <span class="mf">0.0424</span>  <span class="o">|</span> <span class="mf">2.128</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">1.75</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.03468</span> <span class="o">|</span> <span class="mf">0.00168</span>   <span class="o">|</span> <span class="mf">0.03656</span> <span class="o">|</span> <span class="mf">1.654</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">5.549</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.06627</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.002108</span> <span class="o">|</span> <span class="mf">0.063</span>   <span class="o">|</span> <span class="mf">3.27</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">80.55</span>  <span class="o">|</span> <span class="mf">127.9</span>    <span class="o">|</span> <span class="mf">131.9</span>     <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">77.02</span>  <span class="o">|</span> <span class="mf">127.7</span>    <span class="o">|</span> <span class="mf">131.9</span>     <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">25.97</span>  <span class="o">|</span> <span class="mf">32.57</span>    <span class="o">|</span> <span class="mf">32.65</span>     <span class="o">|</span> <span class="mf">32.65</span>   <span class="o">|</span> <span class="mf">32.65</span> <span class="o">|</span>
<span class="o">-----------------------------------------------------------------------</span>

<span class="mi">6375</span> <span class="n">reflections</span> <span class="n">have</span> <span class="n">been</span> <span class="n">rejected</span> <span class="k">as</span> <span class="n">outliers</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>     <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>        <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>    <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.2933</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.04128</span> <span class="o">|</span> <span class="o">-</span><span class="mf">3.167e-05</span> <span class="o">|</span> <span class="mf">0.04112</span> <span class="o">|</span> <span class="mf">0.3725</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.4707</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.03376</span> <span class="o">|</span> <span class="mf">0.001821</span>   <span class="o">|</span> <span class="mf">0.03588</span> <span class="o">|</span> <span class="mf">0.4945</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.6965</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.06574</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.002213</span>  <span class="o">|</span> <span class="mf">0.06229</span> <span class="o">|</span> <span class="mf">0.7919</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">80.55</span>   <span class="o">|</span> <span class="mi">128</span>      <span class="o">|</span> <span class="mi">132</span>        <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">77.02</span>   <span class="o">|</span> <span class="mf">127.8</span>    <span class="o">|</span> <span class="mf">131.9</span>      <span class="o">|</span> <span class="mf">134.1</span>   <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">26.58</span>   <span class="o">|</span> <span class="mf">32.57</span>    <span class="o">|</span> <span class="mf">32.65</span>      <span class="o">|</span> <span class="mf">32.65</span>   <span class="o">|</span> <span class="mf">32.65</span>  <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>

<span class="n">Performing</span> <span class="n">refinement</span><span class="o">...</span>

<span class="n">Refinement</span> <span class="n">steps</span><span class="p">:</span>
<span class="o">--------------------------------------------------</span>
<span class="o">|</span> <span class="n">Step</span> <span class="o">|</span> <span class="n">Nref</span>   <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Phi</span> <span class="o">|</span>
<span class="o">|</span>      <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">--------------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.064091</span> <span class="o">|</span> <span class="mf">0.057786</span> <span class="o">|</span> <span class="mf">0.086136</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.064045</span> <span class="o">|</span> <span class="mf">0.057829</span> <span class="o">|</span> <span class="mf">0.08608</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063949</span> <span class="o">|</span> <span class="mf">0.05791</span>  <span class="o">|</span> <span class="mf">0.086068</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063825</span> <span class="o">|</span> <span class="mf">0.058023</span> <span class="o">|</span> <span class="mf">0.086026</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063734</span> <span class="o">|</span> <span class="mf">0.058114</span> <span class="o">|</span> <span class="mf">0.085958</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063682</span> <span class="o">|</span> <span class="mf">0.058167</span> <span class="o">|</span> <span class="mf">0.085909</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063654</span> <span class="o">|</span> <span class="mf">0.058198</span> <span class="o">|</span> <span class="mf">0.085887</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063645</span> <span class="o">|</span> <span class="mf">0.058208</span> <span class="o">|</span> <span class="mf">0.085882</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>    <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.063644</span> <span class="o">|</span> <span class="mf">0.05821</span>  <span class="o">|</span> <span class="mf">0.085882</span> <span class="o">|</span>
<span class="o">--------------------------------------------------</span>
<span class="n">RMSD</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">decreasing</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>   <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">186203</span> <span class="o">|</span> <span class="mf">0.37002</span> <span class="o">|</span> <span class="mf">0.33843</span> <span class="o">|</span> <span class="mf">0.24538</span>  <span class="o">|</span>
<span class="o">-----------------------------------------------</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">panel</span><span class="p">:</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="n">Panel</span> <span class="o">|</span> <span class="n">Nref</span> <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>     <span class="o">|</span> <span class="mi">63</span>   <span class="o">|</span> <span class="mf">0.47216</span> <span class="o">|</span> <span class="mf">0.59331</span> <span class="o">|</span> <span class="mf">0.22352</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span> <span class="mi">1363</span> <span class="o">|</span> <span class="mf">0.35019</span> <span class="o">|</span> <span class="mf">0.46301</span> <span class="o">|</span> <span class="mf">0.26549</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span> <span class="mi">3076</span> <span class="o">|</span> <span class="mf">0.4128</span>  <span class="o">|</span> <span class="mf">0.40658</span> <span class="o">|</span> <span class="mf">0.26659</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span> <span class="mi">1630</span> <span class="o">|</span> <span class="mf">0.46232</span> <span class="o">|</span> <span class="mf">0.39692</span> <span class="o">|</span> <span class="mf">0.25547</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">4</span>     <span class="o">|</span> <span class="mi">112</span>  <span class="o">|</span> <span class="mf">0.39711</span> <span class="o">|</span> <span class="mf">0.42575</span> <span class="o">|</span> <span class="mf">0.23841</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">5</span>     <span class="o">|</span> <span class="mi">394</span>  <span class="o">|</span> <span class="mf">0.35145</span> <span class="o">|</span> <span class="mf">0.51263</span> <span class="o">|</span> <span class="mf">0.25474</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>     <span class="o">|</span> <span class="mi">3489</span> <span class="o">|</span> <span class="mf">0.3238</span>  <span class="o">|</span> <span class="mf">0.48667</span> <span class="o">|</span> <span class="mf">0.25694</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>     <span class="o">|</span> <span class="mi">6172</span> <span class="o">|</span> <span class="mf">0.30869</span> <span class="o">|</span> <span class="mf">0.27402</span> <span class="o">|</span> <span class="mf">0.25323</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>     <span class="o">|</span> <span class="mi">3908</span> <span class="o">|</span> <span class="mf">0.37309</span> <span class="o">|</span> <span class="mf">0.38322</span> <span class="o">|</span> <span class="mf">0.25577</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">9</span>     <span class="o">|</span> <span class="mi">680</span>  <span class="o">|</span> <span class="mf">0.46698</span> <span class="o">|</span> <span class="mf">0.44533</span> <span class="o">|</span> <span class="mf">0.24812</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span>    <span class="o">|</span> <span class="mi">1178</span> <span class="o">|</span> <span class="mf">0.33544</span> <span class="o">|</span> <span class="mf">0.51129</span> <span class="o">|</span> <span class="mf">0.26289</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span>    <span class="o">|</span> <span class="mi">5690</span> <span class="o">|</span> <span class="mf">0.28409</span> <span class="o">|</span> <span class="mf">0.29009</span> <span class="o">|</span> <span class="mf">0.24376</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span>    <span class="o">|</span> <span class="mi">9385</span> <span class="o">|</span> <span class="mf">0.36731</span> <span class="o">|</span> <span class="mf">0.23495</span> <span class="o">|</span> <span class="mf">0.23873</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">13</span>    <span class="o">|</span> <span class="mi">6878</span> <span class="o">|</span> <span class="mf">0.31962</span> <span class="o">|</span> <span class="mf">0.31088</span> <span class="o">|</span> <span class="mf">0.23691</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">14</span>    <span class="o">|</span> <span class="mi">1749</span> <span class="o">|</span> <span class="mf">0.43068</span> <span class="o">|</span> <span class="mf">0.47078</span> <span class="o">|</span> <span class="mf">0.25696</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">15</span>    <span class="o">|</span> <span class="mi">1870</span> <span class="o">|</span> <span class="mf">0.29306</span> <span class="o">|</span> <span class="mf">0.46181</span> <span class="o">|</span> <span class="mf">0.26494</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">16</span>    <span class="o">|</span> <span class="mi">6328</span> <span class="o">|</span> <span class="mf">0.19137</span> <span class="o">|</span> <span class="mf">0.29002</span> <span class="o">|</span> <span class="mf">0.21465</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">17</span>    <span class="o">|</span> <span class="mi">7599</span> <span class="o">|</span> <span class="mf">0.17418</span> <span class="o">|</span> <span class="mf">0.1739</span>  <span class="o">|</span> <span class="mf">0.22093</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">18</span>    <span class="o">|</span> <span class="mi">7072</span> <span class="o">|</span> <span class="mf">0.36776</span> <span class="o">|</span> <span class="mf">0.18662</span> <span class="o">|</span> <span class="mf">0.20821</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">19</span>    <span class="o">|</span> <span class="mi">2609</span> <span class="o">|</span> <span class="mf">0.37377</span> <span class="o">|</span> <span class="mf">0.42663</span> <span class="o">|</span> <span class="mf">0.24206</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">20</span>    <span class="o">|</span> <span class="mi">1806</span> <span class="o">|</span> <span class="mf">0.40342</span> <span class="o">|</span> <span class="mf">0.57026</span> <span class="o">|</span> <span class="mf">0.32007</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">21</span>    <span class="o">|</span> <span class="mi">4247</span> <span class="o">|</span> <span class="mf">0.35488</span> <span class="o">|</span> <span class="mf">0.34512</span> <span class="o">|</span> <span class="mf">0.19181</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">22</span>    <span class="o">|</span> <span class="mi">3558</span> <span class="o">|</span> <span class="mf">0.21403</span> <span class="o">|</span> <span class="mf">0.30996</span> <span class="o">|</span> <span class="mf">0.20695</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">23</span>    <span class="o">|</span> <span class="mi">4103</span> <span class="o">|</span> <span class="mf">0.36559</span> <span class="o">|</span> <span class="mf">0.19154</span> <span class="o">|</span> <span class="mf">0.17851</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">24</span>    <span class="o">|</span> <span class="mi">2270</span> <span class="o">|</span> <span class="mf">0.25744</span> <span class="o">|</span> <span class="mf">0.48077</span> <span class="o">|</span> <span class="mf">0.26616</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">25</span>    <span class="o">|</span> <span class="mi">480</span>  <span class="o">|</span> <span class="mf">0.38505</span> <span class="o">|</span> <span class="mf">1.0035</span>  <span class="o">|</span> <span class="mf">0.73284</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">26</span>    <span class="o">|</span> <span class="mi">930</span>  <span class="o">|</span> <span class="mf">0.15033</span> <span class="o">|</span> <span class="mf">0.26661</span> <span class="o">|</span> <span class="mf">0.34611</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">27</span>    <span class="o">|</span> <span class="mi">971</span>  <span class="o">|</span> <span class="mf">0.11836</span> <span class="o">|</span> <span class="mf">0.19105</span> <span class="o">|</span> <span class="mf">0.18709</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">28</span>    <span class="o">|</span> <span class="mi">975</span>  <span class="o">|</span> <span class="mf">0.11907</span> <span class="o">|</span> <span class="mf">0.25901</span> <span class="o">|</span> <span class="mf">0.30046</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">29</span>    <span class="o">|</span> <span class="mi">549</span>  <span class="o">|</span> <span class="mf">0.41024</span> <span class="o">|</span> <span class="mf">0.95027</span> <span class="o">|</span> <span class="mf">0.72705</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">30</span>    <span class="o">|</span> <span class="mi">1478</span> <span class="o">|</span> <span class="mf">0.56625</span> <span class="o">|</span> <span class="mf">0.3835</span>  <span class="o">|</span> <span class="mf">0.34664</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">31</span>    <span class="o">|</span> <span class="mi">3216</span> <span class="o">|</span> <span class="mf">0.16373</span> <span class="o">|</span> <span class="mf">0.19856</span> <span class="o">|</span> <span class="mf">0.19257</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">32</span>    <span class="o">|</span> <span class="mi">2826</span> <span class="o">|</span> <span class="mf">0.20149</span> <span class="o">|</span> <span class="mf">0.14689</span> <span class="o">|</span> <span class="mf">0.19485</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">33</span>    <span class="o">|</span> <span class="mi">3285</span> <span class="o">|</span> <span class="mf">0.12942</span> <span class="o">|</span> <span class="mf">0.30274</span> <span class="o">|</span> <span class="mf">0.20848</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">34</span>    <span class="o">|</span> <span class="mi">1965</span> <span class="o">|</span> <span class="mf">0.38874</span> <span class="o">|</span> <span class="mf">0.45564</span> <span class="o">|</span> <span class="mf">0.38875</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">35</span>    <span class="o">|</span> <span class="mi">1934</span> <span class="o">|</span> <span class="mf">0.61707</span> <span class="o">|</span> <span class="mf">0.35339</span> <span class="o">|</span> <span class="mf">0.25067</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">36</span>    <span class="o">|</span> <span class="mi">5875</span> <span class="o">|</span> <span class="mf">0.55413</span> <span class="o">|</span> <span class="mf">0.29556</span> <span class="o">|</span> <span class="mf">0.19246</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">37</span>    <span class="o">|</span> <span class="mi">5992</span> <span class="o">|</span> <span class="mf">0.2137</span>  <span class="o">|</span> <span class="mf">0.12029</span> <span class="o">|</span> <span class="mf">0.21502</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">38</span>    <span class="o">|</span> <span class="mi">6589</span> <span class="o">|</span> <span class="mf">0.2254</span>  <span class="o">|</span> <span class="mf">0.21047</span> <span class="o">|</span> <span class="mf">0.21193</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">39</span>    <span class="o">|</span> <span class="mi">2763</span> <span class="o">|</span> <span class="mf">0.39851</span> <span class="o">|</span> <span class="mf">0.41673</span> <span class="o">|</span> <span class="mf">0.27272</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">40</span>    <span class="o">|</span> <span class="mi">1512</span> <span class="o">|</span> <span class="mf">0.50654</span> <span class="o">|</span> <span class="mf">0.36893</span> <span class="o">|</span> <span class="mf">0.25051</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">41</span>    <span class="o">|</span> <span class="mi">6476</span> <span class="o">|</span> <span class="mf">0.28308</span> <span class="o">|</span> <span class="mf">0.21635</span> <span class="o">|</span> <span class="mf">0.22668</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">42</span>    <span class="o">|</span> <span class="mi">9212</span> <span class="o">|</span> <span class="mf">0.40577</span> <span class="o">|</span> <span class="mf">0.18283</span> <span class="o">|</span> <span class="mf">0.2252</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">43</span>    <span class="o">|</span> <span class="mi">7521</span> <span class="o">|</span> <span class="mf">0.22936</span> <span class="o">|</span> <span class="mf">0.29881</span> <span class="o">|</span> <span class="mf">0.23864</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">44</span>    <span class="o">|</span> <span class="mi">2392</span> <span class="o">|</span> <span class="mf">0.40816</span> <span class="o">|</span> <span class="mf">0.42881</span> <span class="o">|</span> <span class="mf">0.2751</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">45</span>    <span class="o">|</span> <span class="mi">611</span>  <span class="o">|</span> <span class="mf">0.56917</span> <span class="o">|</span> <span class="mf">0.48084</span> <span class="o">|</span> <span class="mf">0.26191</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">46</span>    <span class="o">|</span> <span class="mi">4379</span> <span class="o">|</span> <span class="mf">0.42672</span> <span class="o">|</span> <span class="mf">0.42447</span> <span class="o">|</span> <span class="mf">0.25285</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">47</span>    <span class="o">|</span> <span class="mi">7749</span> <span class="o">|</span> <span class="mf">0.29309</span> <span class="o">|</span> <span class="mf">0.4378</span>  <span class="o">|</span> <span class="mf">0.24631</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">48</span>    <span class="o">|</span> <span class="mi">5470</span> <span class="o">|</span> <span class="mf">0.67537</span> <span class="o">|</span> <span class="mf">0.37528</span> <span class="o">|</span> <span class="mf">0.25187</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">49</span>    <span class="o">|</span> <span class="mi">1210</span> <span class="o">|</span> <span class="mf">0.42778</span> <span class="o">|</span> <span class="mf">0.53938</span> <span class="o">|</span> <span class="mf">0.27266</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">50</span>    <span class="o">|</span> <span class="mi">127</span>  <span class="o">|</span> <span class="mf">0.92194</span> <span class="o">|</span> <span class="mf">0.45501</span> <span class="o">|</span> <span class="mf">0.24629</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">51</span>    <span class="o">|</span> <span class="mi">2235</span> <span class="o">|</span> <span class="mf">0.71785</span> <span class="o">|</span> <span class="mf">0.33424</span> <span class="o">|</span> <span class="mf">0.25781</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">52</span>    <span class="o">|</span> <span class="mi">4379</span> <span class="o">|</span> <span class="mf">0.41055</span> <span class="o">|</span> <span class="mf">0.38155</span> <span class="o">|</span> <span class="mf">0.25735</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">53</span>    <span class="o">|</span> <span class="mi">2757</span> <span class="o">|</span> <span class="mf">0.44268</span> <span class="o">|</span> <span class="mf">0.40149</span> <span class="o">|</span> <span class="mf">0.26646</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">54</span>    <span class="o">|</span> <span class="mi">327</span>  <span class="o">|</span> <span class="mf">0.52856</span> <span class="o">|</span> <span class="mf">0.51306</span> <span class="o">|</span> <span class="mf">0.28205</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">56</span>    <span class="o">|</span> <span class="mi">457</span>  <span class="o">|</span> <span class="mf">0.60967</span> <span class="o">|</span> <span class="mf">0.429</span>   <span class="o">|</span> <span class="mf">0.26482</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">57</span>    <span class="o">|</span> <span class="mi">1507</span> <span class="o">|</span> <span class="mf">0.70752</span> <span class="o">|</span> <span class="mf">0.67612</span> <span class="o">|</span> <span class="mf">0.25844</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">58</span>    <span class="o">|</span> <span class="mi">786</span>  <span class="o">|</span> <span class="mf">0.53669</span> <span class="o">|</span> <span class="mf">0.50635</span> <span class="o">|</span> <span class="mf">0.27127</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">59</span>    <span class="o">|</span> <span class="mi">39</span>   <span class="o">|</span> <span class="mf">0.43205</span> <span class="o">|</span> <span class="mf">0.65796</span> <span class="o">|</span> <span class="mf">0.25585</span>  <span class="o">|</span>
<span class="o">-----------------------------------------------</span>
<span class="n">Saving</span> <span class="n">refined</span> <span class="n">experiments</span> <span class="n">to</span> <span class="n">refined_experiments_lev0</span><span class="o">.</span><span class="n">json</span>
<span class="n">Saving</span> <span class="n">refined</span> <span class="n">reflections</span> <span class="n">to</span> <span class="n">refined_reflections_lev0</span><span class="o">.</span><span class="n">pickle</span>
</pre></div>
</div>
<p>Outlier rejection has cleaned up the positional residuals so now the greatest
deviation is within 0.4 mm of the predicted position. The angular extreme is
now just over 0.4 degrees. Coverage of the outer and central panels (where
reflections are in the backstop shadow or thrown away for being too close
to the spindle) is still a little low. Notably, panel 55 (a corner panel) is
completely missing. If we had more datasets recorded at the same detector
distance (and more time to process them) we could combine them in a multi-crystal
joint refinement job to increase the coverage of panels further. However,
for the purposes of this tutorial we will see what we can get with this single
dataset.</p>
<p>Before moving on to the multi-panel refinement job we will take a look at the
refined reflections file:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">analyse_output</span> <span class="n">refined_reflections_lev0</span><span class="o">.</span><span class="n">pickle</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span>
</pre></div>
</div>
<p>Here we had to tell <strong class="program">dials.analyse_output</strong> about the arrangement of
the panels, as it does not use the <code class="file docutils literal"><span class="pre">refined_experiments_lev0.json</span></code> file so cannot
figure this out itself.</p>
<p>Here are the positional residual plots for X and Y, <code class="file docutils literal"><span class="pre">analysis/centroid/centroid_diff_x.png</span></code>
and <code class="file docutils literal"><span class="pre">analysis/centroid/centroid_diff_y.png</span></code>. The multi-panel versions
of these plots are not as compact as the single tile version presented in the
<a class="reference internal" href="processing_in_detail_tutorial.html"><span class="doc">Processing in Detail</span></a>. However, careful comparison of the plots is enough to
show that the same pattern of shifts is present.</p>
<blockquote>
<div><img alt="../../_images/centroid_diff_x_multi_panel_lev0.png" src="../../_images/centroid_diff_x_multi_panel_lev0.png" />
<img alt="../../_images/centroid_diff_y_multi_panel_lev0.png" src="../../_images/centroid_diff_y_multi_panel_lev0.png" />
</div></blockquote>
</div>
<div class="section" id="multi-tile-refinement">
<h2>Multi-tile refinement<a class="headerlink" href="#multi-tile-refinement" title="Permalink to this headline">¶</a></h2>
<p>Now we repeat refinement, but we allow the panels to move independently. In
DIALS multi-panel detectors are represented by a hierarchical model. The highest
level <code class="samp docutils literal"><span class="pre">hieararchy_level=0</span></code> means to treat the whole detector unit as a
rigid block. Some detectors, notably the CS-PAD used at LCLS beamlines, have a
real hierarchy of a few levels deep. The Pilatus P6M has a very simple hierarchy,
with a single lower level, <code class="samp docutils literal"><span class="pre">hieararchy_level=1</span></code>, in which every panel is
treated separately. We now start from the previous refinement run
specifying this hierarchy level:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">refined_experiments_lev0</span><span class="o">.</span><span class="n">json</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">tukey</span> \
 <span class="n">use_all_reflections</span><span class="o">=</span><span class="n">true</span> <span class="n">output</span><span class="o">.</span><span class="n">reflections</span><span class="o">=</span><span class="n">refined_reflections_lev1</span><span class="o">.</span><span class="n">pickle</span> \
 <span class="n">close_to_spindle_cutoff</span><span class="o">=</span><span class="mf">0.01</span> <span class="n">bin_size_fraction</span><span class="o">=</span><span class="mi">0</span> <span class="n">hierarchy_level</span><span class="o">=</span><span class="mi">1</span> \
 <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">refined_experiments_lev1</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>You may have noticed that apart from <code class="samp docutils literal"><span class="pre">hierarchy_level=1</span></code> there was an
additional parameter added to this command compared to the previous refinement run,
namely <code class="samp docutils literal"><span class="pre">bin_size_fraction=0</span></code>. This sets the RMSD target for refinement to
zero, so that refinement will never terminate because the RMSDs are &#8216;good enough&#8217;,
only if they converge so that their rate of decrease on subsequent steps falls
to zero. This is necessary because the extra freedom allowed by parameterising
each panel individually allows the RMSDs to fall lower than the default target.
There are 366 parameters in total for this refinement run. This can be seen
by checking the file <code class="file docutils literal"><span class="pre">dials.refine.debug.log</span></code> once refinement is underway.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This job took 17 minutes to run on a Linux desktop with a Core i7 CPU running
at 3.07GHz, and uses about 4 GB of RAM.</p>
</div>
<p>Refinement is single-process at
the moment, unfortunately, so we can&#8217;t yet make use of parallelism here to
speed the job up. The output is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">The</span> <span class="n">following</span> <span class="n">parameters</span> <span class="n">have</span> <span class="n">been</span> <span class="n">modified</span><span class="p">:</span>

<span class="n">output</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">refined_experiments_lev1</span><span class="o">.</span><span class="n">json</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="n">refined_reflections_lev1</span><span class="o">.</span><span class="n">pickle</span>
<span class="p">}</span>
<span class="n">refinement</span> <span class="p">{</span>
  <span class="n">parameterisation</span> <span class="p">{</span>
    <span class="n">detector</span> <span class="p">{</span>
      <span class="n">hierarchy_level</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">target</span> <span class="p">{</span>
    <span class="n">bin_size_fraction</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>
  <span class="n">reflections</span> <span class="p">{</span>
    <span class="n">use_all_reflections</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">close_to_spindle_cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">outlier</span> <span class="p">{</span>
      <span class="n">algorithm</span> <span class="o">=</span> <span class="n">null</span> <span class="o">*</span><span class="n">tukey</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">input</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">refined_experiments</span><span class="o">.</span><span class="n">json</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span>
<span class="p">}</span>

<span class="n">Configuring</span> <span class="n">refiner</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">------------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>    <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>        <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>   <span class="o">|</span>
<span class="o">------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">2.496</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.04178</span> <span class="o">|</span> <span class="mf">0.0004518</span>  <span class="o">|</span> <span class="mf">0.04222</span> <span class="o">|</span> <span class="mf">2.133</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">1.903</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.03577</span> <span class="o">|</span> <span class="mf">0.0006705</span>  <span class="o">|</span> <span class="mf">0.03588</span> <span class="o">|</span> <span class="mf">1.656</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">5.576</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.06467</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.0007391</span> <span class="o">|</span> <span class="mf">0.06414</span> <span class="o">|</span> <span class="mf">3.292</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">80.55</span>  <span class="o">|</span> <span class="mf">127.9</span>    <span class="o">|</span> <span class="mf">131.9</span>      <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">77.02</span>  <span class="o">|</span> <span class="mf">127.7</span>    <span class="o">|</span> <span class="mf">131.9</span>      <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">25.97</span>  <span class="o">|</span> <span class="mf">32.57</span>    <span class="o">|</span> <span class="mf">32.65</span>      <span class="o">|</span> <span class="mf">32.65</span>   <span class="o">|</span> <span class="mf">32.65</span> <span class="o">|</span>
<span class="o">------------------------------------------------------------------------</span>

<span class="mi">6433</span> <span class="n">reflections</span> <span class="n">have</span> <span class="n">been</span> <span class="n">rejected</span> <span class="k">as</span> <span class="n">outliers</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>     <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>        <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>    <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.2916</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.04138</span> <span class="o">|</span> <span class="mf">0.0001204</span>  <span class="o">|</span> <span class="mf">0.041</span>   <span class="o">|</span> <span class="mf">0.3683</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.4838</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.03481</span> <span class="o">|</span> <span class="mf">0.0008164</span>  <span class="o">|</span> <span class="mf">0.03518</span> <span class="o">|</span> <span class="mf">0.4917</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.6969</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.06416</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.0008647</span> <span class="o">|</span> <span class="mf">0.06351</span> <span class="o">|</span> <span class="mf">0.7644</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">80.55</span>   <span class="o">|</span> <span class="mi">128</span>      <span class="o">|</span> <span class="mi">132</span>        <span class="o">|</span> <span class="mi">134</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">77.02</span>   <span class="o">|</span> <span class="mf">127.8</span>    <span class="o">|</span> <span class="mf">131.9</span>      <span class="o">|</span> <span class="mf">134.1</span>   <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">26.58</span>   <span class="o">|</span> <span class="mf">32.57</span>    <span class="o">|</span> <span class="mf">32.65</span>      <span class="o">|</span> <span class="mf">32.65</span>   <span class="o">|</span> <span class="mf">32.65</span>  <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>

<span class="n">Performing</span> <span class="n">refinement</span><span class="o">...</span>

<span class="n">Refinement</span> <span class="n">steps</span><span class="p">:</span>
<span class="o">--------------------------------------------------</span>
<span class="o">|</span> <span class="n">Step</span> <span class="o">|</span> <span class="n">Nref</span>   <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Phi</span> <span class="o">|</span>
<span class="o">|</span>      <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">--------------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.063617</span> <span class="o">|</span> <span class="mf">0.058127</span> <span class="o">|</span> <span class="mf">0.085801</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.056976</span> <span class="o">|</span> <span class="mf">0.05538</span>  <span class="o">|</span> <span class="mf">0.085719</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.049808</span> <span class="o">|</span> <span class="mf">0.052619</span> <span class="o">|</span> <span class="mf">0.085597</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.04634</span>  <span class="o">|</span> <span class="mf">0.051408</span> <span class="o">|</span> <span class="mf">0.085475</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.045568</span> <span class="o">|</span> <span class="mf">0.051142</span> <span class="o">|</span> <span class="mf">0.085391</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.04538</span>  <span class="o">|</span> <span class="mf">0.051014</span> <span class="o">|</span> <span class="mf">0.085337</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.045228</span> <span class="o">|</span> <span class="mf">0.050729</span> <span class="o">|</span> <span class="mf">0.085285</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.045054</span> <span class="o">|</span> <span class="mf">0.050076</span> <span class="o">|</span> <span class="mf">0.085215</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044868</span> <span class="o">|</span> <span class="mf">0.049034</span> <span class="o">|</span> <span class="mf">0.085115</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">9</span>    <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044746</span> <span class="o">|</span> <span class="mf">0.048167</span> <span class="o">|</span> <span class="mf">0.085025</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044708</span> <span class="o">|</span> <span class="mf">0.047833</span> <span class="o">|</span> <span class="mf">0.08498</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044695</span> <span class="o">|</span> <span class="mf">0.047759</span> <span class="o">|</span> <span class="mf">0.084969</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.04468</span>  <span class="o">|</span> <span class="mf">0.047738</span> <span class="o">|</span> <span class="mf">0.084967</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">13</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044668</span> <span class="o">|</span> <span class="mf">0.047726</span> <span class="o">|</span> <span class="mf">0.084967</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">14</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.044662</span> <span class="o">|</span> <span class="mf">0.047721</span> <span class="o">|</span> <span class="mf">0.084967</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">15</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.04466</span>  <span class="o">|</span> <span class="mf">0.047719</span> <span class="o">|</span> <span class="mf">0.084967</span> <span class="o">|</span>
<span class="o">--------------------------------------------------</span>
<span class="n">RMSD</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">decreasing</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>   <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">-----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">186145</span> <span class="o">|</span> <span class="mf">0.25965</span> <span class="o">|</span> <span class="mf">0.27743</span> <span class="o">|</span> <span class="mf">0.24276</span>  <span class="o">|</span>
<span class="o">-----------------------------------------------</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">panel</span><span class="p">:</span>
<span class="o">------------------------------------------------</span>
<span class="o">|</span> <span class="n">Panel</span> <span class="o">|</span> <span class="n">Nref</span> <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">------------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>     <span class="o">|</span> <span class="mi">64</span>   <span class="o">|</span> <span class="mf">0.32036</span>  <span class="o">|</span> <span class="mf">0.57819</span> <span class="o">|</span> <span class="mf">0.22482</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>     <span class="o">|</span> <span class="mi">1361</span> <span class="o">|</span> <span class="mf">0.34304</span>  <span class="o">|</span> <span class="mf">0.4111</span>  <span class="o">|</span> <span class="mf">0.26504</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span> <span class="mi">3079</span> <span class="o">|</span> <span class="mf">0.3561</span>   <span class="o">|</span> <span class="mf">0.36483</span> <span class="o">|</span> <span class="mf">0.26682</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>     <span class="o">|</span> <span class="mi">1632</span> <span class="o">|</span> <span class="mf">0.37843</span>  <span class="o">|</span> <span class="mf">0.37838</span> <span class="o">|</span> <span class="mf">0.25453</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">4</span>     <span class="o">|</span> <span class="mi">112</span>  <span class="o">|</span> <span class="mf">0.39065</span>  <span class="o">|</span> <span class="mf">0.39675</span> <span class="o">|</span> <span class="mf">0.23706</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">5</span>     <span class="o">|</span> <span class="mi">394</span>  <span class="o">|</span> <span class="mf">0.30539</span>  <span class="o">|</span> <span class="mf">0.48132</span> <span class="o">|</span> <span class="mf">0.25442</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>     <span class="o">|</span> <span class="mi">3490</span> <span class="o">|</span> <span class="mf">0.29682</span>  <span class="o">|</span> <span class="mf">0.35249</span> <span class="o">|</span> <span class="mf">0.25661</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>     <span class="o">|</span> <span class="mi">6178</span> <span class="o">|</span> <span class="mf">0.28525</span>  <span class="o">|</span> <span class="mf">0.27486</span> <span class="o">|</span> <span class="mf">0.25318</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>     <span class="o">|</span> <span class="mi">3909</span> <span class="o">|</span> <span class="mf">0.31728</span>  <span class="o">|</span> <span class="mf">0.30551</span> <span class="o">|</span> <span class="mf">0.25565</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">9</span>     <span class="o">|</span> <span class="mi">675</span>  <span class="o">|</span> <span class="mf">0.39465</span>  <span class="o">|</span> <span class="mf">0.42802</span> <span class="o">|</span> <span class="mf">0.24507</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span>    <span class="o">|</span> <span class="mi">1175</span> <span class="o">|</span> <span class="mf">0.30057</span>  <span class="o">|</span> <span class="mf">0.46365</span> <span class="o">|</span> <span class="mf">0.26215</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span>    <span class="o">|</span> <span class="mi">5685</span> <span class="o">|</span> <span class="mf">0.23485</span>  <span class="o">|</span> <span class="mf">0.27143</span> <span class="o">|</span> <span class="mf">0.24326</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span>    <span class="o">|</span> <span class="mi">9386</span> <span class="o">|</span> <span class="mf">0.20171</span>  <span class="o">|</span> <span class="mf">0.18887</span> <span class="o">|</span> <span class="mf">0.23872</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">13</span>    <span class="o">|</span> <span class="mi">6880</span> <span class="o">|</span> <span class="mf">0.23494</span>  <span class="o">|</span> <span class="mf">0.23081</span> <span class="o">|</span> <span class="mf">0.23689</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">14</span>    <span class="o">|</span> <span class="mi">1746</span> <span class="o">|</span> <span class="mf">0.31911</span>  <span class="o">|</span> <span class="mf">0.40137</span> <span class="o">|</span> <span class="mf">0.25357</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">15</span>    <span class="o">|</span> <span class="mi">1870</span> <span class="o">|</span> <span class="mf">0.27575</span>  <span class="o">|</span> <span class="mf">0.44911</span> <span class="o">|</span> <span class="mf">0.26334</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">16</span>    <span class="o">|</span> <span class="mi">6321</span> <span class="o">|</span> <span class="mf">0.18338</span>  <span class="o">|</span> <span class="mf">0.21691</span> <span class="o">|</span> <span class="mf">0.21382</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">17</span>    <span class="o">|</span> <span class="mi">7608</span> <span class="o">|</span> <span class="mf">0.14673</span>  <span class="o">|</span> <span class="mf">0.13459</span> <span class="o">|</span> <span class="mf">0.22118</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">18</span>    <span class="o">|</span> <span class="mi">7075</span> <span class="o">|</span> <span class="mf">0.15323</span>  <span class="o">|</span> <span class="mf">0.1772</span>  <span class="o">|</span> <span class="mf">0.20816</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">19</span>    <span class="o">|</span> <span class="mi">2608</span> <span class="o">|</span> <span class="mf">0.27977</span>  <span class="o">|</span> <span class="mf">0.40106</span> <span class="o">|</span> <span class="mf">0.23663</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">20</span>    <span class="o">|</span> <span class="mi">1803</span> <span class="o">|</span> <span class="mf">0.24748</span>  <span class="o">|</span> <span class="mf">0.54944</span> <span class="o">|</span> <span class="mf">0.31271</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">21</span>    <span class="o">|</span> <span class="mi">4249</span> <span class="o">|</span> <span class="mf">0.15151</span>  <span class="o">|</span> <span class="mf">0.21436</span> <span class="o">|</span> <span class="mf">0.18971</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">22</span>    <span class="o">|</span> <span class="mi">3560</span> <span class="o">|</span> <span class="mf">0.11336</span>  <span class="o">|</span> <span class="mf">0.12431</span> <span class="o">|</span> <span class="mf">0.20676</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">23</span>    <span class="o">|</span> <span class="mi">4103</span> <span class="o">|</span> <span class="mf">0.10087</span>  <span class="o">|</span> <span class="mf">0.16239</span> <span class="o">|</span> <span class="mf">0.17534</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">24</span>    <span class="o">|</span> <span class="mi">2271</span> <span class="o">|</span> <span class="mf">0.20061</span>  <span class="o">|</span> <span class="mf">0.46907</span> <span class="o">|</span> <span class="mf">0.24929</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">25</span>    <span class="o">|</span> <span class="mi">476</span>  <span class="o">|</span> <span class="mf">0.26774</span>  <span class="o">|</span> <span class="mf">0.94809</span> <span class="o">|</span> <span class="mf">0.69743</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">26</span>    <span class="o">|</span> <span class="mi">927</span>  <span class="o">|</span> <span class="mf">0.10167</span>  <span class="o">|</span> <span class="mf">0.22193</span> <span class="o">|</span> <span class="mf">0.33398</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">27</span>    <span class="o">|</span> <span class="mi">974</span>  <span class="o">|</span> <span class="mf">0.097735</span> <span class="o">|</span> <span class="mf">0.13559</span> <span class="o">|</span> <span class="mf">0.1876</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">28</span>    <span class="o">|</span> <span class="mi">977</span>  <span class="o">|</span> <span class="mf">0.069491</span> <span class="o">|</span> <span class="mf">0.1907</span>  <span class="o">|</span> <span class="mf">0.29589</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">29</span>    <span class="o">|</span> <span class="mi">549</span>  <span class="o">|</span> <span class="mf">0.19349</span>  <span class="o">|</span> <span class="mf">0.91362</span> <span class="o">|</span> <span class="mf">0.67233</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">30</span>    <span class="o">|</span> <span class="mi">1474</span> <span class="o">|</span> <span class="mf">0.31601</span>  <span class="o">|</span> <span class="mf">0.36268</span> <span class="o">|</span> <span class="mf">0.32879</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">31</span>    <span class="o">|</span> <span class="mi">3209</span> <span class="o">|</span> <span class="mf">0.13728</span>  <span class="o">|</span> <span class="mf">0.15038</span> <span class="o">|</span> <span class="mf">0.18643</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">32</span>    <span class="o">|</span> <span class="mi">2829</span> <span class="o">|</span> <span class="mf">0.10162</span>  <span class="o">|</span> <span class="mf">0.11078</span> <span class="o">|</span> <span class="mf">0.19453</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">33</span>    <span class="o">|</span> <span class="mi">3276</span> <span class="o">|</span> <span class="mf">0.10363</span>  <span class="o">|</span> <span class="mf">0.17357</span> <span class="o">|</span> <span class="mf">0.2043</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">34</span>    <span class="o">|</span> <span class="mi">1951</span> <span class="o">|</span> <span class="mf">0.20521</span>  <span class="o">|</span> <span class="mf">0.4038</span>  <span class="o">|</span> <span class="mf">0.36983</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">35</span>    <span class="o">|</span> <span class="mi">1931</span> <span class="o">|</span> <span class="mf">0.37408</span>  <span class="o">|</span> <span class="mf">0.28915</span> <span class="o">|</span> <span class="mf">0.24379</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">36</span>    <span class="o">|</span> <span class="mi">5869</span> <span class="o">|</span> <span class="mf">0.18862</span>  <span class="o">|</span> <span class="mf">0.14476</span> <span class="o">|</span> <span class="mf">0.1912</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">37</span>    <span class="o">|</span> <span class="mi">5991</span> <span class="o">|</span> <span class="mf">0.13887</span>  <span class="o">|</span> <span class="mf">0.11716</span> <span class="o">|</span> <span class="mf">0.21506</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">38</span>    <span class="o">|</span> <span class="mi">6591</span> <span class="o">|</span> <span class="mf">0.15001</span>  <span class="o">|</span> <span class="mf">0.19861</span> <span class="o">|</span> <span class="mf">0.21179</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">39</span>    <span class="o">|</span> <span class="mi">2763</span> <span class="o">|</span> <span class="mf">0.25238</span>  <span class="o">|</span> <span class="mf">0.36458</span> <span class="o">|</span> <span class="mf">0.26476</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">40</span>    <span class="o">|</span> <span class="mi">1511</span> <span class="o">|</span> <span class="mf">0.47841</span>  <span class="o">|</span> <span class="mf">0.27181</span> <span class="o">|</span> <span class="mf">0.24826</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">41</span>    <span class="o">|</span> <span class="mi">6461</span> <span class="o">|</span> <span class="mf">0.27368</span>  <span class="o">|</span> <span class="mf">0.18468</span> <span class="o">|</span> <span class="mf">0.22587</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">42</span>    <span class="o">|</span> <span class="mi">9213</span> <span class="o">|</span> <span class="mf">0.19848</span>  <span class="o">|</span> <span class="mf">0.15776</span> <span class="o">|</span> <span class="mf">0.22531</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">43</span>    <span class="o">|</span> <span class="mi">7521</span> <span class="o">|</span> <span class="mf">0.21923</span>  <span class="o">|</span> <span class="mf">0.24706</span> <span class="o">|</span> <span class="mf">0.2383</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">44</span>    <span class="o">|</span> <span class="mi">2390</span> <span class="o">|</span> <span class="mf">0.32645</span>  <span class="o">|</span> <span class="mf">0.40052</span> <span class="o">|</span> <span class="mf">0.27085</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">45</span>    <span class="o">|</span> <span class="mi">611</span>  <span class="o">|</span> <span class="mf">0.55212</span>  <span class="o">|</span> <span class="mf">0.29673</span> <span class="o">|</span> <span class="mf">0.26008</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">46</span>    <span class="o">|</span> <span class="mi">4378</span> <span class="o">|</span> <span class="mf">0.38894</span>  <span class="o">|</span> <span class="mf">0.24988</span> <span class="o">|</span> <span class="mf">0.25198</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">47</span>    <span class="o">|</span> <span class="mi">7747</span> <span class="o">|</span> <span class="mf">0.2824</span>   <span class="o">|</span> <span class="mf">0.2289</span>  <span class="o">|</span> <span class="mf">0.24614</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">48</span>    <span class="o">|</span> <span class="mi">5470</span> <span class="o">|</span> <span class="mf">0.29905</span>  <span class="o">|</span> <span class="mf">0.31716</span> <span class="o">|</span> <span class="mf">0.25135</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">49</span>    <span class="o">|</span> <span class="mi">1210</span> <span class="o">|</span> <span class="mf">0.41311</span>  <span class="o">|</span> <span class="mf">0.47572</span> <span class="o">|</span> <span class="mf">0.2691</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">50</span>    <span class="o">|</span> <span class="mi">127</span>  <span class="o">|</span> <span class="mf">0.69191</span>  <span class="o">|</span> <span class="mf">0.39228</span> <span class="o">|</span> <span class="mf">0.2447</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">51</span>    <span class="o">|</span> <span class="mi">2231</span> <span class="o">|</span> <span class="mf">0.47797</span>  <span class="o">|</span> <span class="mf">0.32129</span> <span class="o">|</span> <span class="mf">0.25717</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">52</span>    <span class="o">|</span> <span class="mi">4378</span> <span class="o">|</span> <span class="mf">0.38899</span>  <span class="o">|</span> <span class="mf">0.31331</span> <span class="o">|</span> <span class="mf">0.25676</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">53</span>    <span class="o">|</span> <span class="mi">2758</span> <span class="o">|</span> <span class="mf">0.39246</span>  <span class="o">|</span> <span class="mf">0.40955</span> <span class="o">|</span> <span class="mf">0.26575</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">54</span>    <span class="o">|</span> <span class="mi">327</span>  <span class="o">|</span> <span class="mf">0.48186</span>  <span class="o">|</span> <span class="mf">0.52671</span> <span class="o">|</span> <span class="mf">0.2798</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">56</span>    <span class="o">|</span> <span class="mi">458</span>  <span class="o">|</span> <span class="mf">0.57234</span>  <span class="o">|</span> <span class="mf">0.42803</span> <span class="o">|</span> <span class="mf">0.2643</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">57</span>    <span class="o">|</span> <span class="mi">1507</span> <span class="o">|</span> <span class="mf">0.494</span>    <span class="o">|</span> <span class="mf">0.41177</span> <span class="o">|</span> <span class="mf">0.25741</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">58</span>    <span class="o">|</span> <span class="mi">786</span>  <span class="o">|</span> <span class="mf">0.48028</span>  <span class="o">|</span> <span class="mf">0.48906</span> <span class="o">|</span> <span class="mf">0.26898</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">59</span>    <span class="o">|</span> <span class="mi">40</span>   <span class="o">|</span> <span class="mf">0.39499</span>  <span class="o">|</span> <span class="mf">0.38962</span> <span class="o">|</span> <span class="mf">0.2466</span>   <span class="o">|</span>
<span class="o">------------------------------------------------</span>
<span class="n">Saving</span> <span class="n">refined</span> <span class="n">experiments</span> <span class="n">to</span> <span class="n">refined_experiments_lev1</span><span class="o">.</span><span class="n">json</span>
<span class="n">Saving</span> <span class="n">refined</span> <span class="n">reflections</span> <span class="n">to</span> <span class="n">refined_reflections_lev1</span><span class="o">.</span><span class="n">pickle</span>
</pre></div>
</div>
<p>Following refinement, we repeat the analysis of positional residuals:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">mv</span> <span class="n">analysis</span> <span class="n">analysis_lev0</span>
<span class="n">dials</span><span class="o">.</span><span class="n">analyse_output</span> <span class="n">refined_reflections</span><span class="o">.</span><span class="n">pickle</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span>
<span class="n">mv</span> <span class="n">analysis</span> <span class="n">analysis_lev1</span>
</pre></div>
</div>
<p>The positional residual plots for X and Y,
<code class="file docutils literal"><span class="pre">analysis_lev1/centroid/centroid_diff_x.png</span></code>
and <code class="file docutils literal"><span class="pre">analysis_lev1/centroid/centroid_diff_y.png</span></code> make it clear that
despite poor coverage on some panels, the systematic shifts have been cleaned
up by the refinement job.</p>
<blockquote>
<div><img alt="../../_images/centroid_diff_x_multi_panel_lev1.png" src="../../_images/centroid_diff_x_multi_panel_lev1.png" />
<img alt="../../_images/centroid_diff_y_multi_panel_lev1.png" src="../../_images/centroid_diff_y_multi_panel_lev1.png" />
</div></blockquote>
</div>
<div class="section" id="applying-the-corrected-metrology">
<h2>Applying the corrected metrology<a class="headerlink" href="#applying-the-corrected-metrology" title="Permalink to this headline">¶</a></h2>
<p>Although we have corrected for small shifts and rotations apparently present from
spot positions recorded in one dataset, what we would really like to do is apply
these corrections to a different dataset. Short of rewriting the <strong class="program">dxtbx</strong>
Format object for the detector to incorporate the corrections, we could try to
&#8216;copy and paste&#8217; the detector from one dataset to the other.</p>
<p>We will choose the standard tutorial data to try this, from the
<a class="reference internal" href="processing_in_detail_tutorial.html"><span class="doc">Processing in Detail</span></a>. First we have to process that data using the
multi-panel version of the Pilatus P6M detector model. Assuming the environment
variable <code class="samp docutils literal"><span class="pre">P6M_60_PANEL=1</span></code> is set in this terminal we just need to repeat
the commands from the tutorial:</p>
<div class="highlight-default"><div class="highlight"><pre>mkdir tutorial_data
cd !$
dials.import /path/to/th_8_2*cbf
dials.find_spots datablock.json nproc=4
dials.index datablock.json strong.pickle space_group=&quot;P4&quot;
dials.refine experiments.json indexed.pickle outlier.algorithm=tukey use_all_reflections=true bin_size_fraction=0.0
</pre></div>
</div>
<p>Note these are the overall RMSDs (comparable to the results from the
<a class="reference internal" href="processing_in_detail_tutorial.html"><span class="doc">Processing in Detail</span></a>, as we&#8217;d expect):</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">53916</span> <span class="o">|</span> <span class="mf">0.26341</span> <span class="o">|</span> <span class="mf">0.21858</span> <span class="o">|</span> <span class="mf">0.106</span>    <span class="o">|</span>
<span class="o">----------------------------------------------</span>
</pre></div>
</div>
<p>Now we do the scan-varying refinement and integrate:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">tukey</span> <span class="n">use_all_reflections</span><span class="o">=</span><span class="n">true</span> <span class="n">bin_size_fraction</span><span class="o">=</span><span class="mf">0.0</span> <span class="n">scan_varying</span><span class="o">=</span><span class="n">true</span> <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">sv_refined_experiments</span><span class="o">.</span><span class="n">json</span>
<span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">sv_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">null</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">4</span>
<span class="n">dials</span><span class="o">.</span><span class="n">export</span> <span class="n">integrated</span><span class="o">.</span><span class="n">pickle</span> <span class="n">sv_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">mtz</span><span class="o">.</span><span class="n">hklout</span><span class="o">=</span><span class="n">integrated</span><span class="o">.</span><span class="n">mtz</span> <span class="n">ignore_panels</span><span class="o">=</span><span class="n">true</span>
<span class="n">dials</span><span class="o">.</span><span class="n">analyse_output</span> <span class="n">integrated</span><span class="o">.</span><span class="n">pickle</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span>
</pre></div>
</div>
<p>From the end of <code class="file docutils literal"><span class="pre">dials.integrate.log</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">Summary</span> <span class="n">of</span> <span class="n">integration</span> <span class="n">results</span> <span class="n">binned</span> <span class="n">by</span> <span class="n">resolution</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>
<span class="n">d</span> <span class="nb">min</span> <span class="o">|</span>  <span class="n">d</span> <span class="nb">max</span> <span class="o">|</span> <span class="c"># full | # part | # over | # ice | # sum | # prf | &lt;Ibg&gt; | &lt;I/sigI&gt; | &lt;I/sigI&gt; | &lt;CC prf&gt;</span>
      <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>    <span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">|</span>    <span class="p">(</span><span class="n">prf</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>
 <span class="mf">1.17</span> <span class="o">|</span>   <span class="mf">1.19</span> <span class="o">|</span>    <span class="mi">324</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>   <span class="mi">327</span> <span class="o">|</span>   <span class="mi">260</span> <span class="o">|</span>  <span class="mf">0.04</span> <span class="o">|</span>     <span class="mf">0.37</span> <span class="o">|</span>     <span class="mf">0.54</span> <span class="o">|</span>     <span class="mf">0.11</span>
 <span class="mf">1.19</span> <span class="o">|</span>   <span class="mf">1.21</span> <span class="o">|</span>   <span class="mi">1093</span> <span class="o">|</span>      <span class="mi">7</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">1100</span> <span class="o">|</span>   <span class="mi">984</span> <span class="o">|</span>  <span class="mf">0.04</span> <span class="o">|</span>     <span class="mf">0.43</span> <span class="o">|</span>     <span class="mf">0.54</span> <span class="o">|</span>     <span class="mf">0.09</span>
 <span class="mf">1.21</span> <span class="o">|</span>   <span class="mf">1.23</span> <span class="o">|</span>   <span class="mi">2317</span> <span class="o">|</span>     <span class="mi">14</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">2331</span> <span class="o">|</span>  <span class="mi">2138</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.48</span> <span class="o">|</span>     <span class="mf">0.57</span> <span class="o">|</span>     <span class="mf">0.10</span>
 <span class="mf">1.23</span> <span class="o">|</span>   <span class="mf">1.26</span> <span class="o">|</span>   <span class="mi">3776</span> <span class="o">|</span>     <span class="mi">27</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">3803</span> <span class="o">|</span>  <span class="mi">3581</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.53</span> <span class="o">|</span>     <span class="mf">0.66</span> <span class="o">|</span>     <span class="mf">0.12</span>
 <span class="mf">1.26</span> <span class="o">|</span>   <span class="mf">1.28</span> <span class="o">|</span>   <span class="mi">5416</span> <span class="o">|</span>     <span class="mi">34</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">5450</span> <span class="o">|</span>  <span class="mi">5100</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.59</span> <span class="o">|</span>     <span class="mf">0.74</span> <span class="o">|</span>     <span class="mf">0.14</span>
 <span class="mf">1.28</span> <span class="o">|</span>   <span class="mf">1.31</span> <span class="o">|</span>   <span class="mi">7235</span> <span class="o">|</span>     <span class="mi">54</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">7289</span> <span class="o">|</span>  <span class="mi">6806</span> <span class="o">|</span>  <span class="mf">0.06</span> <span class="o">|</span>     <span class="mf">0.64</span> <span class="o">|</span>     <span class="mf">0.81</span> <span class="o">|</span>     <span class="mf">0.16</span>
 <span class="mf">1.31</span> <span class="o">|</span>   <span class="mf">1.35</span> <span class="o">|</span>   <span class="mi">9504</span> <span class="o">|</span>     <span class="mi">63</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">9567</span> <span class="o">|</span>  <span class="mi">8952</span> <span class="o">|</span>  <span class="mf">0.06</span> <span class="o">|</span>     <span class="mf">0.77</span> <span class="o">|</span>     <span class="mf">0.95</span> <span class="o">|</span>     <span class="mf">0.19</span>
 <span class="mf">1.35</span> <span class="o">|</span>   <span class="mf">1.38</span> <span class="o">|</span>  <span class="mi">12495</span> <span class="o">|</span>     <span class="mi">87</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">12582</span> <span class="o">|</span> <span class="mi">11826</span> <span class="o">|</span>  <span class="mf">0.07</span> <span class="o">|</span>     <span class="mf">0.90</span> <span class="o">|</span>     <span class="mf">1.11</span> <span class="o">|</span>     <span class="mf">0.21</span>
 <span class="mf">1.38</span> <span class="o">|</span>   <span class="mf">1.42</span> <span class="o">|</span>  <span class="mi">16967</span> <span class="o">|</span>    <span class="mi">111</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">17078</span> <span class="o">|</span> <span class="mi">16125</span> <span class="o">|</span>  <span class="mf">0.08</span> <span class="o">|</span>     <span class="mf">0.98</span> <span class="o">|</span>     <span class="mf">1.20</span> <span class="o">|</span>     <span class="mf">0.23</span>
 <span class="mf">1.42</span> <span class="o">|</span>   <span class="mf">1.47</span> <span class="o">|</span>  <span class="mi">20187</span> <span class="o">|</span>    <span class="mi">153</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">20340</span> <span class="o">|</span> <span class="mi">19437</span> <span class="o">|</span>  <span class="mf">0.08</span> <span class="o">|</span>     <span class="mf">1.20</span> <span class="o">|</span>     <span class="mf">1.43</span> <span class="o">|</span>     <span class="mf">0.27</span>
 <span class="mf">1.47</span> <span class="o">|</span>   <span class="mf">1.52</span> <span class="o">|</span>  <span class="mi">23623</span> <span class="o">|</span>    <span class="mi">258</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">23881</span> <span class="o">|</span> <span class="mi">22761</span> <span class="o">|</span>  <span class="mf">0.09</span> <span class="o">|</span>     <span class="mf">1.47</span> <span class="o">|</span>     <span class="mf">1.71</span> <span class="o">|</span>     <span class="mf">0.30</span>
 <span class="mf">1.52</span> <span class="o">|</span>   <span class="mf">1.58</span> <span class="o">|</span>  <span class="mi">24126</span> <span class="o">|</span>    <span class="mi">271</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">24397</span> <span class="o">|</span> <span class="mi">23289</span> <span class="o">|</span>  <span class="mf">0.10</span> <span class="o">|</span>     <span class="mf">1.75</span> <span class="o">|</span>     <span class="mf">2.03</span> <span class="o">|</span>     <span class="mf">0.35</span>
 <span class="mf">1.58</span> <span class="o">|</span>   <span class="mf">1.66</span> <span class="o">|</span>  <span class="mi">25506</span> <span class="o">|</span>    <span class="mi">281</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25787</span> <span class="o">|</span> <span class="mi">24863</span> <span class="o">|</span>  <span class="mf">0.11</span> <span class="o">|</span>     <span class="mf">2.17</span> <span class="o">|</span>     <span class="mf">2.46</span> <span class="o">|</span>     <span class="mf">0.41</span>
 <span class="mf">1.66</span> <span class="o">|</span>   <span class="mf">1.74</span> <span class="o">|</span>  <span class="mi">24269</span> <span class="o">|</span>    <span class="mi">241</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">24510</span> <span class="o">|</span> <span class="mi">23389</span> <span class="o">|</span>  <span class="mf">0.12</span> <span class="o">|</span>     <span class="mf">2.71</span> <span class="o">|</span>     <span class="mf">3.01</span> <span class="o">|</span>     <span class="mf">0.46</span>
 <span class="mf">1.74</span> <span class="o">|</span>   <span class="mf">1.85</span> <span class="o">|</span>  <span class="mi">24780</span> <span class="o">|</span>    <span class="mi">238</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25018</span> <span class="o">|</span> <span class="mi">24019</span> <span class="o">|</span>  <span class="mf">0.15</span> <span class="o">|</span>     <span class="mf">3.50</span> <span class="o">|</span>     <span class="mf">3.82</span> <span class="o">|</span>     <span class="mf">0.52</span>
 <span class="mf">1.85</span> <span class="o">|</span>   <span class="mf">2.00</span> <span class="o">|</span>  <span class="mi">25710</span> <span class="o">|</span>    <span class="mi">278</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25988</span> <span class="o">|</span> <span class="mi">25059</span> <span class="o">|</span>  <span class="mf">0.19</span> <span class="o">|</span>     <span class="mf">4.87</span> <span class="o">|</span>     <span class="mf">5.20</span> <span class="o">|</span>     <span class="mf">0.59</span>
 <span class="mf">2.00</span> <span class="o">|</span>   <span class="mf">2.20</span> <span class="o">|</span>  <span class="mi">24757</span> <span class="o">|</span>    <span class="mi">274</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25031</span> <span class="o">|</span> <span class="mi">24000</span> <span class="o">|</span>  <span class="mf">0.26</span> <span class="o">|</span>     <span class="mf">6.58</span> <span class="o">|</span>     <span class="mf">6.94</span> <span class="o">|</span>     <span class="mf">0.66</span>
 <span class="mf">2.20</span> <span class="o">|</span>   <span class="mf">2.51</span> <span class="o">|</span>  <span class="mi">25673</span> <span class="o">|</span>    <span class="mi">252</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25925</span> <span class="o">|</span> <span class="mi">25119</span> <span class="o">|</span>  <span class="mf">0.29</span> <span class="o">|</span>     <span class="mf">8.84</span> <span class="o">|</span>     <span class="mf">9.15</span> <span class="o">|</span>     <span class="mf">0.69</span>
 <span class="mf">2.51</span> <span class="o">|</span>   <span class="mf">3.17</span> <span class="o">|</span>  <span class="mi">25214</span> <span class="o">|</span>    <span class="mi">297</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25511</span> <span class="o">|</span> <span class="mi">24607</span> <span class="o">|</span>  <span class="mf">0.37</span> <span class="o">|</span>    <span class="mf">12.78</span> <span class="o">|</span>    <span class="mf">13.01</span> <span class="o">|</span>     <span class="mf">0.73</span>
 <span class="mf">3.17</span> <span class="o">|</span> <span class="mf">151.26</span> <span class="o">|</span>  <span class="mi">25766</span> <span class="o">|</span>    <span class="mi">303</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">26069</span> <span class="o">|</span> <span class="mi">25226</span> <span class="o">|</span>  <span class="mf">0.45</span> <span class="o">|</span>    <span class="mf">25.48</span> <span class="o">|</span>    <span class="mf">25.36</span> <span class="o">|</span>     <span class="mf">0.74</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">integration</span> <span class="n">results</span> <span class="k">for</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">dataset</span>
<span class="o">----------------------------------------------</span>
<span class="n">Number</span> <span class="n">fully</span> <span class="n">recorded</span>                 <span class="o">|</span> <span class="mi">338720</span>
<span class="n">Number</span> <span class="n">partially</span> <span class="n">recorded</span>             <span class="o">|</span> <span class="mi">4747</span>
<span class="n">Number</span> <span class="k">with</span> <span class="n">overloaded</span> <span class="n">pixels</span>         <span class="o">|</span> <span class="mi">0</span>
<span class="n">Number</span> <span class="ow">in</span> <span class="n">powder</span> <span class="n">rings</span>                <span class="o">|</span> <span class="mi">0</span>
<span class="n">Number</span> <span class="n">processed</span> <span class="k">with</span> <span class="n">summation</span>       <span class="o">|</span> <span class="mi">331984</span>
<span class="n">Number</span> <span class="n">processed</span> <span class="k">with</span> <span class="n">profile</span> <span class="n">fitting</span> <span class="o">|</span> <span class="mi">317541</span>
<span class="o">&lt;</span><span class="n">Ibg</span><span class="o">&gt;</span>                                 <span class="o">|</span> <span class="mf">0.18</span>
<span class="o">&lt;</span><span class="n">I</span><span class="o">/</span><span class="n">sigI</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">summation</span><span class="p">)</span>                  <span class="o">|</span> <span class="mf">5.63</span>
<span class="o">&lt;</span><span class="n">I</span><span class="o">/</span><span class="n">sigI</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">profile</span> <span class="n">fitting</span><span class="p">)</span>            <span class="o">|</span> <span class="mf">5.92</span>
<span class="o">&lt;</span><span class="n">CC</span> <span class="n">prf</span><span class="o">&gt;</span>                              <span class="o">|</span> <span class="mf">0.43</span>
<span class="o">----------------------------------------------</span>
</pre></div>
</div>
<p>The plot of correlations between strong (reference) reflections and the profiles
used to fit them shows up the systematic effects of uncorrected tile shifts and
misorientations:</p>
<blockquote>
<div><img alt="../../_images/reference_corr_vs_xy_multipanel_uncorrected.png" src="../../_images/reference_corr_vs_xy_multipanel_uncorrected.png" />
</div></blockquote>
<p>Now, how can we apply the metrology? Here we will use <strong class="program">dials.combine_experiments</strong>
with the <code class="samp docutils literal"><span class="pre">reference_from_experiment.detector</span></code> option to overwrite the detector
model from our <code class="file docutils literal"><span class="pre">experiments.json</span></code>. We don&#8217;t really want the combined experiments
file, only this side-effect, so we immediately split it again:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">combine_experiments</span> <span class="n">experiments</span><span class="o">=../</span><span class="n">refined_experiments_lev1</span><span class="o">.</span><span class="n">json</span> <span class="n">experiments</span><span class="o">=</span><span class="n">refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">reflections</span><span class="o">=../</span><span class="n">refined_reflections_lev1</span><span class="o">.</span><span class="n">pickle</span> <span class="n">reflections</span><span class="o">=</span><span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">reference_from_experiment</span><span class="o">.</span><span class="n">detector</span><span class="o">=</span><span class="mi">0</span>
<span class="n">dials</span><span class="o">.</span><span class="n">split_experiments</span> <span class="n">combined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">combined_reflections</span><span class="o">.</span><span class="n">pickle</span>
</pre></div>
</div>
<p>This results in a few files, of which <code class="file docutils literal"><span class="pre">experiments_1.json</span></code> is interesting.
It contains the updated detector - but beware the detector distance is now
completely wrong! It is at about 400 mm rather than 265 mm. We could correct that
by editing <code class="file docutils literal"><span class="pre">experiments_1.json</span></code> directly, but actually there is no need.
<strong class="program">dials.refine</strong> is <em>extremely forgiving</em> of bad starting geometry, though
we should remember to fix the beam and crystal models:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">experiments_1</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">beam</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="nb">all</span> <span class="n">crystal</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="nb">all</span>
</pre></div>
</div>
<p>A snippet from the log file shows that the detector distance offset was largely
corrected in a single step:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">Refinement</span> <span class="n">steps</span><span class="p">:</span>
<span class="o">------------------------------------------------</span>
<span class="o">|</span> <span class="n">Step</span> <span class="o">|</span> <span class="n">Nref</span> <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Phi</span> <span class="o">|</span>
<span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">------------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>    <span class="o">|</span> <span class="mi">4049</span> <span class="o">|</span> <span class="mf">40.622</span>   <span class="o">|</span> <span class="mf">40.688</span>   <span class="o">|</span> <span class="mf">0.019202</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">4049</span> <span class="o">|</span> <span class="mf">0.28874</span>  <span class="o">|</span> <span class="mf">0.30251</span>  <span class="o">|</span> <span class="mf">0.019202</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="mi">4049</span> <span class="o">|</span> <span class="mf">0.045937</span> <span class="o">|</span> <span class="mf">0.045205</span> <span class="o">|</span> <span class="mf">0.019202</span> <span class="o">|</span>
<span class="o">------------------------------------------------</span>
</pre></div>
</div>
<p>Now we&#8217;ll let the crystal and beam refine along with the new detector to RMSD convergence:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">tukey</span> <span class="n">use_all_reflections</span><span class="o">=</span><span class="n">true</span> <span class="n">bin_size_fraction</span><span class="o">=</span><span class="mf">0.0</span> <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Here is the output:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">The</span> <span class="n">following</span> <span class="n">parameters</span> <span class="n">have</span> <span class="n">been</span> <span class="n">modified</span><span class="p">:</span>

<span class="n">output</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span>
<span class="p">}</span>
<span class="n">refinement</span> <span class="p">{</span>
  <span class="n">target</span> <span class="p">{</span>
    <span class="n">bin_size_fraction</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="p">}</span>
  <span class="n">reflections</span> <span class="p">{</span>
    <span class="n">use_all_reflections</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">outlier</span> <span class="p">{</span>
      <span class="n">algorithm</span> <span class="o">=</span> <span class="n">null</span> <span class="o">*</span><span class="n">tukey</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nb">input</span> <span class="p">{</span>
  <span class="n">experiments</span> <span class="o">=</span> <span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span>
  <span class="n">reflections</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span>
<span class="p">}</span>

<span class="n">Configuring</span> <span class="n">refiner</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">-------------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>     <span class="o">|</span> <span class="n">Q1</span>       <span class="o">|</span> <span class="n">Med</span>       <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>    <span class="o">|</span>
<span class="o">-------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.4701</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.02988</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.01025</span>  <span class="o">|</span> <span class="mf">0.02159</span> <span class="o">|</span> <span class="mf">0.6902</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.7267</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.02846</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.005739</span> <span class="o">|</span> <span class="mf">0.02339</span> <span class="o">|</span> <span class="mf">1.247</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">1.409</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.01035</span> <span class="o">|</span> <span class="mf">5.562e-05</span> <span class="o">|</span> <span class="mf">0.01104</span> <span class="o">|</span> <span class="mf">0.4029</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">113.5</span>   <span class="o">|</span> <span class="mf">133.7</span>    <span class="o">|</span> <span class="mf">134.5</span>     <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">109.2</span>   <span class="o">|</span> <span class="mf">133.4</span>    <span class="o">|</span> <span class="mf">134.5</span>     <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">155.5</span>   <span class="o">|</span> <span class="mf">175.8</span>    <span class="o">|</span> <span class="mi">177</span>       <span class="o">|</span> <span class="mf">177.5</span>   <span class="o">|</span> <span class="mf">177.8</span>  <span class="o">|</span>
<span class="o">-------------------------------------------------------------------------</span>

<span class="mi">2382</span> <span class="n">reflections</span> <span class="n">have</span> <span class="n">been</span> <span class="n">rejected</span> <span class="k">as</span> <span class="n">outliers</span>

<span class="n">Summary</span> <span class="n">statistics</span> <span class="k">for</span> <span class="n">observations</span> <span class="n">matched</span> <span class="n">to</span> <span class="n">predictions</span><span class="p">:</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span>                   <span class="o">|</span> <span class="n">Min</span>     <span class="o">|</span> <span class="n">Q1</span>        <span class="o">|</span> <span class="n">Med</span>       <span class="o">|</span> <span class="n">Q3</span>      <span class="o">|</span> <span class="n">Max</span>    <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>
<span class="o">|</span> <span class="n">Xc</span> <span class="o">-</span> <span class="n">Xo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.1148</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.02997</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.01092</span>  <span class="o">|</span> <span class="mf">0.01966</span> <span class="o">|</span> <span class="mf">0.331</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Yc</span> <span class="o">-</span> <span class="n">Yo</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>      <span class="o">|</span> <span class="o">-</span><span class="mf">0.1397</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.02791</span>  <span class="o">|</span> <span class="o">-</span><span class="mf">0.005742</span> <span class="o">|</span> <span class="mf">0.02263</span> <span class="o">|</span> <span class="mf">0.2531</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Phic</span> <span class="o">-</span> <span class="n">Phio</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.1881</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.009998</span> <span class="o">|</span> <span class="mf">0.0001419</span> <span class="o">|</span> <span class="mf">0.0109</span>  <span class="o">|</span> <span class="mf">0.1176</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">X</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">113.5</span>   <span class="o">|</span> <span class="mf">133.7</span>     <span class="o">|</span> <span class="mf">134.6</span>     <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Y</span> <span class="n">weights</span>         <span class="o">|</span> <span class="mf">109.9</span>   <span class="o">|</span> <span class="mf">133.5</span>     <span class="o">|</span> <span class="mf">134.5</span>     <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mf">135.2</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Phi</span> <span class="n">weights</span>       <span class="o">|</span> <span class="mf">158.2</span>   <span class="o">|</span> <span class="mf">175.9</span>     <span class="o">|</span> <span class="mi">177</span>       <span class="o">|</span> <span class="mf">177.5</span>   <span class="o">|</span> <span class="mf">177.8</span>  <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------</span>

<span class="n">Performing</span> <span class="n">refinement</span><span class="o">...</span>

<span class="n">Refinement</span> <span class="n">steps</span><span class="p">:</span>
<span class="o">-------------------------------------------------</span>
<span class="o">|</span> <span class="n">Step</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Phi</span> <span class="o">|</span>
<span class="o">|</span>      <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">-------------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.04524</span>  <span class="o">|</span> <span class="mf">0.04251</span>  <span class="o">|</span> <span class="mf">0.015875</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">1</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.043495</span> <span class="o">|</span> <span class="mf">0.041514</span> <span class="o">|</span> <span class="mf">0.015395</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">2</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.042657</span> <span class="o">|</span> <span class="mf">0.040762</span> <span class="o">|</span> <span class="mf">0.01535</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">3</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.040455</span> <span class="o">|</span> <span class="mf">0.038826</span> <span class="o">|</span> <span class="mf">0.015287</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">4</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.0356</span>   <span class="o">|</span> <span class="mf">0.034575</span> <span class="o">|</span> <span class="mf">0.015251</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.028146</span> <span class="o">|</span> <span class="mf">0.027998</span> <span class="o">|</span> <span class="mf">0.015246</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.021919</span> <span class="o">|</span> <span class="mf">0.022913</span> <span class="o">|</span> <span class="mf">0.015245</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.019867</span> <span class="o">|</span> <span class="mf">0.021931</span> <span class="o">|</span> <span class="mf">0.015256</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.019579</span> <span class="o">|</span> <span class="mf">0.02202</span>  <span class="o">|</span> <span class="mf">0.015267</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">9</span>    <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.019553</span> <span class="o">|</span> <span class="mf">0.02204</span>  <span class="o">|</span> <span class="mf">0.015269</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span>   <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.019552</span> <span class="o">|</span> <span class="mf">0.022041</span> <span class="o">|</span> <span class="mf">0.015269</span> <span class="o">|</span>
<span class="o">-------------------------------------------------</span>
<span class="n">RMSD</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">decreasing</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.11368</span> <span class="o">|</span> <span class="mf">0.12815</span> <span class="o">|</span> <span class="mf">0.10179</span>  <span class="o">|</span>
<span class="o">----------------------------------------------</span>

<span class="n">RMSDs</span> <span class="n">by</span> <span class="n">panel</span><span class="p">:</span>
<span class="o">-------------------------------------------------</span>
<span class="o">|</span> <span class="n">Panel</span> <span class="o">|</span> <span class="n">Nref</span> <span class="o">|</span> <span class="n">RMSD_X</span>   <span class="o">|</span> <span class="n">RMSD_Y</span>   <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>     <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">-------------------------------------------------</span>
<span class="o">|</span> <span class="mi">2</span>     <span class="o">|</span> <span class="mi">18</span>   <span class="o">|</span> <span class="mf">0.18212</span>  <span class="o">|</span> <span class="mf">0.28586</span>  <span class="o">|</span> <span class="mf">0.12145</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">6</span>     <span class="o">|</span> <span class="mi">125</span>  <span class="o">|</span> <span class="mf">0.15295</span>  <span class="o">|</span> <span class="mf">0.24972</span>  <span class="o">|</span> <span class="mf">0.12934</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">7</span>     <span class="o">|</span> <span class="mi">609</span>  <span class="o">|</span> <span class="mf">0.1286</span>   <span class="o">|</span> <span class="mf">0.21324</span>  <span class="o">|</span> <span class="mf">0.12291</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">8</span>     <span class="o">|</span> <span class="mi">265</span>  <span class="o">|</span> <span class="mf">0.1243</span>   <span class="o">|</span> <span class="mf">0.21443</span>  <span class="o">|</span> <span class="mf">0.10878</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span>    <span class="o">|</span> <span class="mi">1189</span> <span class="o">|</span> <span class="mf">0.14339</span>  <span class="o">|</span> <span class="mf">0.19084</span>  <span class="o">|</span> <span class="mf">0.10244</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span>    <span class="o">|</span> <span class="mi">2389</span> <span class="o">|</span> <span class="mf">0.097393</span> <span class="o">|</span> <span class="mf">0.16185</span>  <span class="o">|</span> <span class="mf">0.1081</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">13</span>    <span class="o">|</span> <span class="mi">1550</span> <span class="o">|</span> <span class="mf">0.084417</span> <span class="o">|</span> <span class="mf">0.14168</span>  <span class="o">|</span> <span class="mf">0.098364</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">14</span>    <span class="o">|</span> <span class="mi">148</span>  <span class="o">|</span> <span class="mf">0.14653</span>  <span class="o">|</span> <span class="mf">0.17253</span>  <span class="o">|</span> <span class="mf">0.11116</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">15</span>    <span class="o">|</span> <span class="mi">254</span>  <span class="o">|</span> <span class="mf">0.21387</span>  <span class="o">|</span> <span class="mf">0.15463</span>  <span class="o">|</span> <span class="mf">0.10746</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">16</span>    <span class="o">|</span> <span class="mi">2728</span> <span class="o">|</span> <span class="mf">0.11345</span>  <span class="o">|</span> <span class="mf">0.15427</span>  <span class="o">|</span> <span class="mf">0.081722</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">17</span>    <span class="o">|</span> <span class="mi">4265</span> <span class="o">|</span> <span class="mf">0.060489</span> <span class="o">|</span> <span class="mf">0.1104</span>   <span class="o">|</span> <span class="mf">0.096919</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">18</span>    <span class="o">|</span> <span class="mi">2952</span> <span class="o">|</span> <span class="mf">0.07167</span>  <span class="o">|</span> <span class="mf">0.092076</span> <span class="o">|</span> <span class="mf">0.093342</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">19</span>    <span class="o">|</span> <span class="mi">565</span>  <span class="o">|</span> <span class="mf">0.1626</span>   <span class="o">|</span> <span class="mf">0.11391</span>  <span class="o">|</span> <span class="mf">0.11975</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">20</span>    <span class="o">|</span> <span class="mi">534</span>  <span class="o">|</span> <span class="mf">0.18454</span>  <span class="o">|</span> <span class="mf">0.16728</span>  <span class="o">|</span> <span class="mf">0.16016</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">21</span>    <span class="o">|</span> <span class="mi">2772</span> <span class="o">|</span> <span class="mf">0.092555</span> <span class="o">|</span> <span class="mf">0.12647</span>  <span class="o">|</span> <span class="mf">0.076534</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">22</span>    <span class="o">|</span> <span class="mi">2873</span> <span class="o">|</span> <span class="mf">0.047736</span> <span class="o">|</span> <span class="mf">0.10398</span>  <span class="o">|</span> <span class="mf">0.090391</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">23</span>    <span class="o">|</span> <span class="mi">2686</span> <span class="o">|</span> <span class="mf">0.063075</span> <span class="o">|</span> <span class="mf">0.074814</span> <span class="o">|</span> <span class="mf">0.075038</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">24</span>    <span class="o">|</span> <span class="mi">729</span>  <span class="o">|</span> <span class="mf">0.16869</span>  <span class="o">|</span> <span class="mf">0.11128</span>  <span class="o">|</span> <span class="mf">0.14306</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">25</span>    <span class="o">|</span> <span class="mi">119</span>  <span class="o">|</span> <span class="mf">0.81495</span>  <span class="o">|</span> <span class="mf">0.29087</span>  <span class="o">|</span> <span class="mf">0.44711</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">26</span>    <span class="o">|</span> <span class="mi">406</span>  <span class="o">|</span> <span class="mf">0.080441</span> <span class="o">|</span> <span class="mf">0.12121</span>  <span class="o">|</span> <span class="mf">0.098888</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">27</span>    <span class="o">|</span> <span class="mi">425</span>  <span class="o">|</span> <span class="mf">0.052654</span> <span class="o">|</span> <span class="mf">0.15365</span>  <span class="o">|</span> <span class="mf">0.0754</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">28</span>    <span class="o">|</span> <span class="mi">364</span>  <span class="o">|</span> <span class="mf">0.06931</span>  <span class="o">|</span> <span class="mf">0.066238</span> <span class="o">|</span> <span class="mf">0.073655</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">29</span>    <span class="o">|</span> <span class="mi">100</span>  <span class="o">|</span> <span class="mf">0.85448</span>  <span class="o">|</span> <span class="mf">0.22713</span>  <span class="o">|</span> <span class="mf">0.24889</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">30</span>    <span class="o">|</span> <span class="mi">579</span>  <span class="o">|</span> <span class="mf">0.21735</span>  <span class="o">|</span> <span class="mf">0.11564</span>  <span class="o">|</span> <span class="mf">0.18439</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">31</span>    <span class="o">|</span> <span class="mi">1994</span> <span class="o">|</span> <span class="mf">0.061756</span> <span class="o">|</span> <span class="mf">0.09509</span>  <span class="o">|</span> <span class="mf">0.068866</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">32</span>    <span class="o">|</span> <span class="mi">1924</span> <span class="o">|</span> <span class="mf">0.091952</span> <span class="o">|</span> <span class="mf">0.11146</span>  <span class="o">|</span> <span class="mf">0.083513</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">33</span>    <span class="o">|</span> <span class="mi">2166</span> <span class="o">|</span> <span class="mf">0.088252</span> <span class="o">|</span> <span class="mf">0.10009</span>  <span class="o">|</span> <span class="mf">0.085247</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">34</span>    <span class="o">|</span> <span class="mi">519</span>  <span class="o">|</span> <span class="mf">0.13737</span>  <span class="o">|</span> <span class="mf">0.16646</span>  <span class="o">|</span> <span class="mf">0.1872</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">35</span>    <span class="o">|</span> <span class="mi">634</span>  <span class="o">|</span> <span class="mf">0.16379</span>  <span class="o">|</span> <span class="mf">0.093519</span> <span class="o">|</span> <span class="mf">0.12164</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">36</span>    <span class="o">|</span> <span class="mi">2835</span> <span class="o">|</span> <span class="mf">0.067371</span> <span class="o">|</span> <span class="mf">0.080697</span> <span class="o">|</span> <span class="mf">0.081958</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">37</span>    <span class="o">|</span> <span class="mi">3737</span> <span class="o">|</span> <span class="mf">0.094318</span> <span class="o">|</span> <span class="mf">0.086918</span> <span class="o">|</span> <span class="mf">0.10408</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">38</span>    <span class="o">|</span> <span class="mi">2806</span> <span class="o">|</span> <span class="mf">0.098988</span> <span class="o">|</span> <span class="mf">0.13001</span>  <span class="o">|</span> <span class="mf">0.082836</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">39</span>    <span class="o">|</span> <span class="mi">417</span>  <span class="o">|</span> <span class="mf">0.17099</span>  <span class="o">|</span> <span class="mf">0.18814</span>  <span class="o">|</span> <span class="mf">0.12774</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">40</span>    <span class="o">|</span> <span class="mi">227</span>  <span class="o">|</span> <span class="mf">0.20834</span>  <span class="o">|</span> <span class="mf">0.14785</span>  <span class="o">|</span> <span class="mf">0.10324</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">41</span>    <span class="o">|</span> <span class="mi">1817</span> <span class="o">|</span> <span class="mf">0.082715</span> <span class="o">|</span> <span class="mf">0.1174</span>   <span class="o">|</span> <span class="mf">0.10219</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">42</span>    <span class="o">|</span> <span class="mi">2385</span> <span class="o">|</span> <span class="mf">0.1096</span>   <span class="o">|</span> <span class="mf">0.12543</span>  <span class="o">|</span> <span class="mf">0.10965</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">43</span>    <span class="o">|</span> <span class="mi">1589</span> <span class="o">|</span> <span class="mf">0.12167</span>  <span class="o">|</span> <span class="mf">0.17861</span>  <span class="o">|</span> <span class="mf">0.099929</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">44</span>    <span class="o">|</span> <span class="mi">88</span>   <span class="o">|</span> <span class="mf">0.21088</span>  <span class="o">|</span> <span class="mf">0.2111</span>   <span class="o">|</span> <span class="mf">0.10221</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">45</span>    <span class="o">|</span> <span class="mi">28</span>   <span class="o">|</span> <span class="mf">0.19222</span>  <span class="o">|</span> <span class="mf">0.16491</span>  <span class="o">|</span> <span class="mf">0.16288</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">46</span>    <span class="o">|</span> <span class="mi">472</span>  <span class="o">|</span> <span class="mf">0.094714</span> <span class="o">|</span> <span class="mf">0.15589</span>  <span class="o">|</span> <span class="mf">0.1232</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">47</span>    <span class="o">|</span> <span class="mi">1047</span> <span class="o">|</span> <span class="mf">0.11775</span>  <span class="o">|</span> <span class="mf">0.17961</span>  <span class="o">|</span> <span class="mf">0.12234</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">48</span>    <span class="o">|</span> <span class="mi">307</span>  <span class="o">|</span> <span class="mf">0.12735</span>  <span class="o">|</span> <span class="mf">0.22443</span>  <span class="o">|</span> <span class="mf">0.11915</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">51</span>    <span class="o">|</span> <span class="mi">22</span>   <span class="o">|</span> <span class="mf">0.11972</span>  <span class="o">|</span> <span class="mf">0.18238</span>  <span class="o">|</span> <span class="mf">0.11037</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">52</span>    <span class="o">|</span> <span class="mi">80</span>   <span class="o">|</span> <span class="mf">0.12845</span>  <span class="o">|</span> <span class="mf">0.24552</span>  <span class="o">|</span> <span class="mf">0.1396</span>   <span class="o">|</span>
<span class="o">-------------------------------------------------</span>
<span class="n">Saving</span> <span class="n">refined</span> <span class="n">experiments</span> <span class="n">to</span> <span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>As a reminder, before metrology correction we had these refined RMSDs from scan-
static refinement:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">53916</span> <span class="o">|</span> <span class="mf">0.26341</span> <span class="o">|</span> <span class="mf">0.21858</span> <span class="o">|</span> <span class="mf">0.106</span>    <span class="o">|</span>
<span class="o">----------------------------------------------</span>
</pre></div>
</div>
<p>After correction they are as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">RMSDs</span> <span class="n">by</span> <span class="n">experiment</span><span class="p">:</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="n">Exp</span> <span class="o">|</span> <span class="n">Nref</span>  <span class="o">|</span> <span class="n">RMSD_X</span>  <span class="o">|</span> <span class="n">RMSD_Y</span>  <span class="o">|</span> <span class="n">RMSD_Z</span>   <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">px</span><span class="p">)</span>    <span class="o">|</span> <span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------</span>
<span class="o">|</span> <span class="mi">0</span>   <span class="o">|</span> <span class="mi">53738</span> <span class="o">|</span> <span class="mf">0.11368</span> <span class="o">|</span> <span class="mf">0.12815</span> <span class="o">|</span> <span class="mf">0.10179</span>  <span class="o">|</span>
<span class="o">----------------------------------------------</span>
</pre></div>
</div>
<p>Let&#8217;s now do scan-varying refinement then integrate the dataset with corrected metrology:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">dials</span><span class="o">.</span><span class="n">refine</span> <span class="n">corrected_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">tukey</span> <span class="n">use_all_reflections</span><span class="o">=</span><span class="n">true</span> <span class="n">bin_size_fraction</span><span class="o">=</span><span class="mf">0.0</span> <span class="n">scan_varying</span><span class="o">=</span><span class="n">true</span> <span class="n">output</span><span class="o">.</span><span class="n">experiments</span><span class="o">=</span><span class="n">corrected_sv_refined_experiments</span><span class="o">.</span><span class="n">json</span>
<span class="n">dials</span><span class="o">.</span><span class="n">integrate</span> <span class="n">corrected_sv_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">indexed</span><span class="o">.</span><span class="n">pickle</span> <span class="n">outlier</span><span class="o">.</span><span class="n">algorithm</span><span class="o">=</span><span class="n">null</span> <span class="n">nproc</span><span class="o">=</span><span class="mi">4</span> <span class="n">output</span><span class="o">.</span><span class="n">reflections</span><span class="o">=</span><span class="n">corrected_integrated</span><span class="o">.</span><span class="n">pickle</span>
<span class="n">dials</span><span class="o">.</span><span class="n">export</span> <span class="n">corrected_integrated</span><span class="o">.</span><span class="n">pickle</span> <span class="n">corrected_sv_refined_experiments</span><span class="o">.</span><span class="n">json</span> <span class="n">mtz</span><span class="o">.</span><span class="n">hklout</span><span class="o">=</span><span class="n">corrected_integrated</span><span class="o">.</span><span class="n">mtz</span> <span class="n">ignore_panels</span><span class="o">=</span><span class="n">true</span>
<span class="n">dials</span><span class="o">.</span><span class="n">analyse_output</span> <span class="n">corrected_integrated</span><span class="o">.</span><span class="n">pickle</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span>
</pre></div>
</div>
<p>From the integration log:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">Summary</span> <span class="n">of</span> <span class="n">integration</span> <span class="n">results</span> <span class="n">binned</span> <span class="n">by</span> <span class="n">resolution</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>
<span class="n">d</span> <span class="nb">min</span> <span class="o">|</span>  <span class="n">d</span> <span class="nb">max</span> <span class="o">|</span> <span class="c"># full | # part | # over | # ice | # sum | # prf | &lt;Ibg&gt; | &lt;I/sigI&gt; | &lt;I/sigI&gt; | &lt;CC prf&gt;</span>
      <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>        <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>    <span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">|</span>    <span class="p">(</span><span class="n">prf</span><span class="p">)</span> <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>
 <span class="mf">1.17</span> <span class="o">|</span>   <span class="mf">1.19</span> <span class="o">|</span>    <span class="mi">340</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>   <span class="mi">343</span> <span class="o">|</span>   <span class="mi">278</span> <span class="o">|</span>  <span class="mf">0.04</span> <span class="o">|</span>     <span class="mf">0.28</span> <span class="o">|</span>     <span class="mf">0.41</span> <span class="o">|</span>     <span class="mf">0.06</span>
 <span class="mf">1.19</span> <span class="o">|</span>   <span class="mf">1.21</span> <span class="o">|</span>   <span class="mi">1125</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">1131</span> <span class="o">|</span>  <span class="mi">1011</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.37</span> <span class="o">|</span>     <span class="mf">0.42</span> <span class="o">|</span>     <span class="mf">0.06</span>
 <span class="mf">1.21</span> <span class="o">|</span>   <span class="mf">1.23</span> <span class="o">|</span>   <span class="mi">2346</span> <span class="o">|</span>     <span class="mi">13</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">2359</span> <span class="o">|</span>  <span class="mi">2176</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.47</span> <span class="o">|</span>     <span class="mf">0.49</span> <span class="o">|</span>     <span class="mf">0.07</span>
 <span class="mf">1.23</span> <span class="o">|</span>   <span class="mf">1.26</span> <span class="o">|</span>   <span class="mi">3776</span> <span class="o">|</span>     <span class="mi">24</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">3800</span> <span class="o">|</span>  <span class="mi">3565</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.50</span> <span class="o">|</span>     <span class="mf">0.61</span> <span class="o">|</span>     <span class="mf">0.10</span>
 <span class="mf">1.26</span> <span class="o">|</span>   <span class="mf">1.29</span> <span class="o">|</span>   <span class="mi">5448</span> <span class="o">|</span>     <span class="mi">37</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">5485</span> <span class="o">|</span>  <span class="mi">5123</span> <span class="o">|</span>  <span class="mf">0.05</span> <span class="o">|</span>     <span class="mf">0.58</span> <span class="o">|</span>     <span class="mf">0.71</span> <span class="o">|</span>     <span class="mf">0.12</span>
 <span class="mf">1.29</span> <span class="o">|</span>   <span class="mf">1.32</span> <span class="o">|</span>   <span class="mi">7241</span> <span class="o">|</span>     <span class="mi">52</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">7293</span> <span class="o">|</span>  <span class="mi">6804</span> <span class="o">|</span>  <span class="mf">0.06</span> <span class="o">|</span>     <span class="mf">0.66</span> <span class="o">|</span>     <span class="mf">0.79</span> <span class="o">|</span>     <span class="mf">0.15</span>
 <span class="mf">1.32</span> <span class="o">|</span>   <span class="mf">1.35</span> <span class="o">|</span>   <span class="mi">9522</span> <span class="o">|</span>     <span class="mi">71</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>  <span class="mi">9593</span> <span class="o">|</span>  <span class="mi">8986</span> <span class="o">|</span>  <span class="mf">0.06</span> <span class="o">|</span>     <span class="mf">0.77</span> <span class="o">|</span>     <span class="mf">0.94</span> <span class="o">|</span>     <span class="mf">0.19</span>
 <span class="mf">1.35</span> <span class="o">|</span>   <span class="mf">1.38</span> <span class="o">|</span>  <span class="mi">12528</span> <span class="o">|</span>     <span class="mi">84</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">12612</span> <span class="o">|</span> <span class="mi">11851</span> <span class="o">|</span>  <span class="mf">0.07</span> <span class="o">|</span>     <span class="mf">0.92</span> <span class="o">|</span>     <span class="mf">1.11</span> <span class="o">|</span>     <span class="mf">0.22</span>
 <span class="mf">1.38</span> <span class="o">|</span>   <span class="mf">1.43</span> <span class="o">|</span>  <span class="mi">16954</span> <span class="o">|</span>    <span class="mi">113</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">17067</span> <span class="o">|</span> <span class="mi">16130</span> <span class="o">|</span>  <span class="mf">0.08</span> <span class="o">|</span>     <span class="mf">1.01</span> <span class="o">|</span>     <span class="mf">1.22</span> <span class="o">|</span>     <span class="mf">0.24</span>
 <span class="mf">1.43</span> <span class="o">|</span>   <span class="mf">1.47</span> <span class="o">|</span>  <span class="mi">20247</span> <span class="o">|</span>    <span class="mi">154</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">20401</span> <span class="o">|</span> <span class="mi">19499</span> <span class="o">|</span>  <span class="mf">0.08</span> <span class="o">|</span>     <span class="mf">1.22</span> <span class="o">|</span>     <span class="mf">1.45</span> <span class="o">|</span>     <span class="mf">0.29</span>
 <span class="mf">1.47</span> <span class="o">|</span>   <span class="mf">1.52</span> <span class="o">|</span>  <span class="mi">23553</span> <span class="o">|</span>    <span class="mi">267</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">23820</span> <span class="o">|</span> <span class="mi">22740</span> <span class="o">|</span>  <span class="mf">0.09</span> <span class="o">|</span>     <span class="mf">1.50</span> <span class="o">|</span>     <span class="mf">1.74</span> <span class="o">|</span>     <span class="mf">0.33</span>
 <span class="mf">1.52</span> <span class="o">|</span>   <span class="mf">1.58</span> <span class="o">|</span>  <span class="mi">24022</span> <span class="o">|</span>    <span class="mi">267</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">24289</span> <span class="o">|</span> <span class="mi">23215</span> <span class="o">|</span>  <span class="mf">0.10</span> <span class="o">|</span>     <span class="mf">1.78</span> <span class="o">|</span>     <span class="mf">2.06</span> <span class="o">|</span>     <span class="mf">0.38</span>
 <span class="mf">1.58</span> <span class="o">|</span>   <span class="mf">1.66</span> <span class="o">|</span>  <span class="mi">25479</span> <span class="o">|</span>    <span class="mi">286</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25765</span> <span class="o">|</span> <span class="mi">24860</span> <span class="o">|</span>  <span class="mf">0.11</span> <span class="o">|</span>     <span class="mf">2.19</span> <span class="o">|</span>     <span class="mf">2.49</span> <span class="o">|</span>     <span class="mf">0.44</span>
 <span class="mf">1.66</span> <span class="o">|</span>   <span class="mf">1.74</span> <span class="o">|</span>  <span class="mi">24305</span> <span class="o">|</span>    <span class="mi">241</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">24546</span> <span class="o">|</span> <span class="mi">23395</span> <span class="o">|</span>  <span class="mf">0.12</span> <span class="o">|</span>     <span class="mf">2.74</span> <span class="o">|</span>     <span class="mf">3.05</span> <span class="o">|</span>     <span class="mf">0.51</span>
 <span class="mf">1.74</span> <span class="o">|</span>   <span class="mf">1.85</span> <span class="o">|</span>  <span class="mi">24742</span> <span class="o">|</span>    <span class="mi">236</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">24978</span> <span class="o">|</span> <span class="mi">23965</span> <span class="o">|</span>  <span class="mf">0.15</span> <span class="o">|</span>     <span class="mf">3.54</span> <span class="o">|</span>     <span class="mf">3.87</span> <span class="o">|</span>     <span class="mf">0.58</span>
 <span class="mf">1.85</span> <span class="o">|</span>   <span class="mf">2.00</span> <span class="o">|</span>  <span class="mi">25657</span> <span class="o">|</span>    <span class="mi">281</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25938</span> <span class="o">|</span> <span class="mi">24999</span> <span class="o">|</span>  <span class="mf">0.19</span> <span class="o">|</span>     <span class="mf">4.90</span> <span class="o">|</span>     <span class="mf">5.24</span> <span class="o">|</span>     <span class="mf">0.65</span>
 <span class="mf">2.00</span> <span class="o">|</span>   <span class="mf">2.20</span> <span class="o">|</span>  <span class="mi">24755</span> <span class="o">|</span>    <span class="mi">268</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25023</span> <span class="o">|</span> <span class="mi">24005</span> <span class="o">|</span>  <span class="mf">0.26</span> <span class="o">|</span>     <span class="mf">6.61</span> <span class="o">|</span>     <span class="mf">6.97</span> <span class="o">|</span>     <span class="mf">0.72</span>
 <span class="mf">2.20</span> <span class="o">|</span>   <span class="mf">2.52</span> <span class="o">|</span>  <span class="mi">25596</span> <span class="o">|</span>    <span class="mi">250</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25846</span> <span class="o">|</span> <span class="mi">25058</span> <span class="o">|</span>  <span class="mf">0.29</span> <span class="o">|</span>     <span class="mf">8.88</span> <span class="o">|</span>     <span class="mf">9.20</span> <span class="o">|</span>     <span class="mf">0.76</span>
 <span class="mf">2.52</span> <span class="o">|</span>   <span class="mf">3.17</span> <span class="o">|</span>  <span class="mi">25140</span> <span class="o">|</span>    <span class="mi">298</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">25438</span> <span class="o">|</span> <span class="mi">24540</span> <span class="o">|</span>  <span class="mf">0.37</span> <span class="o">|</span>    <span class="mf">12.81</span> <span class="o">|</span>    <span class="mf">13.04</span> <span class="o">|</span>     <span class="mf">0.78</span>
 <span class="mf">3.17</span> <span class="o">|</span> <span class="mf">151.25</span> <span class="o">|</span>  <span class="mi">25720</span> <span class="o">|</span>    <span class="mi">303</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span> <span class="mi">26023</span> <span class="o">|</span> <span class="mi">25193</span> <span class="o">|</span>  <span class="mf">0.44</span> <span class="o">|</span>    <span class="mf">25.52</span> <span class="o">|</span>    <span class="mf">25.39</span> <span class="o">|</span>     <span class="mf">0.79</span>
<span class="o">----------------------------------------------------------------------------------------------------------</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">integration</span> <span class="n">results</span> <span class="k">for</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">dataset</span>
<span class="o">----------------------------------------------</span>
<span class="n">Number</span> <span class="n">fully</span> <span class="n">recorded</span>                 <span class="o">|</span> <span class="mi">338446</span>
<span class="n">Number</span> <span class="n">partially</span> <span class="n">recorded</span>             <span class="o">|</span> <span class="mi">4836</span>
<span class="n">Number</span> <span class="k">with</span> <span class="n">overloaded</span> <span class="n">pixels</span>         <span class="o">|</span> <span class="mi">0</span>
<span class="n">Number</span> <span class="ow">in</span> <span class="n">powder</span> <span class="n">rings</span>                <span class="o">|</span> <span class="mi">0</span>
<span class="n">Number</span> <span class="n">processed</span> <span class="k">with</span> <span class="n">summation</span>       <span class="o">|</span> <span class="mi">331750</span>
<span class="n">Number</span> <span class="n">processed</span> <span class="k">with</span> <span class="n">profile</span> <span class="n">fitting</span> <span class="o">|</span> <span class="mi">317393</span>
<span class="o">&lt;</span><span class="n">Ibg</span><span class="o">&gt;</span>                                 <span class="o">|</span> <span class="mf">0.18</span>
<span class="o">&lt;</span><span class="n">I</span><span class="o">/</span><span class="n">sigI</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">summation</span><span class="p">)</span>                  <span class="o">|</span> <span class="mf">5.65</span>
<span class="o">&lt;</span><span class="n">I</span><span class="o">/</span><span class="n">sigI</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">profile</span> <span class="n">fitting</span><span class="p">)</span>            <span class="o">|</span> <span class="mf">5.94</span>
<span class="o">&lt;</span><span class="n">CC</span> <span class="n">prf</span><span class="o">&gt;</span>                              <span class="o">|</span> <span class="mf">0.47</span>
<span class="o">----------------------------------------------</span>
</pre></div>
</div>
<p>We now have a nicer plot of correlations between profiles and the strong
reflections(notwithstanding a few plotting artefacts):</p>
<blockquote>
<div><img alt="../../_images/reference_corr_vs_xy_multipanel_corrected.png" src="../../_images/reference_corr_vs_xy_multipanel_corrected.png" />
</div></blockquote>
<p>By comparison with the previous results we can see that correcting the panel
shifts and mis-orientations has improved the overall profile fitting
mean <img class="math" src="../../_images/math/55437661d4ff68dc280fe3617369a1a777b288b2.png" alt="\frac{I}{\sigma_I}"/> and correlation coefficients. However, comparing
the tables of results binned by resolution we see that the improvements are limited
to the low resolution, and the results are worse at high resolution. For example,
we can make a quick plot of the profile fitting correlation coeffients.</p>
<blockquote>
<div><img alt="../../_images/CC_metrology_comparison.png" src="../../_images/CC_metrology_comparison.png" />
</div></blockquote>
<p>From this we see the crossover point at about <img class="math" src="../../_images/math/a0a6d5201777b8942dcdfa31f19df80beae91649.png" alt="\frac{1}{d_\textrm{mid}^2} = 0.55"/>
or a resolution of about 1.35 Angstroms.</p>
<p>So, finally, we conclude that although we have the means to do metrology analysis
and corrections
of modular detectors, we have learned that it is critical to use data that gives
coverage right out to the corners of the detector so that we can apply the corrected metrology to
other datasets effectively. With <strong class="program">dials.refine</strong> this could be achieved
by joint refinement of data from multiple crystals, but it will take a significant
time to run and use a lot of memory. It is best to do this right, and exactly once!</p>
</div>
<div class="section" id="what-to-do-next">
<h2>What to do next<a class="headerlink" href="#what-to-do-next" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Panel coverage was rather low in the corners. We could try combining more
metrology datasets together to improve coverage and make an effort at
factoring out crystal-dependent effects.</li>
<li>Once we are satisfied with the corrected detector model we can write the
changes directly back into the dxtbx Format object, so that they are available
immediately for any dataset, without having to perform the &#8216;copy-and-paste&#8217;
operation presented here.</li>
</ul>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>Dave Hall (Diamond Light Source) for collecting the data.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workshops.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../_static/diamond_logo.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../_static/CCP4-logo-plain.png" /></a>
  <a href="http://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2015, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>