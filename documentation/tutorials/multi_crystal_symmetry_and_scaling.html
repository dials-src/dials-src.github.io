


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Multi-crystal symmetry analysis and scaling with DIALS &#8212; DIALS  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/dials-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Small Molecule Tutorial" href="small_molecule_tutorial.html" />
    <link rel="prev" title="Scaling of Beta-Lactamase dataset" href="scaling_beta_lactamase.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="logoheader container">
  <a href="../../index.html">
  <img class="logoheader" alt="DIALS" src="../../_static/dials_header.png" />
  </a>
  </div>
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="multi-crystal-symmetry-analysis-and-scaling-with-dials">
<h1>Multi-crystal symmetry analysis and scaling with DIALS<a class="headerlink" href="#multi-crystal-symmetry-analysis-and-scaling-with-dials" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Recent additions to DIALS and xia2 have enabled multi-crystal analysis to be
performed following integration. These tools are particularly relevant
for analysis of many partial-datasets, which may be the only pracitical way of
performing data collections for certain crystals. After integration, the
space group symmetry can be investigated by testing for the presence of symmetry
operations relating the integrated intensities of groups of reflections - the
program to perform this is analysis is <code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code> (with algorithms
similar to those of the program <a class="reference external" href="http://www.ccp4.ac.uk/html/pointless.html">Pointless</a>).
Another thing to consider is that for certain space groups (polar space groups),
there is an inherent ambiguity in the way that the diffraction pattern can be
indexed. In order to combine multiple datasets from these space groups, one must
reindex all data to a consistent setting, which can be done with the program
<code class="samp docutils literal notranslate"><span class="pre">dials.cosym</span></code> (see <a class="reference external" href="https://doi.org/10.1107/S2059798318002978">Gildea and Winter</a> for details).
Finally, the data must be scaled, to correct for experimental effects such as
differences in crystal size/illuminated volume and radiation damage - this can
be done with the program <code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code> (with algorithms similar to those
of the program <a class="reference external" href="http://www.ccp4.ac.uk/html/aimless.html">Aimless</a>). After the data has been scaled, choices
can then be made about applying a resolution limit to exclude certain regions
of the data which may be negatively affected by radiation damage.</p>
<p>In this tutorial, we shall investigate a multi-crystal dataset collected on
the VMXi beamline, Diamond’s automated facility for data collection from
crystallisation experiments <em>in-situ</em>. The dataset consists of four repeats of
a 60-degree rotation measurement on a crystal of Proteinase K, taken at different
locations on the crystal. We shall start with the integrated reflections and
experiments files generated by running the automated processing software
<code class="samp docutils literal notranslate"><span class="pre">xia2</span> <span class="pre">pipeline=dials</span></code>.
Have a look at ‘Processing in Detail’ tutorial if you want to know more about the
different processing steps up to this point.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The data for this tutorial is currently only available for users at diamond
on BAG training.
After typing <code class="samp docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">bagtraining</span></code> you’ll be moved to a working
folder, with the data already located in the <code class="samp docutils literal notranslate"><span class="pre">tutorial-data/ccp4/integrated_files</span></code>
subdirectory. The processing in this tutorial will produce quite a few files,
so it’s recommended to make an move to new directory:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">multi_crystal</span>
<span class="n">cd</span> <span class="n">multi_crystal</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="xia2-multiplex">
<h2>xia2.multiplex<a class="headerlink" href="#xia2-multiplex" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to run these tools for a multi-dataset analysis is through the
program <code class="samp docutils literal notranslate"><span class="pre">xia2.multiplex</span></code>.
This runs several DIALS programs, including the programs described above, while
producing useful plots and output files.</p>
<p>To run <code class="samp docutils literal notranslate"><span class="pre">xia2.multiplex</span></code>, we must provide the path to the input integrated files from
<code class="samp docutils literal notranslate"><span class="pre">dials.integrate</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xia2</span><span class="o">.</span><span class="n">multiplex</span> <span class="o">../</span><span class="n">tutorial</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">ccp4</span><span class="o">/</span><span class="n">integrated_files</span><span class="o">/</span><span class="p">{</span><span class="n">reflections_</span><span class="o">*.</span><span class="n">refl</span><span class="p">,</span><span class="n">experiments_</span><span class="o">*.</span><span class="n">expt</span><span class="p">}</span>
</pre></div>
</div>
<p>This runs <code class="samp docutils literal notranslate"><span class="pre">dials.cosym</span></code>, <code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code>, <code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code>,
calculates a resolution limit and reruns <code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code> with a resolution cutoff. The
final dataset is exported to an unmerged mtz and a html report plot is generated.
The easiest way to see the results is to open the html report in your browser of
choice e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">firefox</span> <span class="n">xia2</span><span class="o">-</span><span class="n">multi</span><span class="o">-</span><span class="n">crystal</span><span class="o">-</span><span class="n">report</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>Provided is a summary of the merging statistics as well as several plots, please
explore these for a few minutes now!</p>
<p>So far the merging statistics look okay but not great, and if you are familiar
with this system you will notice that the space group is <code class="samp docutils literal notranslate"><span class="pre">P</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">1</span></code>, whereas in the
published structure the space group is <code class="samp docutils literal notranslate"><span class="pre">P</span> <span class="pre">43</span> <span class="pre">21</span> <span class="pre">2</span></code> (search for the PDB entry for
Proteinase K)! Let’s have a look at the log files to see what’s going on. Type ‘ls’ in the
current directory to see the files. The files are numbered based on the order
of processing (so all <code class="samp docutils literal notranslate"><span class="pre">1_*</span></code> files are from <code class="samp docutils literal notranslate"><span class="pre">dials.cosym</span></code>, <code class="samp docutils literal notranslate"><span class="pre">2_*</span></code> from
<code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code> etc.).
First let’s inspect the results from <code class="samp docutils literal notranslate"><span class="pre">dials.cosym</span></code>, using the <code class="samp docutils literal notranslate"><span class="pre">cat</span></code> or <code class="samp docutils literal notranslate"><span class="pre">open</span></code> commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="mi">1</span><span class="n">_dials</span><span class="o">.</span><span class="n">cosym</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>At the bottom of the log, you’ll notice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Space</span> <span class="n">groups</span><span class="p">:</span>
<span class="n">P</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">Reindexing</span> <span class="n">operators</span><span class="p">:</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>This looks good so far, in this case the datasets already had a consistent
indexing, however in general there may be different reindexing operators
applied to different datasets.</p>
<p>Next let’s look at the <code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code> results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="mi">2</span><span class="n">_dials</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">log</span>

<span class="n">Scoring</span> <span class="nb">all</span> <span class="n">possible</span> <span class="n">sub</span><span class="o">-</span><span class="n">groups</span>
<span class="o">-------------------------------------------------------------------------------------------</span>
<span class="n">Patterson</span> <span class="n">group</span>     <span class="n">Likelihood</span>  <span class="n">NetZcc</span>  <span class="n">Zcc</span><span class="o">+</span>   <span class="n">Zcc</span><span class="o">-</span>   <span class="n">CC</span>     <span class="n">CC</span><span class="o">-</span>    <span class="n">delta</span>  <span class="n">Reindex</span> <span class="n">operator</span>
<span class="o">-------------------------------------------------------------------------------------------</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>        <span class="o">*</span>  <span class="mf">0.424</span>        <span class="mf">2.72</span>    <span class="mf">7.16</span>   <span class="mf">4.44</span>   <span class="mf">0.72</span>   <span class="mf">0.44</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="o">-</span><span class="mi">1</span>                <span class="mf">0.294</span>        <span class="mf">2.21</span>    <span class="mf">7.20</span>   <span class="mf">4.99</span>   <span class="mf">0.72</span>   <span class="mf">0.49</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">C</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>           <span class="mf">0.081</span>        <span class="mf">1.19</span>    <span class="mf">6.18</span>   <span class="mf">4.99</span>   <span class="mf">0.62</span>   <span class="mf">0.49</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>           <span class="mf">0.063</span>        <span class="mf">0.92</span>    <span class="mf">6.00</span>   <span class="mf">5.08</span>   <span class="mf">0.60</span>   <span class="mf">0.49</span>  <span class="mf">0.0</span>    <span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">a</span>
<span class="n">C</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>           <span class="mf">0.063</span>        <span class="mf">0.91</span>    <span class="mf">5.99</span>   <span class="mf">5.09</span>   <span class="mf">0.58</span>   <span class="mf">0.50</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>           <span class="mf">0.043</span>        <span class="mf">0.49</span>    <span class="mf">5.71</span>   <span class="mf">5.22</span>   <span class="mf">0.56</span>   <span class="mf">0.51</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">4</span><span class="o">/</span><span class="n">m</span>               <span class="mf">0.014</span>        <span class="mf">0.33</span>    <span class="mf">5.55</span>   <span class="mf">5.22</span>   <span class="mf">0.52</span>   <span class="mf">0.52</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="n">m</span> <span class="n">m</span> <span class="n">m</span>             <span class="mf">0.013</span>        <span class="mf">1.17</span>    <span class="mf">5.83</span>   <span class="mf">4.66</span>   <span class="mf">0.58</span>   <span class="mf">0.46</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">C</span> <span class="n">m</span> <span class="n">m</span> <span class="n">m</span>             <span class="mf">0.004</span>        <span class="mf">0.10</span>    <span class="mf">5.40</span>   <span class="mf">5.30</span>   <span class="mf">0.53</span>   <span class="mf">0.51</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">4</span><span class="o">/</span><span class="n">m</span> <span class="n">m</span> <span class="n">m</span>           <span class="mf">0.000</span>        <span class="mf">5.36</span>    <span class="mf">5.36</span>   <span class="mf">0.00</span>   <span class="mf">0.52</span>   <span class="mf">0.00</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="o">-------------------------------------------------------------------------------------------</span>
<span class="n">Best</span> <span class="n">solution</span><span class="p">:</span> <span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>
<span class="n">Unit</span> <span class="n">cell</span><span class="p">:</span> <span class="p">(</span><span class="mf">68.3974</span><span class="p">,</span> <span class="mf">68.3974</span><span class="p">,</span> <span class="mf">104.002</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">Reindex</span> <span class="n">operator</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">Laue</span> <span class="n">group</span> <span class="n">probability</span><span class="p">:</span> <span class="mf">0.424</span>
<span class="n">Laue</span> <span class="n">group</span> <span class="n">confidence</span><span class="p">:</span> <span class="mf">0.417</span>
</pre></div>
</div>
<p><code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code> has found <code class="samp docutils literal notranslate"><span class="pre">P</span> <span class="pre">1</span> <span class="pre">2/m</span> <span class="pre">1</span></code> as the most likely Patterson group, however you’ll
notice that the likelihood is not very high (0.424). It is important to bear in mind
that this symmetry analysis was performed on unscaled intensities. If the intensities
need to be scaled significantly then this can hide the true symmetry of the dataset.</p>
<p>Even though the data was scaled in the wrong space group, scaling will still have
helped the intensities to become more consistent. While the developers of DIALS work
very hard to implement automated rechecking of the symmetry, we’ll have to reprocess
manually from this point forwards.</p>
</div>
<div class="section" id="manual-reprocessing">
<h2>Manual reprocessing<a class="headerlink" href="#manual-reprocessing" title="Permalink to this headline">¶</a></h2>
<p>Let’s try running <code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code> again on the output of the first scaling run
(before any resolution cutoff has been applied):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">symmetry</span> <span class="mi">4</span><span class="n">_scaled</span><span class="o">.</span><span class="n">expt</span> <span class="mi">4</span><span class="n">_scaled</span><span class="o">.</span><span class="n">refl</span>

<span class="n">Scoring</span> <span class="nb">all</span> <span class="n">possible</span> <span class="n">sub</span><span class="o">-</span><span class="n">groups</span>
<span class="o">---------------------------------------------------------------------------------------------</span>
<span class="n">Patterson</span> <span class="n">group</span>       <span class="n">Likelihood</span>  <span class="n">NetZcc</span>  <span class="n">Zcc</span><span class="o">+</span>   <span class="n">Zcc</span><span class="o">-</span>   <span class="n">CC</span>     <span class="n">CC</span><span class="o">-</span>    <span class="n">delta</span>  <span class="n">Reindex</span> <span class="n">operator</span>
<span class="o">---------------------------------------------------------------------------------------------</span>
<span class="n">P</span> <span class="mi">4</span><span class="o">/</span><span class="n">m</span> <span class="n">m</span> <span class="n">m</span>        <span class="o">***</span>  <span class="mf">0.995</span>        <span class="mf">9.34</span>    <span class="mf">9.34</span>   <span class="mf">0.00</span>   <span class="mf">0.93</span>   <span class="mf">0.00</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">C</span> <span class="n">m</span> <span class="n">m</span> <span class="n">m</span>               <span class="mf">0.002</span>        <span class="mf">0.06</span>    <span class="mf">9.37</span>   <span class="mf">9.31</span>   <span class="mf">0.94</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span>
<span class="n">P</span> <span class="n">m</span> <span class="n">m</span> <span class="n">m</span>               <span class="mf">0.002</span>        <span class="mf">0.09</span>    <span class="mf">9.38</span>   <span class="mf">9.29</span>   <span class="mf">0.94</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">4</span><span class="o">/</span><span class="n">m</span>                 <span class="mf">0.000</span>        <span class="mf">0.10</span>    <span class="mf">9.40</span>   <span class="mf">9.30</span>   <span class="mf">0.94</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">C</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>             <span class="mf">0.000</span>        <span class="mf">0.16</span>    <span class="mf">9.46</span>   <span class="mf">9.30</span>   <span class="mf">0.95</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>             <span class="mf">0.000</span>        <span class="mf">0.15</span>    <span class="mf">9.45</span>   <span class="mf">9.30</span>   <span class="mf">0.95</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="o">-</span><span class="n">b</span>
<span class="n">C</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>             <span class="mf">0.000</span>        <span class="mf">0.14</span>    <span class="mf">9.44</span>   <span class="mf">9.30</span>   <span class="mf">0.95</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>             <span class="mf">0.000</span>        <span class="mf">0.11</span>    <span class="mf">9.42</span>   <span class="mf">9.31</span>   <span class="mf">0.94</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="mi">1</span> <span class="mi">2</span><span class="o">/</span><span class="n">m</span> <span class="mi">1</span>             <span class="mf">0.000</span>        <span class="mf">0.23</span>    <span class="mf">9.50</span>   <span class="mf">9.28</span>   <span class="mf">0.95</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">P</span> <span class="o">-</span><span class="mi">1</span>                  <span class="mf">0.000</span>        <span class="mf">0.31</span>    <span class="mf">9.61</span>   <span class="mf">9.30</span>   <span class="mf">0.96</span>   <span class="mf">0.93</span>  <span class="mf">0.0</span>    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="o">---------------------------------------------------------------------------------------------</span>
<span class="n">Best</span> <span class="n">solution</span><span class="p">:</span> <span class="n">P</span> <span class="mi">4</span><span class="o">/</span><span class="n">m</span> <span class="n">m</span> <span class="n">m</span>
<span class="n">Unit</span> <span class="n">cell</span><span class="p">:</span> <span class="p">(</span><span class="mf">68.3815</span><span class="p">,</span> <span class="mf">68.3815</span><span class="p">,</span> <span class="mf">103.974</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">Reindex</span> <span class="n">operator</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="n">Laue</span> <span class="n">group</span> <span class="n">probability</span><span class="p">:</span> <span class="mf">0.995</span>
<span class="n">Laue</span> <span class="n">group</span> <span class="n">confidence</span><span class="p">:</span> <span class="mf">0.994</span>
</pre></div>
</div>
<p>If scale factors from scaling are present, these will be applied before the symmetry
analysis. Now the correct solution is easily found with a very high likelihood,
that’s much better! We can now run scaling again on the output of <code class="samp docutils literal notranslate"><span class="pre">dials.symmetry</span></code>.
Let’s also output the results to an unmerged mtz so that we can later create a report:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">scale</span> <span class="n">symmetrized</span><span class="o">.</span><span class="n">refl</span> <span class="n">symmetrized</span><span class="o">.</span><span class="n">expt</span> <span class="n">unmerged_mtz</span><span class="o">=</span><span class="n">rescaled</span><span class="o">.</span><span class="n">mtz</span>
</pre></div>
</div>
<p>From the output, you can see that the merging statistics are significantly better
than before, with high correlation coefficients close to 1. At this point we could
also apply a resolution limit by supplying <code class="samp docutils literal notranslate"><span class="pre">d_min=</span></code> to <code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code>,
however the correlation coefficient and I/sigma looks good out to the highest
resolution so it is unneccesary in this case.</p>
<p>To get a useful summary report, we can generate a dials-report or a xia2-report:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">report</span> <span class="n">scaled</span><span class="o">.</span><span class="n">refl</span> <span class="n">scaled</span><span class="o">.</span><span class="n">expt</span>

<span class="n">xia2</span><span class="o">.</span><span class="n">report</span> <span class="n">rescaled</span><span class="o">.</span><span class="n">mtz</span>
</pre></div>
</div>
<p>Take a look and the reports, how do the results compare the initial run of <code class="samp docutils literal notranslate"><span class="pre">xia2.multiplex</span></code>?</p>
</div>
<div class="section" id="almost-there">
<h2>Almost there<a class="headerlink" href="#almost-there" title="Permalink to this headline">¶</a></h2>
<p>If you looked carefully at the reports, you may have noticed that the fourth
dataset is giving significantly higher R-merge values and much lower I/sigma.
Therefore the question one must ask is if it is better to exclude this dataset.
We can get some useful information about the agreement between datasets by
running the program <code class="samp docutils literal notranslate"><span class="pre">dials.compute_delta_cchalf</span></code>. This program implements
a version of the algorithms described in <a class="reference external" href="https://doi.org/10.1107/S1600576716005471">Assmann</a> <em>et al.</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">compute_delta_cchalf</span> <span class="n">scaled</span><span class="o">.</span><span class="n">refl</span> <span class="n">scaled</span><span class="o">.</span><span class="n">expt</span>

<span class="c1"># Datasets: 4</span>
<span class="c1"># Reflections: 222934</span>
<span class="c1"># Unique: 26478</span>
<span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">94.912</span>
<span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">excluding</span> <span class="n">dataset</span> <span class="mi">0</span><span class="p">:</span> <span class="mf">92.132</span>
<span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">excluding</span> <span class="n">dataset</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">92.107</span>
<span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">excluding</span> <span class="n">dataset</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">92.042</span>
<span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="n">excluding</span> <span class="n">dataset</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">99.327</span>
<span class="n">Dataset</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.416</span>
<span class="n">Dataset</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">2.780</span>
<span class="n">Dataset</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">2.805</span>
<span class="n">Dataset</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">CC</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span> <span class="mf">2.869</span>
</pre></div>
</div>
<p>It looks like we could get a significantly better CC 1/2 by excluding the final
dataset - it has a negative Delta CC 1/2. But how bad is too bad that it warrants
exclusion? Unfortunately this is a difficult question to answer and it may be the
case that one would need to refine several structures with different data excluded
to properly address this question.
If we had many datasets and only a small fraction had a very large negative Delta CC 1/2
then one could argue that these measurements are not drawn from the same population
as the rest of the data and should be excluded.</p>
<p>To see the effect of removing the last dataset (dataset ‘3’), we can rerun
<code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code> (note that this will overwrite the previous scaled files). We have to
provide the identifier of the dataset that we want to exclude, which are usually
a string of integers (‘0’, ‘1’, ‘2’ … based on the order of input):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dials</span><span class="o">.</span><span class="n">scale</span> <span class="n">scaled</span><span class="o">.</span><span class="n">refl</span> <span class="n">scaled</span><span class="o">.</span><span class="n">expt</span> <span class="n">exclude_datasets</span><span class="o">=</span><span class="mi">3</span> <span class="n">unmerged_mtz</span><span class="o">=</span><span class="n">scaled</span><span class="o">.</span><span class="n">mtz</span>
</pre></div>
</div>
<p>We could have also excluded a subset of images, for example using the option
<code class="samp docutils literal notranslate"><span class="pre">exclude_images=3:301:600</span></code> to exclude the last 300 images of dataset 3.
This option could be used to exclude the end of a dataset that was showing
sigificant radiation damage, or if the crystal had moved out of the beam part-way
through the measurement.</p>
<p>Looking at the output from <code class="samp docutils literal notranslate"><span class="pre">dials.scale</span></code>, the merging statistics have
significantly improved again, and although the multiplicity has reduced, we
have not sacrificed much completeness, so maybe it would be best to proceed
with only these three datasets for structure solution.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="https://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../_static/diamond_logo.png" /></a>
  <a href="https://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../_static/CCP4-logo-plain.png" /></a>
  <a href="https://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2019, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>