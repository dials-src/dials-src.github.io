
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dials.algorithms.refinement &mdash; DIALS  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/dials-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/dials_icon.png"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="DIALS  documentation" href="../../../index.html" />
    <link rel="up" title="Algorithms" href="index.html" />
    <link rel="prev" title="dials.algorithms.profile_model" href="dials.algorithms.profile_model.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="logoheader container">
  <a href="../../../index.html">
  <img class="logoheader" alt="DIALS" src="../../../_static/dials_header.png" />
  </a>
  </div>
  


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dials-algorithms-refinement">
<h1><a class="toc-backref" href="#id1">dials.algorithms.refinement</a><a class="headerlink" href="#dials-algorithms-refinement" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dials-algorithms-refinement" id="id1">dials.algorithms.refinement</a></li>
</ul>
</div>
<span class="target" id="module-dials.algorithms.refinement.reflection_manager"></span><p>Contains classes used to manage the reflections used during refinement,
principally ReflectionManager.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="descname">BlockCalculator</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Utility class to calculate and set columns in the provided reflection
table, which will be used during scan-varying refinement. The columns are a
&#8216;block&#8217; number and an associated &#8216;block_centre&#8217;, giving the image number in
the centre of the block</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image"><code class="xref py py-obj docutils literal"><span class="pre">per_image</span></code></a>()</td>
<td>Set one block per image for all experiments</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width"><code class="xref py py-obj docutils literal"><span class="pre">per_width</span></code></a>(width[,&nbsp;deg])</td>
<td>Set blocks for all experiments according to a constant width</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image">
<code class="descname">per_image</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Set one block per image for all experiments</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width">
<code class="descname">per_width</code><span class="sig-paren">(</span><em>width</em>, <em>deg=True</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_width"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="Permalink to this definition">¶</a></dt>
<dd><p>Set blocks for all experiments according to a constant width</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="descname">ReflectionManager</code><span class="sig-paren">(</span><em>reflections</em>, <em>experiments</em>, <em>nref_per_degree=None</em>, <em>max_sample_size=None</em>, <em>min_sample_size=0</em>, <em>close_to_spindle_cutoff=0.02</em>, <em>outlier_detector=None</em>, <em>weighting_strategy_override=None</em>, <em>verbosity=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>A class to maintain information about observed and predicted
reflections for refinement.</p>
<p>This new version keeps the reflections as a reflection table. Initialisation
is not complete until the ReflectionManager is paired with a target function.
Then, prediction can be done, followed by outlier rejection and any random
sampling to form the working subset.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs"><code class="xref py py-obj docutils literal"><span class="pre">filter_obs</span></code></a>(sel)</td>
<td>Perform a flex array selection on the managed observations, so that</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise"><code class="xref py py-obj docutils literal"><span class="pre">finalise</span></code></a>()</td>
<td>Complete initialisation by performing outlier rejection and any requested subsetting.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size"><code class="xref py py-obj docutils literal"><span class="pre">get_accepted_refs_size</span></code></a>()</td>
<td>Return the number of observations that pass inclusion criteria and</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections"><code class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></code></a>()</td>
<td>Return all reflections that were accepted for refinement but not chosen</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed"><code class="xref py py-obj docutils literal"><span class="pre">get_indexed</span></code></a>()</td>
<td>Return the reflections passed in as input</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches"><code class="xref py py-obj docutils literal"><span class="pre">get_matches</span></code></a>()</td>
<td>For every observation used in refinement return (a copy of) all data</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs"><code class="xref py py-obj docutils literal"><span class="pre">get_obs</span></code></a>()</td>
<td>Get the list of managed observations</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size"><code class="xref py py-obj docutils literal"><span class="pre">get_sample_size</span></code></a>()</td>
<td>Return the number of observations in the working set to be</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches"><code class="xref py py-obj docutils literal"><span class="pre">print_stats_on_matches</span></code></a>()</td>
<td>Print some basic statistics on the matches</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections"><code class="xref py py-obj docutils literal"><span class="pre">reset_accepted_reflections</span></code></a>([reflections])</td>
<td>Reset use flags for all observations in preparation for a new set of</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs">
<code class="descname">filter_obs</code><span class="sig-paren">(</span><em>sel</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.filter_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a flex array selection on the managed observations, so that
external classes can filter according to criteria not available here</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise">
<code class="descname">finalise</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.finalise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="Permalink to this definition">¶</a></dt>
<dd><p>Complete initialisation by performing outlier rejection and any
requested subsetting. This function to be called by a Target object</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size">
<code class="descname">get_accepted_refs_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_accepted_refs_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations that pass inclusion criteria and
can potentially be used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections">
<code class="descname">get_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all reflections that were accepted for refinement but not chosen
in the working set</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed">
<code class="descname">get_indexed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the reflections passed in as input</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches">
<code class="descname">get_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>For every observation used in refinement return (a copy of) all data</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs">
<code class="descname">get_obs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of managed observations</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size">
<code class="descname">get_sample_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_sample_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations in the working set to be
used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches">
<code class="descname">print_stats_on_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections">
<code class="descname">reset_accepted_reflections</code><span class="sig-paren">(</span><em>reflections=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.reset_accepted_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset use flags for all observations in preparation for a new set of
predictions</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="descname">StillsReflectionManager</code><span class="sig-paren">(</span><em>reflections</em>, <em>experiments</em>, <em>nref_per_degree=None</em>, <em>max_sample_size=None</em>, <em>min_sample_size=0</em>, <em>close_to_spindle_cutoff=0.02</em>, <em>outlier_detector=None</em>, <em>weighting_strategy_override=None</em>, <em>verbosity=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.reflection_manager.ReflectionManager</span></code></a></p>
<p>Overloads for a Reflection Manager that does not exclude
reflections too close to the spindle, and reports only information
about X, Y, DelPsi residuals</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">filter_obs</span></code>(sel)</td>
<td>Perform a flex array selection on the managed observations, so that</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">finalise</span></code>()</td>
<td>Complete initialisation by performing outlier rejection and any requested subsetting.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_accepted_refs_size</span></code>()</td>
<td>Return the number of observations that pass inclusion criteria and</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></code>()</td>
<td>Return all reflections that were accepted for refinement but not chosen</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_indexed</span></code>()</td>
<td>Return the reflections passed in as input</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_matches</span></code>()</td>
<td>For every observation used in refinement return (a copy of) all data</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_obs</span></code>()</td>
<td>Get the list of managed observations</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_sample_size</span></code>()</td>
<td>Return the number of observations in the working set to be</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches"><code class="xref py py-obj docutils literal"><span class="pre">print_stats_on_matches</span></code></a>()</td>
<td>Print some basic statistics on the matches</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">reset_accepted_reflections</span></code>([reflections])</td>
<td>Reset use flags for all observations in preparation for a new set of</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches">
<code class="descname">print_stats_on_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="dials.algorithms.refinement.reflection_manager.calculate_entering_flags">
<code class="descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="descname">calculate_entering_flags</code><span class="sig-paren">(</span><em>reflections</em>, <em>experiments</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#calculate_entering_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.calculate_entering_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate entering flags for all reflections, and set them as a column
of the reflection table.</p>
</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.weighting_strategies"></span><p>Contains classes used to provide weighting schemes as strategies for
ReflectionManagers.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="descname">ConstantWeightingStrategy</code><span class="sig-paren">(</span><em>wx</em>, <em>wy</em>, <em>wz</em>, <em>stills=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights"><code class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></code></a>(reflections)</td>
<td>Set weights to constant terms.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights">
<code class="descname">calculate_weights</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Set weights to constant terms. If stills, the z weights are
the &#8216;delpsical.weights&#8217; attribute of the reflection table. Otherwise, use
the usual &#8216;xyzobs.mm.weights&#8217;</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="descname">ExternalDelPsiWeightingStrategy</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for stills refinement. This version uses statistical</p>
<blockquote>
<div>weights for X and Y and assume that the Delta Psi part is already provided in</div></blockquote>
<p>the reflection table</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights"><code class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></code></a>(reflections)</td>
<td>Statistical weights for X, Y.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights">
<code class="descname">calculate_weights</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Statistical weights for X, Y. Weights for DeltaPsi must be already
provided in the reflection table</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="descname">StatisticalWeightingStrategy</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights"><code class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></code></a>(reflections)</td>
<td>set &#8216;statistical weights&#8217;, that is w(x) = 1/var(x)</td>
</tr>
</tbody>
</table>
<dl class="staticmethod">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights">
<em class="property">static </em><code class="descname">calculate_weights</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>set &#8216;statistical weights&#8217;, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="descname">StillsWeightingStrategy</code><span class="sig-paren">(</span><em>delpsi_constant=1000000</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement. This version uses statistical weights
for X and Y and a fixed constant for the delta Psi part, defaulting to 1000000</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights"><code class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></code></a>(reflections)</td>
<td>Include weights for DeltaPsi</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights">
<code class="descname">calculate_weights</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Include weights for DeltaPsi</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.refiner"></span><p>Refiner is the refinement module public interface. RefinerFactory is
what should usually be used to construct a Refiner.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.refiner.Refiner">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.refiner.</code><code class="descname">Refiner</code><span class="sig-paren">(</span><em>reflections</em>, <em>experiments</em>, <em>pred_param</em>, <em>param_reporter</em>, <em>refman</em>, <em>target</em>, <em>refinery</em>, <em>verbosity=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Public interface for performing DIALS refinement.</p>
<dl class="docutils">
<dt>Public methods:</dt>
<dd>run
rmsds
get_experiments
get_matches
get_param_reporter
parameter_correlation_plot
selection_used_for_refinement
predict_for_reflection_table
predict_for_indexed</dd>
<dt>Notes:</dt>
<dd><ul class="first last simple">
<li>The return value of run is a recorded history of the refinement</li>
<li>The experiments accessor provides a copy of the experiments used by
refinement</li>
<li>The model accessors provide copies of those models that might be modified
by refinement (beam, crystal and detector) TO BE DEPRECATED</li>
<li>get_matches exposes the function of the same name from the privately
stored reflection manager</li>
<li>The return value of selection_used_for_refinement is a flex.bool</li>
</ul>
</dd>
</dl>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="dials.algorithms.refinement.refiner.Refiner.get_experiments"><code class="xref py py-obj docutils literal"><span class="pre">get_experiments</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="dials.algorithms.refinement.refiner.Refiner.get_free_reflections"><code class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></code></a>()</td>
<td>Delegated to the reflection manager</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="dials.algorithms.refinement.refiner.Refiner.get_matches"><code class="xref py py-obj docutils literal"><span class="pre">get_matches</span></code></a>()</td>
<td>Delegated to the reflection manager</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="dials.algorithms.refinement.refiner.Refiner.get_param_reporter"><code class="xref py py-obj docutils literal"><span class="pre">get_param_reporter</span></code></a>()</td>
<td>Get the ParameterReport object linked to this Refiner</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix"><code class="xref py py-obj docutils literal"><span class="pre">get_parameter_correlation_matrix</span></code></a>(step[,&nbsp;...])</td>
<td>Return the correlation matrix between columns of the Jacobian at the specified refinement step.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed"><code class="xref py py-obj docutils literal"><span class="pre">predict_for_indexed</span></code></a>()</td>
<td>perform prediction for all the indexed reflections passed into</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table"><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code></a>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table"><code class="xref py py-obj docutils literal"><span class="pre">print_exp_rmsd_table</span></code></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table"><code class="xref py py-obj docutils literal"><span class="pre">print_out_of_sample_rmsd_table</span></code></a>()</td>
<td>print out-of-sample RSMDs per step, if these were tracked</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table"><code class="xref py py-obj docutils literal"><span class="pre">print_panel_rmsd_table</span></code></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="dials.algorithms.refinement.refiner.Refiner.print_step_table"><code class="xref py py-obj docutils literal"><span class="pre">print_step_table</span></code></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="dials.algorithms.refinement.refiner.Refiner.rmsds"><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code></a>()</td>
<td>Return rmsds of the current model</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table"><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code></a>(reflections)</td>
<td>Calculate unweighted RMSDs for the specified reflections</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.run" title="dials.algorithms.refinement.refiner.Refiner.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td>Run refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement"><code class="xref py py-obj docutils literal"><span class="pre">selection_used_for_refinement</span></code></a>()</td>
<td>Return a selection as a flex.bool in terms of the input reflection data of those reflections that were used in the final step of refinement.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_experiments">
<code class="descname">get_experiments</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_free_reflections">
<code class="descname">get_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_matches">
<code class="descname">get_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_param_reporter">
<code class="descname">get_param_reporter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_param_reporter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the ParameterReport object linked to this Refiner</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix">
<code class="descname">get_parameter_correlation_matrix</code><span class="sig-paren">(</span><em>step</em>, <em>col_select=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_parameter_correlation_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the correlation matrix between columns of the Jacobian at
the specified refinement step. The parameter col_select can be used
to select subsets of the full number of columns. The column labels
are also returned as a list of strings</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed">
<code class="descname">predict_for_indexed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all the indexed reflections passed into
refinement and additionally set the used_in_refinement flag. Do not
compose the derivatives of states of the model as this is expensive and
they are not needed outside of a refinement run</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table">
<code class="descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em>reflections</em>, <em>skip_derivatives=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table">
<code class="descname">print_exp_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_exp_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table">
<code class="descname">print_out_of_sample_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_out_of_sample_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print out-of-sample RSMDs per step, if these were tracked</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table">
<code class="descname">print_panel_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_panel_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_step_table">
<code class="descname">print_step_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_step_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds">
<code class="descname">rmsds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return rmsds of the current model</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table">
<code class="descname">rmsds_for_reflection_table</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate unweighted RMSDs for the specified reflections</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement">
<code class="descname">selection_used_for_refinement</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.selection_used_for_refinement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a selection as a flex.bool in terms of the input reflection
data of those reflections that were used in the final step of
refinement.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.refiner.</code><code class="descname">RefinerFactory</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Factory class to create refiners</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation" title="dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation"><code class="xref py py-obj docutils literal"><span class="pre">config_parameterisation</span></code></a>(params,&nbsp;experiments,&nbsp;...)</td>
<td>Given a set of parameters, create a parameterisation from a set of experimental models.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery"><code class="xref py py-obj docutils literal"><span class="pre">config_refinery</span></code></a>(params,&nbsp;target,&nbsp;pred_param,&nbsp;...)</td>
<td>Given a set of parameters, a target class, and a prediction</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refman" title="dials.algorithms.refinement.refiner.RefinerFactory.config_refman"><code class="xref py py-obj docutils literal"><span class="pre">config_refman</span></code></a>(params,&nbsp;reflections,&nbsp;...)</td>
<td>Given a set of parameters and models, build a reflection manager</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints"><code class="xref py py-obj docutils literal"><span class="pre">config_restraints</span></code></a>(params,&nbsp;det_params,&nbsp;...)</td>
<td>Given a set of user parameters plus model parameterisations, create a</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse"><code class="xref py py-obj docutils literal"><span class="pre">config_sparse</span></code></a>(params,&nbsp;experiments)</td>
<td>Configure whether to use sparse datatypes</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="dials.algorithms.refinement.refiner.RefinerFactory.config_target"><code class="xref py py-obj docutils literal"><span class="pre">config_target</span></code></a>(params,&nbsp;experiments,&nbsp;refman,&nbsp;...)</td>
<td>Given a set of parameters, configure a factory to build a</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments"><code class="xref py py-obj docutils literal"><span class="pre">from_parameters_data_experiments</span></code></a>(params,&nbsp;...)</td>
<td></td>
</tr>
</tbody>
</table>
<dl class="classmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation">
<em class="property">classmethod </em><code class="descname">config_parameterisation</code><span class="sig-paren">(</span><em>params</em>, <em>experiments</em>, <em>refman</em>, <em>do_stills</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, create a parameterisation from a set of
experimental models.</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters
experiments An ExperimentList object</dd>
<dt>Returns:</dt>
<dd>A tuple of the prediction equation parameterisation and the
parameter reporter.</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery">
<em class="property">static </em><code class="descname">config_refinery</code><span class="sig-paren">(</span><em>params</em>, <em>target</em>, <em>pred_param</em>, <em>verbosity</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, a target class, and a prediction
parameterisation class, build a refinery</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The refinery instance</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_refman">
<em class="property">static </em><code class="descname">config_refman</code><span class="sig-paren">(</span><em>params</em>, <em>reflections</em>, <em>experiments</em>, <em>do_stills</em>, <em>verbosity</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refman"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refman" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters and models, build a reflection manager</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The reflection manager instance</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints">
<em class="property">static </em><code class="descname">config_restraints</code><span class="sig-paren">(</span><em>params</em>, <em>det_params</em>, <em>beam_params</em>, <em>xl_ori_params</em>, <em>xl_uc_params</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_restraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of user parameters plus model parameterisations, create a
restraints plus a parameterisation of these restraints</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters
det_params A list of detector parameterisations
beam_params A list of beam parameterisations,
xl_ori_params A list of crystal orientation parameterisations
xl_uc_params A list of crystal unit cell parameterisations</dd>
<dt>Returns:</dt>
<dd>A restraints parameterisation</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse">
<em class="property">static </em><code class="descname">config_sparse</code><span class="sig-paren">(</span><em>params</em>, <em>experiments</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_sparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure whether to use sparse datatypes</p>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_target">
<em class="property">static </em><code class="descname">config_target</code><span class="sig-paren">(</span><em>params</em>, <em>experiments</em>, <em>refman</em>, <em>do_stills</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, configure a factory to build a
target function</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The target factory instance</dd>
</dl>
</dd></dl>

<dl class="classmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments">
<em class="property">classmethod </em><code class="descname">from_parameters_data_experiments</code><span class="sig-paren">(</span><em>params</em>, <em>reflections</em>, <em>experiments</em>, <em>verbosity=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.from_parameters_data_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.engine"></span><p>Contains classes for refinement engines. Refinery is the shared interface,
LevenbergMarquardtIterations, GaussNewtonIterations, SimpleLBFGS and LBFGScurvs
are the current concrete implementations</p>
<dl class="class">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">AdaptLbfgs</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></code></a></p>
<p>Adapt Refinery for L-BFGS minimiser</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step"><code class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></code></a>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients"><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures"><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">run</span></code>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs"><code class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></code></a>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step">
<code class="descname">callback_after_step</code><span class="sig-paren">(</span><em>minimizer</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.callback_after_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Do journalling, evaluate rmsds and return True if the target is
reached to terminate the refinement.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients">
<code class="descname">compute_functional_and_gradients</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures">
<code class="descname">compute_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs">
<code class="descname">run_lbfgs</code><span class="sig-paren">(</span><em>curvatures=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.run_lbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the minimiser, keeping track of its log.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">AdaptLstbx</code><span class="sig-paren">(</span><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></code></a>, <code class="xref py py-class docutils literal"><span class="pre">scitbx_lstbx_normal_equations_ext.non_linear_ls</span></code>, <a class="reference external" href="http://cci.lbl.gov/cctbx_docs/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns.non_linear_ls_mixin" title="(in CCTBX vr21242)"><code class="xref py py-class docutils literal"><span class="pre">scitbx.lstbx.normal_eqns.non_linear_ls_mixin</span></code></a></p>
<p>Adapt Refinery for lstbx</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">dof</span></code></td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">n_equations</span></code></td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></code></td>
<td></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equation</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equations</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residual</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="dials.algorithms.refinement.engine.AdaptLstbx.build_up"><code class="xref py py-obj docutils literal"><span class="pre">build_up</span></code></a>([objective_only])</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds" title="dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds"><code class="xref py py-obj docutils literal"><span class="pre">calculate_esds</span></code></a>()</td>
<td>Calculate ESDs of parameters</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">objective</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm"><code class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">reset</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="dials.algorithms.refinement.engine.AdaptLstbx.restart"><code class="xref py py-obj docutils literal"><span class="pre">restart</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">run</span></code>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor" title="dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor"><code class="xref py py-obj docutils literal"><span class="pre">set_cholesky_factor</span></code></a>()</td>
<td>Set the Cholesky factor required for ESD calculation.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">solve</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="dials.algorithms.refinement.engine.AdaptLstbx.step_backward"><code class="xref py py-obj docutils literal"><span class="pre">step_backward</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step_equations</span></code>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="dials.algorithms.refinement.engine.AdaptLstbx.step_forward"><code class="xref py py-obj docutils literal"><span class="pre">step_forward</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.build_up">
<code class="descname">build_up</code><span class="sig-paren">(</span><em>objective_only=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.build_up"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds">
<code class="descname">calculate_esds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.calculate_esds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ESDs of parameters</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm">
<code class="descname">parameter_vector_norm</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.parameter_vector_norm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.restart">
<code class="descname">restart</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.restart"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor">
<code class="descname">set_cholesky_factor</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.set_cholesky_factor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the Cholesky factor required for ESD calculation. This method is
valid only for the LSTBX dense matrix interface</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_backward">
<code class="descname">step_backward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_backward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_forward">
<code class="descname">step_forward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.DisableMPmixin">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">DisableMPmixin</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>A mixin class that disables setting of nproc for multiprocessing</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.DisableMPmixin.set_nproc" title="dials.algorithms.refinement.engine.DisableMPmixin.set_nproc"><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code></a>(nproc)</td>
<td></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.DisableMPmixin.set_nproc">
<code class="descname">set_nproc</code><span class="sig-paren">(</span><em>nproc</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">GaussNewtonIterations</code><span class="sig-paren">(</span><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=20</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="dials.algorithms.refinement.engine.AdaptLstbx"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLstbx</span></code></a>, <a class="reference external" href="http://cci.lbl.gov/cctbx_docs/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns_solving.iterations" title="(in CCTBX vr21242)"><code class="xref py py-class docutils literal"><span class="pre">scitbx.lstbx.normal_eqns_solving.iterations</span></code></a></p>
<p>Refinery implementation, using lstbx Gauss Newton iterations</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">dof</span></code></td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">n_equations</span></code></td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></code></td>
<td></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>step_threshold</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equation</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equations</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residual</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">build_up</span></code>([objective_only])</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_esds</span></code>()</td>
<td>Calculate ESDs of parameters</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">do</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">do_damping</span></code>(value)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">do_scale_shifts</span></code>(max_shift_over_esd)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">had_too_small_a_step</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">has_gradient_converged_to_zero</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">objective</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">reset</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">restart</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="dials.algorithms.refinement.engine.GaussNewtonIterations.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_cholesky_factor</span></code>()</td>
<td>Set the Cholesky factor required for ESD calculation.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">solve</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">step</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step_backward</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">step_equations</span></code>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step_forward</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd">
<code class="descname">convergence_as_shift_over_esd</code><em class="property"> = 1e-05</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value">
<code class="descname">damping_value</code><em class="property"> = 0.0007</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold">
<code class="descname">gradient_threshold</code><em class="property"> = 1e-10</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd">
<code class="descname">max_shift_over_esd</code><em class="property"> = 15</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold">
<code class="descname">step_threshold</code><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.Journal">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">Journal</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">dict</span></code></a></p>
<p>Container in which to store information about refinement history.</p>
<p>This is simply a dict but provides some extra methods for access that
maintain values as columns in a table. Refinery classes will use these methods
while entering data to ensure the table remains consistent. Methods inherited
from dict are not hidden for ease of use of this object when returned to the
user.</p>
<p class="rubric">Attributes</p>
<table border="1" class="docutils">
<colgroup>
<col width="69%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>reason_for_termination</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.add_column" title="dials.algorithms.refinement.engine.Journal.add_column"><code class="xref py py-obj docutils literal"><span class="pre">add_column</span></code></a>(key)</td>
<td>Add a new column named by key</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.add_row" title="dials.algorithms.refinement.engine.Journal.add_row"><code class="xref py py-obj docutils literal"><span class="pre">add_row</span></code></a>()</td>
<td>Add an element to the end of each of the columns.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">clear</span></code>(()&nbsp;-&gt;&nbsp;None.&nbsp;&nbsp;Remove&nbsp;all&nbsp;items&nbsp;from&nbsp;D.)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">copy</span></code>(()&nbsp;-&gt;&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;D)</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="dials.algorithms.refinement.engine.Journal.del_last_row"><code class="xref py py-obj docutils literal"><span class="pre">del_last_row</span></code></a>()</td>
<td>Delete the last element from the each of the columns.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">fromkeys</span></code>(...)</td>
<td>v defaults to None.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get</span></code>((k[,d])&nbsp;-&gt;&nbsp;D[k]&nbsp;if&nbsp;k&nbsp;in&nbsp;D,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="dials.algorithms.refinement.engine.Journal.get_nrows"><code class="xref py py-obj docutils literal"><span class="pre">get_nrows</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">has_key</span></code>((k)&nbsp;-&gt;&nbsp;True&nbsp;if&nbsp;D&nbsp;has&nbsp;a&nbsp;key&nbsp;k,&nbsp;else&nbsp;False)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">items</span></code>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;(key,&nbsp;value)&nbsp;pairs,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">iteritems</span></code>(()&nbsp;-&gt;&nbsp;an&nbsp;iterator&nbsp;over&nbsp;the&nbsp;(key,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">iterkeys</span></code>(()&nbsp;-&gt;&nbsp;an&nbsp;iterator&nbsp;over&nbsp;the&nbsp;keys&nbsp;of&nbsp;D)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">itervalues</span></code>(...)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">keys</span></code>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;keys)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">pop</span></code>((k[,d])&nbsp;-&gt;&nbsp;v,&nbsp;...)</td>
<td>If key is not found, d is returned if given, otherwise KeyError is raised</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">popitem</span></code>(()&nbsp;-&gt;&nbsp;(k,&nbsp;v),&nbsp;...)</td>
<td>2-tuple; but raise KeyError if D is empty.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="dials.algorithms.refinement.engine.Journal.set_last_cell"><code class="xref py py-obj docutils literal"><span class="pre">set_last_cell</span></code></a>(key,&nbsp;value)</td>
<td>Set last cell in column given by key to value.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">setdefault</span></code>((k[,d])&nbsp;-&gt;&nbsp;D.get(k,d),&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update</span></code>(([E,&nbsp;...)</td>
<td>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">values</span></code>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;values)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">viewitems</span></code>(...)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">viewkeys</span></code>(...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">viewvalues</span></code>(...)</td>
<td></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.add_column">
<code class="descname">add_column</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_column"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new column named by key</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.add_row">
<code class="descname">add_row</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an element to the end of each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.del_last_row">
<code class="descname">del_last_row</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.del_last_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the last element from the each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.get_nrows">
<code class="descname">get_nrows</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.get_nrows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.Journal.reason_for_termination">
<code class="descname">reason_for_termination</code><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.reason_for_termination" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.set_last_cell">
<code class="descname">set_last_cell</code><span class="sig-paren">(</span><em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.set_last_cell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>Set last cell in column given by key to value. Fail if the column is the
wrong length</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">LBFGScurvs</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></code></a></p>
<p>Refinery implementation using cctbx LBFGS with curvatures</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></code>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag"><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_diag</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="dials.algorithms.refinement.engine.LBFGScurvs.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></code>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag">
<code class="descname">compute_functional_gradients_diag</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.compute_functional_gradients_diag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">LevenbergMarquardtIterations</code><span class="sig-paren">(</span><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=20</em>, <em>**kwds</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="dials.algorithms.refinement.engine.GaussNewtonIterations"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.GaussNewtonIterations</span></code></a></p>
<p>Refinery implementation, employing lstbx Levenberg Marquadt
iterations</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">dof</span></code></td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu"><code class="xref py py-obj docutils literal"><span class="pre">mu</span></code></a></td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">n_equations</span></code></td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></code></td>
<td></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>step_threshold</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal"><code class="xref py py-obj docutils literal"><span class="pre">add_constant_to_diagonal</span></code></a>(mu)</td>
<td>Add the constant value mu to the diagonal of the normal matrix</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equation</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_equations</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residual</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></code>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">build_up</span></code>([objective_only])</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_esds</span></code>()</td>
<td>Calculate ESDs of parameters</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">do</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">do_damping</span></code>(value)</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">do_scale_shifts</span></code>(max_shift_over_esd)</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">had_too_small_a_step</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">has_gradient_converged_to_zero</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">objective</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress"><code class="xref py py-obj docutils literal"><span class="pre">report_progress</span></code></a>(objective)</td>
<td>Callback within the refinement main loop that can be overridden to</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">reset</span></code>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">restart</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_cholesky_factor</span></code>()</td>
<td>Set the Cholesky factor required for ESD calculation.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu"><code class="xref py py-obj docutils literal"><span class="pre">setup_mu</span></code></a>()</td>
<td>Setup initial value for mu</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">solve</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">step_backward</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">step_equations</span></code>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">step_forward</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal">
<code class="descname">add_constant_to_diagonal</code><span class="sig-paren">(</span><em>mu</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.add_constant_to_diagonal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the constant value mu to the diagonal of the normal matrix</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu">
<code class="descname">mu</code><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress">
<code class="descname">report_progress</code><span class="sig-paren">(</span><em>objective</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.report_progress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress" title="Permalink to this definition">¶</a></dt>
<dd><p>Callback within the refinement main loop that can be overridden to
report the value of the objective function (and possibly) other details for
long-running methods</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu">
<code class="descname">setup_mu</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.setup_mu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup initial value for mu</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau">
<code class="descname">tau</code><em class="property"> = 0.001</em><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.Refinery">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">Refinery</code><span class="sig-paren">(</span><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Interface for Refinery objects. This should be subclassed and the run
method implemented.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step"><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code></a>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="dials.algorithms.refinement.engine.Refinery.get_num_steps"><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="dials.algorithms.refinement.engine.Refinery.prepare_for_step"><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code></a>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.run" title="dials.algorithms.refinement.engine.Refinery.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="dials.algorithms.refinement.engine.Refinery.set_nproc"><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code></a>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="dials.algorithms.refinement.engine.Refinery.test_for_termination"><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code></a>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref"><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code></a>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence"><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code></a>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="dials.algorithms.refinement.engine.Refinery.update_journal"><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code></a>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step">
<code class="descname">get_correlation_matrix_for_step</code><span class="sig-paren">(</span><em>step</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_correlation_matrix_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Decompress and return the full 2D correlation matrix between columns of
the Jacobian that was stored in the journal at the given step number. If
not available, return None</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_num_steps">
<code class="descname">get_num_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_num_steps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.prepare_for_step">
<code class="descname">prepare_for_step</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.prepare_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameterisation and prepare the target function</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.set_nproc">
<code class="descname">set_nproc</code><span class="sig-paren">(</span><em>nproc</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd><p>Set number of processors for multiprocessing. Override in derived classes
if a policy dictates that this must not be user-controlled</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_for_termination">
<code class="descname">test_for_termination</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_for_termination"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if refinement should be terminated</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref">
<code class="descname">test_objective_increasing_but_not_nref</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_objective_increasing_but_not_nref"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for an increase in the objective value between steps. This
could be caused simply by the number of matches between observations
and predictions increasing. However, if the number of matches stayed
the same or reduced then this is a bad sign.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence">
<code class="descname">test_rmsd_convergence</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_rmsd_convergence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for convergence of RMSDs</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.update_journal">
<code class="descname">update_journal</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.update_journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Append latest step information to the journal attributes</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.engine.</code><code class="descname">SimpleLBFGS</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></code></a></p>
<p>Refinery implementation, using cctbx LBFGS with basic settings</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></code>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></code>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></code>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></code>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></code>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="dials.algorithms.refinement.engine.SimpleLBFGS.run"><code class="xref py py-obj docutils literal"><span class="pre">run</span></code></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></code>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></code>(nproc)</td>
<td>Set number of processors for multiprocessing.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></code>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></code>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></code>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_journal</span></code>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target"></span><p>Contains classes used to construct a target function for refinement,
principally Target and ReflectionManager.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target.</code><code class="descname">LeastSquaresPositionalResidualWithRmsdCutoff</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and phi, terminating on achieved
rmsd (or on intrisic convergence of the chosen minimiser)</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><code class="xref py py-obj docutils literal"><span class="pre">achieved</span></code></a>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></code>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></code>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></code>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></code>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></code>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></code>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></code>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></code>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></code>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></code>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></code>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></code>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></code>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></code>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_matches</span></code>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved">
<code class="descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target.</code><code class="descname">LeastSquaresPositionalResidualWithRmsdCutoffSparse</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresPositionalResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">achieved</span></code>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></code>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></code>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></code>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></code>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></code>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></code>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></code>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></code>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></code>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></code>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></code>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></code>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></code>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></code>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_matches</span></code>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.SparseGradientsMixin">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target.</code><code class="descname">SparseGradientsMixin</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#SparseGradientsMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin class to build a sparse Jacobian from gradients of the prediction
formula stored as sparse vectors, and allow concatenation of gradient vectors
that employed sparse storage.</p>
</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.Target">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target.</code><code class="descname">Target</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_manager</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation=None</em>, <em>gradient_calculation_blocksize=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>Abstract interface for a target function class</p>
<p>A Target object will be used by a Refinery. It will refer to a Reflection
Manager to get a list of observations. It will perform reflection prediction
on those observations and update the reflection manager with those
predictions. It will then query the reflection manager to get a list of
accepted reflections with observed and calculated positions. These are the
reflections for use in refinement. It obtains the gradients of reflection
positions from a relevant prediction parameterisation object. With all of
this information in place, it calculates the value of the target function,
the gradients of the target function and auxiliary information (e.g. RMSDs).</p>
<p>Concrete instances of this class implement the actual target function
calculation. The base class should not determine what type of target
function is used (e.g. least squares target), or limit whether the object
is used for a detector space &amp; phi residual, or a reciprocal space residual.
This should all be set by a derived class.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.achieved" title="dials.algorithms.refinement.target.Target.achieved"><code class="xref py py-obj docutils literal"><span class="pre">achieved</span></code></a>()</td>
<td>return True to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="dials.algorithms.refinement.target.Target.calculate_gradients"><code class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></code></a>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures"><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code></a>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="dials.algorithms.refinement.target.Target.compute_residuals"><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></code></a>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients"><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></code></a>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures"><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></code></a>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients"><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></code></a>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="dials.algorithms.refinement.target.Target.get_num_matches"><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></code></a>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment"><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></code></a>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="dials.algorithms.refinement.target.Target.get_num_matches_for_panel"><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></code></a>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict" title="dials.algorithms.refinement.target.Target.predict"><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code></a>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="dials.algorithms.refinement.target.Target.predict_for_free_reflections"><code class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></code></a>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="dials.algorithms.refinement.target.Target.predict_for_reflection_table"><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code></a>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds" title="dials.algorithms.refinement.target.Target.rmsds"><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code></a>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="dials.algorithms.refinement.target.Target.rmsds_for_experiment"><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></code></a>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="dials.algorithms.refinement.target.Target.rmsds_for_panel"><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></code></a>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table"><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code></a>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.set_prediction_parameterisation" title="dials.algorithms.refinement.target.Target.set_prediction_parameterisation"><code class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></code></a>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.set_restraints_parameterisation" title="dials.algorithms.refinement.target.Target.set_restraints_parameterisation"><code class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></code></a>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="dials.algorithms.refinement.target.Target.split_matches_into_blocks"><code class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></code></a>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.update_matches" title="dials.algorithms.refinement.target.Target.update_matches"><code class="xref py py-obj docutils literal"><span class="pre">update_matches</span></code></a>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.achieved">
<code class="descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>return True to terminate the refinement.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.calculate_gradients">
<code class="descname">calculate_gradients</code><span class="sig-paren">(</span><em>reflections=None</em>, <em>callback=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.calculate_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the prediction_parameterisation object to calculate
gradients for all the matched reflections, or just for those specified</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures">
<code class="descname">compute_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><em>block=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the value of the target function and its gradients. Set
approximate curvatures as a side-effect</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals">
<code class="descname">compute_residuals</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their weights</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients">
<code class="descname">compute_residuals_and_gradients</code><span class="sig-paren">(</span><em>block=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their gradients and weights for
non-linear least squares methods</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures">
<code class="descname">compute_restraints_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>use the restraints_parameterisation object, if present, to
calculate the least squares restraints objective plus gradients and
approximate curvatures</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients">
<code class="descname">compute_restraints_residuals_and_gradients</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the restraints_parameterisation object, if present, to
calculate the vector of restraints residuals plus their gradients and
weights for non-linear least squares methods</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches">
<code class="descname">get_num_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment">
<code class="descname">get_num_matches_for_experiment</code><span class="sig-paren">(</span><em>iexp=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_panel">
<code class="descname">get_num_matches_for_panel</code><span class="sig-paren">(</span><em>ipanel=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict">
<code class="descname">predict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>perform reflection prediction for the working reflections and update the
reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_free_reflections">
<code class="descname">predict_for_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for the reflections not used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_reflection_table">
<code class="descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em>reflections</em>, <em>skip_derivatives=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_names">
<code class="descname">rmsd_names</code><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_Phi']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_units">
<code class="descname">rmsd_units</code><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds">
<code class="descname">rmsds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the matches</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_experiment">
<code class="descname">rmsds_for_experiment</code><span class="sig-paren">(</span><em>iexp=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected experiment.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_panel">
<code class="descname">rmsds_for_panel</code><span class="sig-paren">(</span><em>ipanel=0</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected panel.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table">
<code class="descname">rmsds_for_reflection_table</code><span class="sig-paren">(</span><em>reflections</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the specified reflections. Caution: this
assumes that the table reflections has the keys expected by _rmsds_core</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.set_prediction_parameterisation">
<code class="descname">set_prediction_parameterisation</code><span class="sig-paren">(</span><em>prediction_parameterisation</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.set_prediction_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.set_prediction_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>For circumstances where the PredictionParameterisation object was not
available at initialisation, set it with this method</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.set_restraints_parameterisation">
<code class="descname">set_restraints_parameterisation</code><span class="sig-paren">(</span><em>restraints_parameterisation</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.set_restraints_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.set_restraints_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>For circumstances where the RestraintsParameterisation object was not
available at initialisation, set it with this method</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.split_matches_into_blocks">
<code class="descname">split_matches_into_blocks</code><span class="sig-paren">(</span><em>nproc=1</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.split_matches_into_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of the matches, split into blocks according to the
gradient_calculation_blocksize parameter and the number of processes (if relevant).
The number of blocks will be set such that the total number of reflections
being processed by concurrent processes does not exceed gradient_calculation_blocksize</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.update_matches">
<code class="descname">update_matches</code><span class="sig-paren">(</span><em>force=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.update_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.update_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure the observations matched to predictions are up to date</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target_stills"></span><dl class="class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target_stills.</code><code class="descname">LeastSquaresStillsResidualWithRmsdCutoff</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and minimum rotation to the Ewald
sphere, DeltaPsi. Terminates refinement on achieved rmsd (or on intrisic
convergence of the chosen minimiser)</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved"><code class="xref py py-obj docutils literal"><span class="pre">achieved</span></code></a>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></code>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></code>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></code>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></code>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></code>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></code>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></code>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></code>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></code>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code></a>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></code>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></code>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></code>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></code>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></code>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_matches</span></code>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved">
<code class="descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table">
<code class="descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em>reflections</em>, <em>skip_derivatives=False</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names">
<code class="descname">rmsd_names</code><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_DeltaPsi']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units">
<code class="descname">rmsd_units</code><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse">
<em class="property">class </em><code class="descclassname">dials.algorithms.refinement.target_stills.</code><code class="descname">LeastSquaresStillsResidualWithRmsdCutoffSparse</code><span class="sig-paren">(</span><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff"><code class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresStillsResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">achieved</span></code>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></code>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></code>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></code>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></code>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></code>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></code>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></code>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></code>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></code>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict</span></code>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></code>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></code>(reflections[,&nbsp;...])</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds</span></code>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></code>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></code>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></code>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></code>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></code>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></code>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">update_matches</span></code>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workshops.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../../_static/diamond_logo.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../../_static/CCP4-logo-plain.png" /></a>
  <a href="http://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../../../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2015, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>