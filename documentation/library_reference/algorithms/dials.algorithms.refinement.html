


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dials.algorithms.refinement &#8212; DIALS  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/dials-styles.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="dials.algorithms.scaling" href="dials.algorithms.scaling.html" />
    <link rel="prev" title="dials.algorithms.profile_model" href="dials.algorithms.profile_model.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="logoheader container">
  <a href="../../../index.html">
  <img class="logoheader" alt="DIALS" src="../../../_static/dials_header.png" />
  </a>
  </div>
  

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-dials.algorithms.refinement.reflection_manager">
<span id="dials-algorithms-refinement"></span><h1>dials.algorithms.refinement<a class="headerlink" href="#module-dials.algorithms.refinement.reflection_manager" title="Permalink to this headline">¶</a></h1>
<p>Contains classes used to manage the reflections used during refinement,
principally ReflectionManager.</p>
<dl class="py class">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="sig-name descname">BlockCalculator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Utility class to calculate and set columns in the provided reflection
table, which will be used during scan-varying refinement. The columns are a
‘block’ number and an associated ‘block_centre’, giving the image number in
the centre of the block</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image">
<code class="sig-name descname">per_image</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Set one block per image for all experiments</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width">
<code class="sig-name descname">per_width</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">width</span></em>, <em class="sig-param"><span class="n">deg</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_width"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="Permalink to this definition">¶</a></dt>
<dd><p>Set blocks for all experiments according to a constant width</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="sig-name descname">ReflectionManager</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">nref_per_degree</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_sample_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">min_sample_size</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">close_to_spindle_cutoff</span><span class="o">=</span><span class="default_value">0.02</span></em>, <em class="sig-param"><span class="n">trim_scan_edges</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">outlier_detector</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">weighting_strategy_override</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A class to maintain information about observed and predicted
reflections for refinement.</p>
<p>This new version keeps the reflections as a reflection table. Initialisation
is not complete until the ReflectionManager is paired with a target function.
Then, prediction can be done, followed by outlier rejection and any random
sampling to form the working subset.</p>
<dl class="py attribute">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.experiment_type">
<code class="sig-name descname">experiment_type</code><em class="property"> = 'scans'</em><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.experiment_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs">
<code class="sig-name descname">filter_obs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sel</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.filter_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a flex array selection on the managed observations, so that
external classes can filter according to criteria not available here</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise">
<code class="sig-name descname">finalise</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">analysis</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.finalise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="Permalink to this definition">¶</a></dt>
<dd><p>Complete initialisation by performing outlier rejection and any
requested subsetting. If a list of results from a CentroidAnalysis
object is provided, these may be used to determine outlier rejection
block widths</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size">
<code class="sig-name descname">get_accepted_refs_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_accepted_refs_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations that pass inclusion criteria and
can potentially be used for refinement</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_centroid_analyser">
<code class="sig-name descname">get_centroid_analyser</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">debug</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_centroid_analyser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_centroid_analyser" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a CentroidAnalysis object for the current reflections</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections">
<code class="sig-name descname">get_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all reflections that were accepted for refinement but not chosen
in the working set</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed">
<code class="sig-name descname">get_indexed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the reflections passed in as input</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches">
<code class="sig-name descname">get_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>For every observation used in refinement return (a copy of) all data</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs">
<code class="sig-name descname">get_obs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of managed observations</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size">
<code class="sig-name descname">get_sample_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_sample_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations in the working set to be
used for refinement</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches">
<code class="sig-name descname">print_stats_on_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections">
<code class="sig-name descname">reset_accepted_reflections</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.reset_accepted_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset use flags for all observations in preparation for a new set of
predictions</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="sig-name descname">ReflectionManagerFactory</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.from_parameters_reflections_experiments">
<em class="property">static </em><code class="sig-name descname">from_parameters_reflections_experiments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">do_stills</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManagerFactory.from_parameters_reflections_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManagerFactory.from_parameters_reflections_experiments" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters and models, build a reflection manager</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The reflection manager instance</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.reflection_manager.</code><code class="sig-name descname">StillsReflectionManager</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">nref_per_degree</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_sample_size</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">min_sample_size</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">close_to_spindle_cutoff</span><span class="o">=</span><span class="default_value">0.02</span></em>, <em class="sig-param"><span class="n">trim_scan_edges</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">outlier_detector</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">weighting_strategy_override</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.reflection_manager.ReflectionManager</span></code></a></p>
<p>Overloads for a Reflection Manager that does not exclude
reflections too close to the spindle, and reports only information
about X, Y, DelPsi residuals</p>
<dl class="py attribute">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.experiment_type">
<code class="sig-name descname">experiment_type</code><em class="property"> = 'stills'</em><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.experiment_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches">
<code class="sig-name descname">print_stats_on_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.weighting_strategies"></span><p>Contains classes used to provide weighting schemes as strategies for
ReflectionManagers.</p>
<dl class="py class">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="sig-name descname">ConstantWeightingStrategy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wx</span></em>, <em class="sig-param"><span class="n">wy</span></em>, <em class="sig-param"><span class="n">wz</span></em>, <em class="sig-param"><span class="n">stills</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights">
<code class="sig-name descname">calculate_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Set weights to constant terms. If stills, the z weights are
the ‘delpsical.weights’ attribute of the reflection table. Otherwise, use
the usual ‘xyzobs.mm.weights’</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="sig-name descname">ExternalDelPsiWeightingStrategy</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for stills refinement. This version uses statistical
weights for X and Y and assume that the Delta Psi part is already provided in
the reflection table</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights">
<code class="sig-name descname">calculate_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ExternalDelPsiWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ExternalDelPsiWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Statistical weights for X, Y. Weights for DeltaPsi must be already
provided in the reflection table</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="sig-name descname">StatisticalWeightingStrategy</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights">
<em class="property">static </em><code class="sig-name descname">calculate_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>set ‘statistical weights’, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.weighting_strategies.</code><code class="sig-name descname">StillsWeightingStrategy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">delpsi_constant</span><span class="o">=</span><span class="default_value">1000000</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy</span></code></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement. This version uses statistical weights
for X and Y and a fixed constant for the delta Psi part, defaulting to 1000000</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights">
<code class="sig-name descname">calculate_weights</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Include weights for DeltaPsi</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.refiner"></span><p>Refiner is the refinement module public interface. RefinerFactory is
what should usually be used to construct a Refiner.</p>
<dl class="py class">
<dt id="dials.algorithms.refinement.refiner.Refiner">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.refiner.</code><code class="sig-name descname">Refiner</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">pred_param</span></em>, <em class="sig-param"><span class="n">param_reporter</span></em>, <em class="sig-param"><span class="n">refman</span></em>, <em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">refinery</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Public interface for performing DIALS refinement.</p>
<dl class="simple">
<dt>Public methods:</dt><dd><p>run
rmsds
get_experiments
get_matches
get_param_reporter
parameter_correlation_plot
selection_used_for_refinement
predict_for_reflection_table
predict_for_indexed</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The return value of run is a recorded history of the refinement</p></li>
<li><p>The experiments accessor provides a copy of the experiments used by
refinement</p></li>
<li><p>The model accessors provide copies of those models that might be modified
by refinement (beam, crystal and detector) TO BE DEPRECATED</p></li>
<li><p>get_matches exposes the function of the same name from the privately
stored reflection manager</p></li>
<li><p>The return value of selection_used_for_refinement is a flex.bool</p></li>
</ul>
<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_experiments">
<code class="sig-name descname">get_experiments</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a copy of the current refiner experiments</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_free_reflections">
<code class="sig-name descname">get_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_matches">
<code class="sig-name descname">get_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_param_reporter">
<code class="sig-name descname">get_param_reporter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_param_reporter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the ParameterReport object linked to this Refiner</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix">
<code class="sig-name descname">get_parameter_correlation_matrix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">step</span></em>, <em class="sig-param"><span class="n">col_select</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_parameter_correlation_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the correlation matrix between columns of the Jacobian at
the specified refinement step. The parameter col_select can be used
to select subsets of the full number of columns. The column labels
are also returned as a list of strings</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.history">
<em class="property">property </em><code class="sig-name descname">history</code><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.history" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the refinement engine’s step history</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed">
<code class="sig-name descname">predict_for_indexed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all the indexed reflections passed into
refinement and additionally set the used_in_refinement flag. Do not
compose the derivatives of states of the model as this is expensive and
they are not needed outside of a refinement run</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table">
<code class="sig-name descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">skip_derivatives</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table">
<code class="sig-name descname">print_exp_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_exp_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table">
<code class="sig-name descname">print_out_of_sample_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_out_of_sample_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print out-of-sample RSMDs per step, if these were tracked</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table">
<code class="sig-name descname">print_panel_rmsd_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_panel_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_step_table">
<code class="sig-name descname">print_step_table</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_step_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds">
<code class="sig-name descname">rmsds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return rmsds of the current model</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table">
<code class="sig-name descname">rmsds_for_reflection_table</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate unweighted RMSDs for the specified reflections</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run refinement</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement">
<code class="sig-name descname">selection_used_for_refinement</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.selection_used_for_refinement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a selection as a flex.bool in terms of the input reflection
data of those reflections that were used in the final step of
refinement.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.refiner.</code><code class="sig-name descname">RefinerFactory</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Factory class to create refiners</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery">
<em class="property">static </em><code class="sig-name descname">config_refinery</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">pred_param</span></em>, <em class="sig-param"><span class="n">constraints_manager</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, a target class, a prediction
parameterisation class and a constraints_manager (which could be None),
build a refinery</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The refinery instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints">
<em class="property">static </em><code class="sig-name descname">config_restraints</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">pred_param</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_restraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of user parameters plus a model parameterisation, create
restraints plus a parameterisation of these restraints</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params: The input PHIL parameters
pred_param: A PredictionParameters object</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A restraints parameterisation or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse">
<em class="property">static </em><code class="sig-name descname">config_sparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">experiments</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_sparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure whether to use sparse datatypes</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_target">
<em class="property">static </em><code class="sig-name descname">config_target</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">pred_param</span></em>, <em class="sig-param"><span class="n">restraints_param</span></em>, <em class="sig-param"><span class="n">do_stills</span></em>, <em class="sig-param"><span class="n">do_sparse</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments">
<em class="property">classmethod </em><code class="sig-name descname">from_parameters_data_experiments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">experiments</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.from_parameters_data_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.refiner.ScanVaryingRefiner">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.refiner.</code><code class="sig-name descname">ScanVaryingRefiner</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">pred_param</span></em>, <em class="sig-param"><span class="n">param_reporter</span></em>, <em class="sig-param"><span class="n">refman</span></em>, <em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">refinery</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#ScanVaryingRefiner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.ScanVaryingRefiner" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner" title="dials.algorithms.refinement.refiner.Refiner"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.refiner.Refiner</span></code></a></p>
<p>Includes functionality to update the models with their states at
scan-points after scan-varying refinement</p>
</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.engine"></span><p>Contains classes for refinement engines. Refinery is the shared interface,
LevenbergMarquardtIterations, GaussNewtonIterations, SimpleLBFGS and LBFGScurvs
are the current concrete implementations</p>
<dl class="py class">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">AdaptLbfgs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></code></a></p>
<p>Adapt Refinery for L-BFGS minimiser</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step">
<code class="sig-name descname">callback_after_step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">minimizer</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.callback_after_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Do journalling, evaluate rmsds and return True if the target is
reached to terminate the refinement.</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients">
<code class="sig-name descname">compute_functional_and_gradients</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures">
<code class="sig-name descname">compute_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs">
<code class="sig-name descname">run_lbfgs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">curvatures</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.run_lbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the minimiser, keeping track of its log.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">AdaptLstbx</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">constraints_manager</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tracking</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_iterations</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">scitbx_lstbx_normal_equations_ext.non_linear_ls</span></code>, <a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns.non_linear_ls_mixin" title="(in CCTBX vNone)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scitbx.lstbx.normal_eqns.non_linear_ls_mixin</span></code></a></p>
<p>Adapt Refinery for lstbx</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.build_up">
<code class="sig-name descname">build_up</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objective_only</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.build_up"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds">
<code class="sig-name descname">calculate_esds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.calculate_esds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.calculate_esds" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ESDs of parameters</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm">
<code class="sig-name descname">parameter_vector_norm</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.parameter_vector_norm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.restart">
<code class="sig-name descname">restart</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.restart"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor">
<code class="sig-name descname">set_cholesky_factor</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.set_cholesky_factor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_cholesky_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the Cholesky factor required for ESD calculation. This method is
valid only for the LSTBX dense matrix interface</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_backward">
<code class="sig-name descname">step_backward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_backward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_forward">
<code class="sig-name descname">step_forward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.DisableMPmixin">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">DisableMPmixin</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A mixin class that disables setting of nproc for multiprocessing</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.DisableMPmixin.set_nproc">
<code class="sig-name descname">set_nproc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nproc</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#DisableMPmixin.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.DisableMPmixin.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">GaussNewtonIterations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">constraints_manager</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tracking</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_iterations</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="dials.algorithms.refinement.engine.AdaptLstbx"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.AdaptLstbx</span></code></a>, <a class="reference external" href="https://cctbx.github.io/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns_solving.iterations" title="(in CCTBX vNone)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scitbx.lstbx.normal_eqns_solving.iterations</span></code></a></p>
<p>Refinery implementation, using lstbx Gauss Newton iterations</p>
<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd">
<code class="sig-name descname">convergence_as_shift_over_esd</code><em class="property"> = 1e-05</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value">
<code class="sig-name descname">damping_value</code><em class="property"> = 0.0007</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold">
<code class="sig-name descname">gradient_threshold</code><em class="property"> = 1e-10</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd">
<code class="sig-name descname">max_shift_over_esd</code><em class="property"> = 15</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold">
<code class="sig-name descname">step_threshold</code><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.Journal">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">Journal</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p>
<p>Container in which to store information about refinement history.</p>
<p>This is simply a dict but provides some extra methods for access that
maintain values as columns in a table. Refinery classes will use these methods
while entering data to ensure the table remains consistent. Methods inherited
from dict are not hidden for ease of use of this object when returned to the
user.</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.add_column">
<code class="sig-name descname">add_column</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_column"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new column named by key</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.add_row">
<code class="sig-name descname">add_row</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an element to the end of each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.del_last_row">
<code class="sig-name descname">del_last_row</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.del_last_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the last element from the each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.from_json_file">
<em class="property">classmethod </em><code class="sig-name descname">from_json_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.from_json_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.from_json_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.get_nrows">
<code class="sig-name descname">get_nrows</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.get_nrows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.Journal.reason_for_termination">
<code class="sig-name descname">reason_for_termination</code><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.reason_for_termination" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.set_last_cell">
<code class="sig-name descname">set_last_cell</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.set_last_cell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>Set last cell in column given by key to value. Fail if the column is the
wrong length</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Journal.to_json_file">
<code class="sig-name descname">to_json_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">filename</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.to_json_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.to_json_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">LBFGScurvs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></code></a></p>
<p>Refinery implementation using cctbx LBFGS with curvatures</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag">
<code class="sig-name descname">compute_functional_gradients_diag</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.compute_functional_gradients_diag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">LevenbergMarquardtIterations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">constraints_manager</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tracking</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_iterations</span><span class="o">=</span><span class="default_value">20</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="dials.algorithms.refinement.engine.GaussNewtonIterations"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.GaussNewtonIterations</span></code></a></p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal">
<code class="sig-name descname">add_constant_to_diagonal</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mu</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.add_constant_to_diagonal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.add_constant_to_diagonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the constant value mu to the diagonal of the normal matrix</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu">
<em class="property">property </em><code class="sig-name descname">mu</code><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress">
<code class="sig-name descname">report_progress</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">objective</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.report_progress"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.report_progress" title="Permalink to this definition">¶</a></dt>
<dd><p>Callback within the refinement main loop that can be overridden to
report the value of the objective function (and possibly) other details for
long-running methods</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu">
<code class="sig-name descname">setup_mu</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.setup_mu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.setup_mu" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup initial value for mu</p>
</dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau">
<code class="sig-name descname">tau</code><em class="property"> = 0.001</em><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.Refinery">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">Refinery</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">constraints_manager</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">log</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tracking</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_iterations</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Interface for Refinery objects. This should be subclassed and the run
method implemented.</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step">
<code class="sig-name descname">get_correlation_matrix_for_step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">step</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_correlation_matrix_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>For each type of residual (e.g. X, Y, Phi), decompress and return the
full 2D correlation matrix between columns of the Jacobian that was
stored in the journal at the given step number. If not available, return
None</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_num_steps">
<code class="sig-name descname">get_num_steps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_num_steps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.jacobian_condition_number">
<code class="sig-name descname">jacobian_condition_number</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.jacobian_condition_number"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.jacobian_condition_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the condition number of the Jacobian, for tracking in the
refinement journal, if requested. The condition number of a matrix A is
defined as cond(A) = ||A|| ||inv(A)||. For a rectangular matrix the inverse
operation refers to the Moore-Penrose pseudoinverse. Various matrix norms
can be used, resulting in numerically different condition numbers, however
the 2-norm is commonly used. In that case, the definition is equivalent
to the ratio of the largest to smallest singular values of the matrix:
cond(A) = sig_(A) / sig_min(A). That is the calculation that is performed
here.</p>
<p>The condition number is a measure of how accurate the solution x to the
equation Ax = b will be. Essentially it measures how errors are amplified
through the linear equation. The condition number is large in the case that
the columns of A are nearly linearly-dependent (and infinite for a singular
matrix). We use it here then to detect situations where the correlation
between effects of different parameter shifts becomes large and therefore
refinement is problematic.</p>
<p>Note, the Jacobian used here does not include any additional rows due to
restraints terms that might be applied, or any parameter reduction due to
constraints. Therefore this condition number relates to the pure linearised
(Gauss-Newton) step, which might not actually be what the refinement engine
uses. It can be indicative of issues in the fundamental set up of the least
squares problem, even if these issues are avoided in practice (e.g. by
use of an algorithm like Levenberg-Marquardt, inclusion of restraints or
parameter reduction).</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.prepare_for_step">
<code class="sig-name descname">prepare_for_step</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.prepare_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameterisation and prepare the target function</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.set_nproc">
<code class="sig-name descname">set_nproc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nproc</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd><p>Set number of processors for multiprocessing. Override in derived classes
if a policy dictates that this must not be user-controlled</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.split_jacobian_into_blocks">
<code class="sig-name descname">split_jacobian_into_blocks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.split_jacobian_into_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.split_jacobian_into_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Split the Jacobian into blocks each corresponding to a separate
residual</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_for_termination">
<code class="sig-name descname">test_for_termination</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_for_termination"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if refinement should be terminated</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref">
<code class="sig-name descname">test_objective_increasing_but_not_nref</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_objective_increasing_but_not_nref"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for an increase in the objective value between steps. This
could be caused simply by the number of matches between observations
and predictions increasing. However, if the number of matches stayed
the same or reduced then this is a bad sign.</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence">
<code class="sig-name descname">test_rmsd_convergence</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_rmsd_convergence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for convergence of RMSDs</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.engine.Refinery.update_journal">
<code class="sig-name descname">update_journal</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.update_journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Append latest step information to the journal attributes</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.engine.</code><code class="sig-name descname">SimpleLBFGS</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></code></a></p>
<p>Refinery implementation, using cctbx LBFGS with basic settings</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target"></span><p>Contains classes used to construct a target function for refinement,
principally Target and ReflectionManager.</p>
<dl class="py class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target.</code><code class="sig-name descname">LeastSquaresPositionalResidualWithRmsdCutoff</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">restraints_parameterisation</span></em>, <em class="sig-param"><span class="n">frac_binsize_cutoff</span><span class="o">=</span><span class="default_value">0.33333</span></em>, <em class="sig-param"><span class="n">absolute_cutoffs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gradient_calculation_blocksize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target.Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and phi, terminating on achieved
rmsd (or on intrisic convergence of the chosen minimiser)</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved">
<code class="sig-name descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target.</code><code class="sig-name descname">LeastSquaresPositionalResidualWithRmsdCutoffSparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">restraints_parameterisation</span></em>, <em class="sig-param"><span class="n">frac_binsize_cutoff</span><span class="o">=</span><span class="default_value">0.33333</span></em>, <em class="sig-param"><span class="n">absolute_cutoffs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gradient_calculation_blocksize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresPositionalResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.target.SparseGradientsMixin">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target.</code><code class="sig-name descname">SparseGradientsMixin</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#SparseGradientsMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Mixin class to build a sparse Jacobian from gradients of the prediction
formula stored as sparse vectors, and allow concatenation of gradient vectors
that employed sparse storage.</p>
</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.target.Target">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target.</code><code class="sig-name descname">Target</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">restraints_parameterisation</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gradient_calculation_blocksize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Abstract interface for a target function class</p>
<p>A Target object will be used by a Refinery. It will refer to a Reflection
Manager to get a list of observations. It will perform reflection prediction
on those observations and update the reflection manager with those
predictions. It will then query the reflection manager to get a list of
accepted reflections with observed and calculated positions. These are the
reflections for use in refinement. It obtains the gradients of reflection
positions from a relevant prediction parameterisation object. With all of
this information in place, it calculates the value of the target function,
the gradients of the target function and auxiliary information (e.g. RMSDs).</p>
<p>Concrete instances of this class implement the actual target function
calculation. The base class should not determine what type of target
function is used (e.g. least squares target), or limit whether the object
is used for a detector space &amp; phi residual, or a reciprocal space residual.
This should all be set by a derived class.</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.achieved">
<code class="sig-name descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>return True to terminate the refinement.</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.calculate_gradients">
<code class="sig-name descname">calculate_gradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">callback</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.calculate_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the prediction_parameterisation object to calculate
gradients for all the matched reflections, or just for those specified</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures">
<code class="sig-name descname">compute_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">block</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the value of the target function and its gradients. Set
approximate curvatures as a side-effect</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals">
<code class="sig-name descname">compute_residuals</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their weights</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients">
<code class="sig-name descname">compute_residuals_and_gradients</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">block</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their gradients and weights for
non-linear least squares methods</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures">
<code class="sig-name descname">compute_restraints_functional_gradients_and_curvatures</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>use the restraints_parameterisation object, if present, to
calculate the least squares restraints objective plus gradients and
approximate curvatures</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients">
<code class="sig-name descname">compute_restraints_residuals_and_gradients</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the restraints_parameterisation object, if present, to
calculate the vector of restraints residuals plus their gradients and
weights for non-linear least squares methods</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.dim">
<em class="property">property </em><code class="sig-name descname">dim</code><a class="headerlink" href="#dials.algorithms.refinement.target.Target.dim" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the number of dimensions of the target function</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches">
<code class="sig-name descname">get_num_matches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment">
<code class="sig-name descname">get_num_matches_for_experiment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">iexp</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_panel">
<code class="sig-name descname">get_num_matches_for_panel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ipanel</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>perform reflection prediction for the working reflections and update the
reflection manager</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_free_reflections">
<code class="sig-name descname">predict_for_free_reflections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for the reflections not used for refinement</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_reflection_table">
<code class="sig-name descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">skip_derivatives</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_names">
<code class="sig-name descname">rmsd_names</code><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_Phi']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_units">
<code class="sig-name descname">rmsd_units</code><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.rmsds">
<code class="sig-name descname">rmsds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the matches</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_experiment">
<code class="sig-name descname">rmsds_for_experiment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">iexp</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected experiment.</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_panel">
<code class="sig-name descname">rmsds_for_panel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ipanel</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected panel.</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table">
<code class="sig-name descname">rmsds_for_reflection_table</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the specified reflections. Caution: this
assumes that the table reflections has the keys expected by _rmsds_core</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.split_matches_into_blocks">
<code class="sig-name descname">split_matches_into_blocks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nproc</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.split_matches_into_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of the matches, split into blocks according to the
gradient_calculation_blocksize parameter and the number of processes (if relevant).
The number of blocks will be set such that the total number of reflections
being processed by concurrent processes does not exceed gradient_calculation_blocksize</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target.Target.update_matches">
<code class="sig-name descname">update_matches</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">force</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.update_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.update_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure the observations matched to predictions are up to date</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.target.TargetFactory">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target.</code><code class="sig-name descname">TargetFactory</code><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#TargetFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.TargetFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/2/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt id="dials.algorithms.refinement.target.TargetFactory.from_parameters_and_experiments">
<em class="property">static </em><code class="sig-name descname">from_parameters_and_experiments</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">pred_param</span></em>, <em class="sig-param"><span class="n">restraints_param</span></em>, <em class="sig-param"><span class="n">do_stills</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">do_sparse</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#TargetFactory.from_parameters_and_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.TargetFactory.from_parameters_and_experiments" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, configure a factory to build a
target function</p>
<dl class="simple">
<dt>Params:</dt><dd><p>params The input parameters</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The target factory instance</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target_stills"></span><dl class="py class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target_stills.</code><code class="sig-name descname">LeastSquaresStillsResidualWithRmsdCutoff</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">restraints_parameterisation</span></em>, <em class="sig-param"><span class="n">frac_binsize_cutoff</span><span class="o">=</span><span class="default_value">0.33333</span></em>, <em class="sig-param"><span class="n">absolute_cutoffs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gradient_calculation_blocksize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target.Target</span></code></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and minimum rotation to the Ewald
sphere, DeltaPsi. Terminates refinement on achieved rmsd (or on intrisic
convergence of the chosen minimiser)</p>
<dl class="py method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved">
<code class="sig-name descname">achieved</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

<dl class="py method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table">
<code class="sig-name descname">predict_for_reflection_table</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">reflections</span></em>, <em class="sig-param"><span class="n">skip_derivatives</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names">
<code class="sig-name descname">rmsd_names</code><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_DeltaPsi']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units">
<code class="sig-name descname">rmsd_units</code><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse">
<em class="property">class </em><code class="sig-prename descclassname">dials.algorithms.refinement.target_stills.</code><code class="sig-name descname">LeastSquaresStillsResidualWithRmsdCutoffSparse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">experiments</span></em>, <em class="sig-param"><span class="n">predictor</span></em>, <em class="sig-param"><span class="n">reflection_manager</span></em>, <em class="sig-param"><span class="n">prediction_parameterisation</span></em>, <em class="sig-param"><span class="n">restraints_parameterisation</span></em>, <em class="sig-param"><span class="n">frac_binsize_cutoff</span><span class="o">=</span><span class="default_value">0.33333</span></em>, <em class="sig-param"><span class="n">absolute_cutoffs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gradient_calculation_blocksize</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></code></a>, <a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff"><code class="xref py py-class docutils literal notranslate"><span class="pre">dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff</span></code></a></p>
<p>A version of the LeastSquaresStillsResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">How-to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../workshops/index.html">Workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="https://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../../_static/diamond_logo.png" /></a>
  <a href="https://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../../_static/CCP4-logo-plain.png" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="https://dials.github.io/images/logos/ukri-stfc.png" /></a>
  <a href="https://www.lbl.gov/"><img class="logofooter" alt="LBL" src="https://dials.github.io/images/logos/lbl.png" /></a>
  <a href="http://smb.slac.stanford.edu/"><img class="logofooter" alt="SSRL/SMB" src="https://dials.github.io/images/logos/smbssrl.jpg" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2020, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>