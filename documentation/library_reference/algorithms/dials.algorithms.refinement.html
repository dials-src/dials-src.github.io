
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dials.algorithms.refinement &mdash; DIALS  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/button.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/dials-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/dials_icon.png"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="DIALS  documentation" href="../../../index.html" />
    <link rel="up" title="Algorithms" href="index.html" />
    <link rel="prev" title="dials.algorithms.profile_model" href="dials.algorithms.profile_model.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
  <div class="logoheader container">
  <a href="../../../index.html">
  <img class="logoheader" alt="DIALS" src="../../../_static/dials_header.png" />
  </a>
  </div>
  


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dials-algorithms-refinement">
<h1><a class="toc-backref" href="#id1">dials.algorithms.refinement</a><a class="headerlink" href="#dials-algorithms-refinement" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dials-algorithms-refinement" id="id1">dials.algorithms.refinement</a></li>
</ul>
</div>
<span class="target" id="module-dials.algorithms.refinement.reflection_manager"></span><p>Contains classes used to manage the reflections used during refinement,
principally ReflectionManager.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.reflection_manager.</tt><tt class="descname">BlockCalculator</tt><big>(</big><em>experiments</em>, <em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Utility class to calculate and set columns in the provided reflection
table, which will be used during scan-varying refinement. The columns are a
&#8216;block&#8217; number and an associated &#8216;block_centre&#8217;, giving the image number in
the centre of the block</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image"><tt class="xref py py-obj docutils literal"><span class="pre">per_image</span></tt></a>()</td>
<td>Set one block per image for all experiments</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width"><tt class="xref py py-obj docutils literal"><span class="pre">per_width</span></tt></a>(width[,&nbsp;deg])</td>
<td>Set blocks for all experiments according to a constant width</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image">
<tt class="descname">per_image</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Set one block per image for all experiments</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width">
<tt class="descname">per_width</tt><big>(</big><em>width</em>, <em>deg=True</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#BlockCalculator.per_width"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.BlockCalculator.per_width" title="Permalink to this definition">¶</a></dt>
<dd><p>Set blocks for all experiments according to a constant width</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.reflection_manager.</tt><tt class="descname">ReflectionManager</tt><big>(</big><em>reflections</em>, <em>experiments</em>, <em>nref_per_degree=None</em>, <em>max_sample_size=None</em>, <em>min_sample_size=0</em>, <em>close_to_spindle_cutoff=0.1</em>, <em>outlier_detector=None</em>, <em>weighting_strategy_override=None</em>, <em>verbosity=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>A class to maintain information about observed and predicted
reflections for refinement.</p>
<p>This new version keeps the reflections as a reflection table. Initialisation
is not complete until the ReflectionManager is paired with a target function.
Then, prediction can be done, followed by outlier rejection and any random
sampling to form the working subset.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs"><tt class="xref py py-obj docutils literal"><span class="pre">filter_obs</span></tt></a>(sel)</td>
<td>Perform a flex array selection on the managed observations, so that</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise"><tt class="xref py py-obj docutils literal"><span class="pre">finalise</span></tt></a>()</td>
<td>Complete initialisation by performing outlier rejection and any requested subsetting.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size"><tt class="xref py py-obj docutils literal"><span class="pre">get_accepted_refs_size</span></tt></a>()</td>
<td>Return the number of observations that pass inclusion criteria and</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections"><tt class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></tt></a>()</td>
<td>Return all reflections that were accepted for refinement but not chosen</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed"><tt class="xref py py-obj docutils literal"><span class="pre">get_indexed</span></tt></a>()</td>
<td>Return the reflections passed in as input</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches"><tt class="xref py py-obj docutils literal"><span class="pre">get_matches</span></tt></a>()</td>
<td>For every observation used in refinement return (a copy of) all data</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs"><tt class="xref py py-obj docutils literal"><span class="pre">get_obs</span></tt></a>()</td>
<td>Get the list of managed observations</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size"><tt class="xref py py-obj docutils literal"><span class="pre">get_sample_size</span></tt></a>()</td>
<td>Return the number of observations in the working set to be</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches"><tt class="xref py py-obj docutils literal"><span class="pre">print_stats_on_matches</span></tt></a>()</td>
<td>Print some basic statistics on the matches</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections"><tt class="xref py py-obj docutils literal"><span class="pre">reset_accepted_reflections</span></tt></a>([reflections])</td>
<td>Reset use flags for all observations in preparation for a new set of</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs">
<tt class="descname">filter_obs</tt><big>(</big><em>sel</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.filter_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.filter_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a flex array selection on the managed observations, so that
external classes can filter according to criteria not available here</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise">
<tt class="descname">finalise</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.finalise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.finalise" title="Permalink to this definition">¶</a></dt>
<dd><p>Complete initialisation by performing outlier rejection and any
requested subsetting. This function to be called by a Target object</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size">
<tt class="descname">get_accepted_refs_size</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_accepted_refs_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_accepted_refs_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations that pass inclusion criteria and
can potentially be used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections">
<tt class="descname">get_free_reflections</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all reflections that were accepted for refinement but not chosen
in the working set</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed">
<tt class="descname">get_indexed</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the reflections passed in as input</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches">
<tt class="descname">get_matches</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>For every observation used in refinement return (a copy of) all data</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs">
<tt class="descname">get_obs</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_obs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_obs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of managed observations</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size">
<tt class="descname">get_sample_size</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.get_sample_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.get_sample_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of observations in the working set to be
used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches">
<tt class="descname">print_stats_on_matches</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections">
<tt class="descname">reset_accepted_reflections</tt><big>(</big><em>reflections=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#ReflectionManager.reset_accepted_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager.reset_accepted_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset use flags for all observations in preparation for a new set of
predictions</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.reflection_manager.</tt><tt class="descname">StillsReflectionManager</tt><big>(</big><em>reflections</em>, <em>experiments</em>, <em>nref_per_degree=None</em>, <em>max_sample_size=None</em>, <em>min_sample_size=0</em>, <em>close_to_spindle_cutoff=0.1</em>, <em>outlier_detector=None</em>, <em>weighting_strategy_override=None</em>, <em>verbosity=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.ReflectionManager" title="dials.algorithms.refinement.reflection_manager.ReflectionManager"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.reflection_manager.ReflectionManager</span></tt></a></p>
<p>Overloads for a Reflection Manager that does not exclude
reflections too close to the spindle, and reports only information
about X, Y, DelPsi residuals</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">filter_obs</span></tt>(sel)</td>
<td>Perform a flex array selection on the managed observations, so that</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">finalise</span></tt>()</td>
<td>Complete initialisation by performing outlier rejection and any requested subsetting.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_accepted_refs_size</span></tt>()</td>
<td>Return the number of observations that pass inclusion criteria and</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></tt>()</td>
<td>Return all reflections that were accepted for refinement but not chosen</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_indexed</span></tt>()</td>
<td>Return the reflections passed in as input</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_matches</span></tt>()</td>
<td>For every observation used in refinement return (a copy of) all data</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_obs</span></tt>()</td>
<td>Get the list of managed observations</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_sample_size</span></tt>()</td>
<td>Return the number of observations in the working set to be</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches"><tt class="xref py py-obj docutils literal"><span class="pre">print_stats_on_matches</span></tt></a>()</td>
<td>Print some basic statistics on the matches</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">reset_accepted_reflections</span></tt>([reflections])</td>
<td>Reset use flags for all observations in preparation for a new set of</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches">
<tt class="descname">print_stats_on_matches</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#StillsReflectionManager.print_stats_on_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.StillsReflectionManager.print_stats_on_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Print some basic statistics on the matches</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="dials.algorithms.refinement.reflection_manager.calculate_entering_flags">
<tt class="descclassname">dials.algorithms.refinement.reflection_manager.</tt><tt class="descname">calculate_entering_flags</tt><big>(</big><em>reflections</em>, <em>experiments</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/reflection_manager.html#calculate_entering_flags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.reflection_manager.calculate_entering_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate entering flags for all reflections, and set them as a column
of the reflection table.</p>
</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.weighting_strategies"></span><p>Contains classes used to provide weighting schemes as strategies for
ReflectionManagers.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.weighting_strategies.</tt><tt class="descname">ConstantWeightingStrategy</tt><big>(</big><em>wx</em>, <em>wy</em>, <em>wz</em>, <em>stills=False</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights"><tt class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></tt></a>(reflections)</td>
<td>Set weights to constant terms.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights">
<tt class="descname">calculate_weights</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#ConstantWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.ConstantWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Set weights to constant terms. If stills, the z weights are
the &#8216;delpsical.weights&#8217; attribute of the reflection table. Otherwise, use
the usual &#8216;xyzobs.mm.weights&#8217;</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.weighting_strategies.</tt><tt class="descname">StatisticalWeightingStrategy</tt><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights"><tt class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></tt></a>(reflections)</td>
<td>set &#8216;statistical weights&#8217;, that is w(x) = 1/var(x)</td>
</tr>
</tbody>
</table>
<dl class="staticmethod">
<dt id="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights">
<em class="property">static </em><tt class="descname">calculate_weights</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StatisticalWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>set &#8216;statistical weights&#8217;, that is w(x) = 1/var(x)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.weighting_strategies.</tt><tt class="descname">StillsWeightingStrategy</tt><big>(</big><em>delpsi_constant=10000</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy" title="dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.weighting_strategies.StatisticalWeightingStrategy</span></tt></a></p>
<p>Defines a single method that provides a ReflectionManager with a strategy
for calculating weights for refinement. This version uses statistical weights
for X and Y and a fixed constant for the delta Psi part, defaulting to 10000</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights"><tt class="xref py py-obj docutils literal"><span class="pre">calculate_weights</span></tt></a>(reflections)</td>
<td>Include weights for DeltaPsi</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights">
<tt class="descname">calculate_weights</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/weighting_strategies.html#StillsWeightingStrategy.calculate_weights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.weighting_strategies.StillsWeightingStrategy.calculate_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Include weights for DeltaPsi</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.refiner"></span><p>Refiner is the refinement module public interface. RefinerFactory is
what should usually be used to construct a Refiner.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.refiner.Refiner">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.refiner.</tt><tt class="descname">Refiner</tt><big>(</big><em>reflections</em>, <em>experiments</em>, <em>pred_param</em>, <em>param_reporter</em>, <em>refman</em>, <em>target</em>, <em>refinery</em>, <em>verbosity=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Public interface for performing DIALS refinement.</p>
<dl class="docutils">
<dt>Public methods:</dt>
<dd>run
rmsds
get_experiments
get_matches
get_param_reporter
parameter_correlation_plot
selection_used_for_refinement
predict_for_reflection_table
predict_for_indexed</dd>
<dt>Notes:</dt>
<dd><ul class="first last simple">
<li>The return value of run is a recorded history of the refinement</li>
<li>The experiments accessor provides a copy of the experiments used by
refinement</li>
<li>The model accessors provide copies of those models that might be modified
by refinement (beam, crystal and detector) TO BE DEPRECATED</li>
<li>get_matches exposes the function of the same name from the privately
stored reflection manager</li>
<li>The return value of selection_used_for_refinement is a flex.bool</li>
</ul>
</dd>
</dl>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="dials.algorithms.refinement.refiner.Refiner.get_experiments"><tt class="xref py py-obj docutils literal"><span class="pre">get_experiments</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="dials.algorithms.refinement.refiner.Refiner.get_free_reflections"><tt class="xref py py-obj docutils literal"><span class="pre">get_free_reflections</span></tt></a>()</td>
<td>Delegated to the reflection manager</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="dials.algorithms.refinement.refiner.Refiner.get_matches"><tt class="xref py py-obj docutils literal"><span class="pre">get_matches</span></tt></a>()</td>
<td>Delegated to the reflection manager</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="dials.algorithms.refinement.refiner.Refiner.get_param_reporter"><tt class="xref py py-obj docutils literal"><span class="pre">get_param_reporter</span></tt></a>()</td>
<td>Get the ParameterReport object linked to this Refiner</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix"><tt class="xref py py-obj docutils literal"><span class="pre">get_parameter_correlation_matrix</span></tt></a>(step[,&nbsp;...])</td>
<td>Return the correlation matrix between columns of the Jacobian at the specified refinement step.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed"><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_indexed</span></tt></a>()</td>
<td>perform prediction for all the indexed reflections passed into</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table"><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt></a>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table"><tt class="xref py py-obj docutils literal"><span class="pre">print_exp_rmsd_table</span></tt></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table"><tt class="xref py py-obj docutils literal"><span class="pre">print_out_of_sample_rmsd_table</span></tt></a>()</td>
<td>print out-of-sample RSMDs per step, if these were tracked</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table"><tt class="xref py py-obj docutils literal"><span class="pre">print_panel_rmsd_table</span></tt></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="dials.algorithms.refinement.refiner.Refiner.print_step_table"><tt class="xref py py-obj docutils literal"><span class="pre">print_step_table</span></tt></a>()</td>
<td>print useful output about refinement steps in the form of a simple table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="dials.algorithms.refinement.refiner.Refiner.rmsds"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt></a>()</td>
<td>Return rmsds of the current model</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt></a>(reflections)</td>
<td>Calculate unweighted RMSDs for the specified reflections</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.run" title="dials.algorithms.refinement.refiner.Refiner.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td>Run refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement"><tt class="xref py py-obj docutils literal"><span class="pre">selection_used_for_refinement</span></tt></a>()</td>
<td>Return a selection as a flex.bool in terms of the input reflection data of those reflections that were used in the final step of refinement.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_experiments">
<tt class="descname">get_experiments</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_experiments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_free_reflections">
<tt class="descname">get_free_reflections</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_matches">
<tt class="descname">get_matches</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Delegated to the reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_param_reporter">
<tt class="descname">get_param_reporter</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_param_reporter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_param_reporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the ParameterReport object linked to this Refiner</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix">
<tt class="descname">get_parameter_correlation_matrix</tt><big>(</big><em>step</em>, <em>col_select=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.get_parameter_correlation_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.get_parameter_correlation_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the correlation matrix between columns of the Jacobian at
the specified refinement step. The parameter col_select can be used
to select subsets of the full number of columns. The column labels
are also returned as a list of strings</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_indexed">
<tt class="descname">predict_for_indexed</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_indexed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_indexed" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all the indexed reflections passed into
refinement and additionally set the used_in_refinement flag</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table">
<tt class="descname">predict_for_reflection_table</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table">
<tt class="descname">print_exp_rmsd_table</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_exp_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_exp_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table">
<tt class="descname">print_out_of_sample_rmsd_table</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_out_of_sample_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_out_of_sample_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print out-of-sample RSMDs per step, if these were tracked</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table">
<tt class="descname">print_panel_rmsd_table</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_panel_rmsd_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_panel_rmsd_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.print_step_table">
<tt class="descname">print_step_table</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.print_step_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.print_step_table" title="Permalink to this definition">¶</a></dt>
<dd><p>print useful output about refinement steps in the form of a simple table</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds">
<tt class="descname">rmsds</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>Return rmsds of the current model</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table">
<tt class="descname">rmsds_for_reflection_table</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate unweighted RMSDs for the specified reflections</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement">
<tt class="descname">selection_used_for_refinement</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#Refiner.selection_used_for_refinement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.Refiner.selection_used_for_refinement" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a selection as a flex.bool in terms of the input reflection
data of those reflections that were used in the final step of
refinement.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.refiner.</tt><tt class="descname">RefinerFactory</tt><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Factory class to create refiners</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation" title="dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation"><tt class="xref py py-obj docutils literal"><span class="pre">config_parameterisation</span></tt></a>(params,&nbsp;experiments,&nbsp;...)</td>
<td>Given a set of parameters, create a parameterisation from a set of experimental models.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery"><tt class="xref py py-obj docutils literal"><span class="pre">config_refinery</span></tt></a>(params,&nbsp;target,&nbsp;pred_param,&nbsp;...)</td>
<td>Given a set of parameters, a target class, and a prediction</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refman" title="dials.algorithms.refinement.refiner.RefinerFactory.config_refman"><tt class="xref py py-obj docutils literal"><span class="pre">config_refman</span></tt></a>(params,&nbsp;reflections,&nbsp;...)</td>
<td>Given a set of parameters and models, build a reflection manager</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints"><tt class="xref py py-obj docutils literal"><span class="pre">config_restraints</span></tt></a>(params,&nbsp;det_params,&nbsp;...)</td>
<td>Given a set of user parameters plus model parameterisations, create a</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse"><tt class="xref py py-obj docutils literal"><span class="pre">config_sparse</span></tt></a>(params,&nbsp;experiments)</td>
<td>Configure whether to use sparse datatypes</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="dials.algorithms.refinement.refiner.RefinerFactory.config_target"><tt class="xref py py-obj docutils literal"><span class="pre">config_target</span></tt></a>(params,&nbsp;experiments,&nbsp;refman,&nbsp;...)</td>
<td>Given a set of parameters, configure a factory to build a</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments"><tt class="xref py py-obj docutils literal"><span class="pre">from_parameters_data_experiments</span></tt></a>(params,&nbsp;...)</td>
<td></td>
</tr>
</tbody>
</table>
<dl class="classmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation">
<em class="property">classmethod </em><tt class="descname">config_parameterisation</tt><big>(</big><em>params</em>, <em>experiments</em>, <em>refman</em>, <em>do_stills</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, create a parameterisation from a set of
experimental models.</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters
experiments An ExperimentList object</dd>
<dt>Returns:</dt>
<dd>A tuple of the prediction equation parameterisation and the
parameter reporter.</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_refinery">
<em class="property">static </em><tt class="descname">config_refinery</tt><big>(</big><em>params</em>, <em>target</em>, <em>pred_param</em>, <em>verbosity</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, a target class, and a prediction
parameterisation class, build a refinery</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The refinery instance</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_refman">
<em class="property">static </em><tt class="descname">config_refman</tt><big>(</big><em>params</em>, <em>reflections</em>, <em>experiments</em>, <em>do_stills</em>, <em>verbosity</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_refman"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_refman" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters and models, build a reflection manager</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The reflection manager instance</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_restraints">
<em class="property">static </em><tt class="descname">config_restraints</tt><big>(</big><em>params</em>, <em>det_params</em>, <em>beam_params</em>, <em>xl_ori_params</em>, <em>xl_uc_params</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_restraints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of user parameters plus model parameterisations, create a
restraints plus a parameterisation of these restraints</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters
det_params A list of detector parameterisations
beam_params A list of beam parameterisations,
xl_ori_params A list of crystal orientation parameterisations
xl_uc_params A list of crystal unit cell parameterisations</dd>
<dt>Returns:</dt>
<dd>A restraints parameterisation</dd>
</dl>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_sparse">
<em class="property">static </em><tt class="descname">config_sparse</tt><big>(</big><em>params</em>, <em>experiments</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_sparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_sparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure whether to use sparse datatypes</p>
</dd></dl>

<dl class="staticmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.config_target">
<em class="property">static </em><tt class="descname">config_target</tt><big>(</big><em>params</em>, <em>experiments</em>, <em>refman</em>, <em>do_stills</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.config_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.config_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a set of parameters, configure a factory to build a
target function</p>
<dl class="docutils">
<dt>Params:</dt>
<dd>params The input parameters</dd>
<dt>Returns:</dt>
<dd>The target factory instance</dd>
</dl>
</dd></dl>

<dl class="classmethod">
<dt id="dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments">
<em class="property">classmethod </em><tt class="descname">from_parameters_data_experiments</tt><big>(</big><em>params</em>, <em>reflections</em>, <em>experiments</em>, <em>verbosity=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/refiner.html#RefinerFactory.from_parameters_data_experiments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.refiner.RefinerFactory.from_parameters_data_experiments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.engine"></span><p>Contains classes for refinement engines. Refinery is the shared interface,
LevenbergMarquardtIterations, GaussNewtonIterations, SimpleLBFGS and LBFGScurvs
are the current concrete implementations</p>
<dl class="class">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">AdaptLbfgs</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></tt></a></p>
<p>Adapt Refinery for L-BFGS minimiser</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step"><tt class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></tt></a>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients"><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures"><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs"><tt class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></tt></a>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs.set_nproc" title="dials.algorithms.refinement.engine.AdaptLbfgs.set_nproc"><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt></a>(nproc)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step">
<tt class="descname">callback_after_step</tt><big>(</big><em>minimizer</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.callback_after_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.callback_after_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Do journalling, evaluate rmsds and return True if the target is
reached to terminate the refinement.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients">
<tt class="descname">compute_functional_and_gradients</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures">
<tt class="descname">compute_functional_gradients_and_curvatures</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs">
<tt class="descname">run_lbfgs</tt><big>(</big><em>curvatures=False</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.run_lbfgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.run_lbfgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the minimiser, keeping track of its log.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLbfgs.set_nproc">
<tt class="descname">set_nproc</tt><big>(</big><em>nproc</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLbfgs.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLbfgs.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">AdaptLstbx</tt><big>(</big><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery" title="dials.algorithms.refinement.engine.Refinery"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.Refinery</span></tt></a>, <tt class="xref py py-class docutils literal"><span class="pre">scitbx_lstbx_normal_equations_ext.non_linear_ls</span></tt>, <a class="reference external" href="http://cci.lbl.gov/cctbx_docs/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns.non_linear_ls_mixin" title="(in CCTBX vr21242)"><tt class="xref py py-class docutils literal"><span class="pre">scitbx.lstbx.normal_eqns.non_linear_ls_mixin</span></tt></a></p>
<p>Adapt Refinery for lstbx</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">dof</span></tt></td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_equations</span></tt></td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></tt></td>
<td></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equation</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equations</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residual</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="dials.algorithms.refinement.engine.AdaptLstbx.build_up"><tt class="xref py py-obj docutils literal"><span class="pre">build_up</span></tt></a>([objective_only])</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.finalise" title="dials.algorithms.refinement.engine.AdaptLstbx.finalise"><tt class="xref py py-obj docutils literal"><span class="pre">finalise</span></tt></a>()</td>
<td>perform various post-run tasks</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">objective</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm"><tt class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">reset</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="dials.algorithms.refinement.engine.AdaptLstbx.restart"><tt class="xref py py-obj docutils literal"><span class="pre">restart</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_nproc" title="dials.algorithms.refinement.engine.AdaptLstbx.set_nproc"><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt></a>(nproc)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="dials.algorithms.refinement.engine.AdaptLstbx.step_backward"><tt class="xref py py-obj docutils literal"><span class="pre">step_backward</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_equations</span></tt>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="dials.algorithms.refinement.engine.AdaptLstbx.step_forward"><tt class="xref py py-obj docutils literal"><span class="pre">step_forward</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.build_up">
<tt class="descname">build_up</tt><big>(</big><em>objective_only=False</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.build_up"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.build_up" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.finalise">
<tt class="descname">finalise</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.finalise"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.finalise" title="Permalink to this definition">¶</a></dt>
<dd><p>perform various post-run tasks</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm">
<tt class="descname">parameter_vector_norm</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.parameter_vector_norm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.parameter_vector_norm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.restart">
<tt class="descname">restart</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.restart"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.restart" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.set_nproc">
<tt class="descname">set_nproc</tt><big>(</big><em>nproc</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_backward">
<tt class="descname">step_backward</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_backward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_backward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.AdaptLstbx.step_forward">
<tt class="descname">step_forward</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#AdaptLstbx.step_forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.AdaptLstbx.step_forward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">GaussNewtonIterations</tt><big>(</big><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=20</em>, <em>**kwds</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLstbx" title="dials.algorithms.refinement.engine.AdaptLstbx"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLstbx</span></tt></a>, <a class="reference external" href="http://cci.lbl.gov/cctbx_docs/scitbx/scitbx.lstbx.html#scitbx.lstbx.normal_eqns_solving.iterations" title="(in CCTBX vr21242)"><tt class="xref py py-class docutils literal"><span class="pre">scitbx.lstbx.normal_eqns_solving.iterations</span></tt></a></p>
<p>Refinery implementation, using lstbx Gauss Newton iterations</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">dof</span></tt></td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_equations</span></tt></td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></tt></td>
<td></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>step_threshold</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equation</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equations</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residual</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">build_up</span></tt>([objective_only])</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">do</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">do_damping</span></tt>(value)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">do_scale_shifts</span></tt>(max_shift_over_esd)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">finalise</span></tt>()</td>
<td>perform various post-run tasks</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">had_too_small_a_step</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">has_gradient_converged_to_zero</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">objective</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">reset</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">restart</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="dials.algorithms.refinement.engine.GaussNewtonIterations.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt>(nproc)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">step</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_backward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_equations</span></tt>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_forward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd">
<tt class="descname">convergence_as_shift_over_esd</tt><em class="property"> = 1e-05</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.convergence_as_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value">
<tt class="descname">damping_value</tt><em class="property"> = 0.0007</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.damping_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold">
<tt class="descname">gradient_threshold</tt><em class="property"> = 1e-10</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.gradient_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd">
<tt class="descname">max_shift_over_esd</tt><em class="property"> = 15</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.max_shift_over_esd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#GaussNewtonIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold">
<tt class="descname">step_threshold</tt><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.GaussNewtonIterations.step_threshold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.Journal">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">Journal</tt><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a></p>
<p>Container in which to store information about refinement history.</p>
<p>This is simply a dict but provides some extra methods for access that
maintain values as columns in a table. Refinery classes will use these methods
while entering data to ensure the table remains consistent. Methods inherited
from dict are not hidden for ease of use of this object when returned to the
user.</p>
<p class="rubric">Attributes</p>
<table border="1" class="docutils">
<colgroup>
<col width="69%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>reason_for_termination</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.add_column" title="dials.algorithms.refinement.engine.Journal.add_column"><tt class="xref py py-obj docutils literal"><span class="pre">add_column</span></tt></a>(key)</td>
<td>Add a new column named by key</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.add_row" title="dials.algorithms.refinement.engine.Journal.add_row"><tt class="xref py py-obj docutils literal"><span class="pre">add_row</span></tt></a>()</td>
<td>Add an element to the end of each of the columns.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">clear</span></tt>(()&nbsp;-&gt;&nbsp;None.&nbsp;&nbsp;Remove&nbsp;all&nbsp;items&nbsp;from&nbsp;D.)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">copy</span></tt>(()&nbsp;-&gt;&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;D)</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="dials.algorithms.refinement.engine.Journal.del_last_row"><tt class="xref py py-obj docutils literal"><span class="pre">del_last_row</span></tt></a>()</td>
<td>Delete the last element from the each of the columns.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">fromkeys</span></tt>(...)</td>
<td>v defaults to None.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get</span></tt>((k[,d])&nbsp;-&gt;&nbsp;D[k]&nbsp;if&nbsp;k&nbsp;in&nbsp;D,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="dials.algorithms.refinement.engine.Journal.get_nrows"><tt class="xref py py-obj docutils literal"><span class="pre">get_nrows</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">has_key</span></tt>((k)&nbsp;-&gt;&nbsp;True&nbsp;if&nbsp;D&nbsp;has&nbsp;a&nbsp;key&nbsp;k,&nbsp;else&nbsp;False)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">items</span></tt>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;(key,&nbsp;value)&nbsp;pairs,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">iteritems</span></tt>(()&nbsp;-&gt;&nbsp;an&nbsp;iterator&nbsp;over&nbsp;the&nbsp;(key,&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">iterkeys</span></tt>(()&nbsp;-&gt;&nbsp;an&nbsp;iterator&nbsp;over&nbsp;the&nbsp;keys&nbsp;of&nbsp;D)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">itervalues</span></tt>(...)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">keys</span></tt>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;keys)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">pop</span></tt>((k[,d])&nbsp;-&gt;&nbsp;v,&nbsp;...)</td>
<td>If key is not found, d is returned if given, otherwise KeyError is raised</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">popitem</span></tt>(()&nbsp;-&gt;&nbsp;(k,&nbsp;v),&nbsp;...)</td>
<td>2-tuple; but raise KeyError if D is empty.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="dials.algorithms.refinement.engine.Journal.set_last_cell"><tt class="xref py py-obj docutils literal"><span class="pre">set_last_cell</span></tt></a>(key,&nbsp;value)</td>
<td>Set last cell in column given by key to value.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">setdefault</span></tt>((k[,d])&nbsp;-&gt;&nbsp;D.get(k,d),&nbsp;...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update</span></tt>(([E,&nbsp;...)</td>
<td>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">values</span></tt>(()&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;D&#8217;s&nbsp;values)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">viewitems</span></tt>(...)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">viewkeys</span></tt>(...)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">viewvalues</span></tt>(...)</td>
<td></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.add_column">
<tt class="descname">add_column</tt><big>(</big><em>key</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_column"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_column" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new column named by key</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.add_row">
<tt class="descname">add_row</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.add_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.add_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an element to the end of each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.del_last_row">
<tt class="descname">del_last_row</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.del_last_row"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.del_last_row" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the last element from the each of the columns. Fail if any columns
are the wrong length</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.get_nrows">
<tt class="descname">get_nrows</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.get_nrows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.get_nrows" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.Journal.reason_for_termination">
<tt class="descname">reason_for_termination</tt><em class="property"> = None</em><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.reason_for_termination" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Journal.set_last_cell">
<tt class="descname">set_last_cell</tt><big>(</big><em>key</em>, <em>value</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Journal.set_last_cell"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Journal.set_last_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>Set last cell in column given by key to value. Fail if the column is the
wrong length</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">LBFGScurvs</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></tt></a></p>
<p>Refinery implementation using cctbx LBFGS with curvatures</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></tt>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag"><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_diag</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="dials.algorithms.refinement.engine.LBFGScurvs.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></tt>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt>(nproc)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag">
<tt class="descname">compute_functional_gradients_diag</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.compute_functional_gradients_diag"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.compute_functional_gradients_diag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LBFGScurvs.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LBFGScurvs.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LBFGScurvs.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">LevenbergMarquardtIterations</tt><big>(</big><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=20</em>, <em>**kwds</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.GaussNewtonIterations" title="dials.algorithms.refinement.engine.GaussNewtonIterations"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.GaussNewtonIterations</span></tt></a></p>
<p>Refinery implementation, employing lstbx Levenberg Marquadt
iterations</p>
<p class="rubric">Attributes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">dof</span></tt></td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu"><tt class="xref py py-obj docutils literal"><span class="pre">mu</span></tt></a></td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_equations</span></tt></td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">n_parameters</span></tt></td>
<td></td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="58%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>step_threshold</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equation</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_equations</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residual</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">add_residuals</span></tt>((&nbsp;(non_linear_ls)arg1,&nbsp;...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">build_up</span></tt>([objective_only])</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">chi_sq</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">do</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">do_damping</span></tt>(value)</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">do_scale_shifts</span></tt>(max_shift_over_esd)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">finalise</span></tt>()</td>
<td>perform various post-run tasks</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">had_too_small_a_step</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">has_gradient_converged_to_zero</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">normal_matrix_packed_u</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">objective</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;float&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">opposite_of_gradient</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">parameter_vector_norm</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">reset</span></tt>((&nbsp;(non_linear_ls)arg1)&nbsp;-&gt;&nbsp;None&nbsp;:)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">restart</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt>(nproc)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">solve_and_step_forward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">step</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_backward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_equations</span></tt>(...)</td>
<td>C++ signature :</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">step_forward</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu">
<tt class="descname">mu</tt><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.mu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.mu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#LevenbergMarquardtIterations.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau">
<tt class="descname">tau</tt><em class="property"> = 0.001</em><a class="headerlink" href="#dials.algorithms.refinement.engine.LevenbergMarquardtIterations.tau" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.Refinery">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">Refinery</tt><big>(</big><em>target</em>, <em>prediction_parameterisation</em>, <em>log=None</em>, <em>verbosity=0</em>, <em>track_step=False</em>, <em>track_gradient=False</em>, <em>track_parameter_correlation=False</em>, <em>track_out_of_sample_rmsd=False</em>, <em>max_iterations=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Interface for Refinery objects. This should be subclassed and the run
method implemented.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step"><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt></a>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="dials.algorithms.refinement.engine.Refinery.get_num_steps"><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="dials.algorithms.refinement.engine.Refinery.prepare_for_step"><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt></a>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.run" title="dials.algorithms.refinement.engine.Refinery.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td>To be implemented by derived class.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="dials.algorithms.refinement.engine.Refinery.set_nproc"><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt></a>(nproc)</td>
<td>to be implemented only by derived classes that support multiprocessing</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="dials.algorithms.refinement.engine.Refinery.test_for_termination"><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt></a>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref"><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt></a>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence"><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt></a>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="dials.algorithms.refinement.engine.Refinery.update_journal"><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt></a>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step">
<tt class="descname">get_correlation_matrix_for_step</tt><big>(</big><em>step</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_correlation_matrix_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_correlation_matrix_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Decompress and return the full 2D correlation matrix between columns of
the Jacobian that was stored in the journal at the given step number. If
not available, return None</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.get_num_steps">
<tt class="descname">get_num_steps</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.get_num_steps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.get_num_steps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.prepare_for_step">
<tt class="descname">prepare_for_step</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.prepare_for_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.prepare_for_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameterisation and prepare the target function</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.run" title="Permalink to this definition">¶</a></dt>
<dd><p>To be implemented by derived class. It is expected that each step of
refinement be preceeded by a call to prepare_for_step and followed by
calls to update_journal and test_for_termination (in that order).</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.set_nproc">
<tt class="descname">set_nproc</tt><big>(</big><em>nproc</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.set_nproc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.set_nproc" title="Permalink to this definition">¶</a></dt>
<dd><p>to be implemented only by derived classes that support multiprocessing</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_for_termination">
<tt class="descname">test_for_termination</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_for_termination"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_for_termination" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if refinement should be terminated</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref">
<tt class="descname">test_objective_increasing_but_not_nref</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_objective_increasing_but_not_nref"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_objective_increasing_but_not_nref" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for an increase in the objective value between steps. This
could be caused simply by the number of matches between observations
and predictions increasing. However, if the number of matches stayed
the same or reduced then this is a bad sign.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence">
<tt class="descname">test_rmsd_convergence</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.test_rmsd_convergence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.test_rmsd_convergence" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for convergence of RMSDs</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.engine.Refinery.update_journal">
<tt class="descname">update_journal</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#Refinery.update_journal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.Refinery.update_journal" title="Permalink to this definition">¶</a></dt>
<dd><p>Append latest step information to the journal attributes</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.engine.</tt><tt class="descname">SimpleLBFGS</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.engine.AdaptLbfgs" title="dials.algorithms.refinement.engine.AdaptLbfgs"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.engine.AdaptLbfgs</span></tt></a></p>
<p>Refinery implementation, using cctbx LBFGS with basic settings</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">callback_after_step</span></tt>(minimizer)</td>
<td>Do journalling, evaluate rmsds and return True if the target is reached to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_and_gradients</span></tt>()</td>
<td></td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_correlation_matrix_for_step</span></tt>(step)</td>
<td>Decompress and return the full 2D correlation matrix between columns of the Jacobian that was stored in the journal at the given step number.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_steps</span></tt>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">prepare_for_step</span></tt>()</td>
<td>Update the parameterisation and prepare the target function</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="dials.algorithms.refinement.engine.SimpleLBFGS.run"><tt class="xref py py-obj docutils literal"><span class="pre">run</span></tt></a>()</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">run_lbfgs</span></tt>([curvatures])</td>
<td>Run the minimiser, keeping track of its log.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_nproc</span></tt>(nproc)</td>
<td></td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_for_termination</span></tt>()</td>
<td>Return True if refinement should be terminated</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_objective_increasing_but_not_nref</span></tt>()</td>
<td>Test for an increase in the objective value between steps.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">test_rmsd_convergence</span></tt>()</td>
<td>Test for convergence of RMSDs</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_journal</span></tt>()</td>
<td>Append latest step information to the journal attributes</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.engine.SimpleLBFGS.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/engine.html#SimpleLBFGS.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.engine.SimpleLBFGS.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target"></span><p>Contains classes used to construct a target function for refinement,
principally Target and ReflectionManager.</p>
<dl class="class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target.</tt><tt class="descname">LeastSquaresPositionalResidualWithRmsdCutoff</tt><big>(</big><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.Target</span></tt></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and phi, terminating on achieved
rmsd (or on intrisic convergence of the chosen minimiser)</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><tt class="xref py py-obj docutils literal"><span class="pre">achieved</span></tt></a>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></tt>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></tt>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></tt>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></tt>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></tt>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></tt>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></tt>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></tt>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict</span></tt>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></tt>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></tt>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></tt>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></tt>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></tt>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></tt>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_matches</span></tt>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved">
<tt class="descname">achieved</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target.</tt><tt class="descname">LeastSquaresPositionalResidualWithRmsdCutoffSparse</tt><big>(</big><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#LeastSquaresPositionalResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></tt></a>, <a class="reference internal" href="#dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff" title="dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.LeastSquaresPositionalResidualWithRmsdCutoff</span></tt></a></p>
<p>A version of the LeastSquaresPositionalResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">achieved</span></tt>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></tt>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></tt>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></tt>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></tt>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></tt>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></tt>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></tt>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></tt>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict</span></tt>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></tt>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></tt>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></tt>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></tt>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></tt>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></tt>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_matches</span></tt>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.SparseGradientsMixin">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target.</tt><tt class="descname">SparseGradientsMixin</tt><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#SparseGradientsMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin class to build a sparse Jacobian from gradients of the prediction
formula stored as sparse vectors, and allow concatenation of gradient vectors
that employed sparse storage.</p>
</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target.Target">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target.</tt><tt class="descname">Target</tt><big>(</big><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_manager</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation=None</em>, <em>gradient_calculation_blocksize=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a></p>
<p>Abstract interface for a target function class</p>
<p>A Target object will be used by a Refinery. It will refer to a Reflection
Manager to get a list of observations. It will perform reflection prediction
on those observations and update the reflection manager with those
predictions. It will then query the reflection manager to get a list of
accepted reflections with observed and calculated positions. These are the
reflections for use in refinement. It obtains the gradients of reflection
positions from a relevant prediction parameterisation object. With all of
this information in place, it calculates the value of the target function,
the gradients of the target function and auxiliary information (e.g. RMSDs).</p>
<p>Concrete instances of this class implement the actual target function
calculation. The base class should not determine what type of target
function is used (e.g. least squares target), or limit whether the object
is used for a detector space &amp; phi residual, or a reciprocal space residual.
This should all be set by a derived class.</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.achieved" title="dials.algorithms.refinement.target.Target.achieved"><tt class="xref py py-obj docutils literal"><span class="pre">achieved</span></tt></a>()</td>
<td>return True to terminate the refinement.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="dials.algorithms.refinement.target.Target.calculate_gradients"><tt class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></tt></a>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures"><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt></a>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="dials.algorithms.refinement.target.Target.compute_residuals"><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></tt></a>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients"><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></tt></a>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures"><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></tt></a>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients"><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></tt></a>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="dials.algorithms.refinement.target.Target.get_num_matches"><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></tt></a>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment"><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></tt></a>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="dials.algorithms.refinement.target.Target.get_num_matches_for_panel"><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></tt></a>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict" title="dials.algorithms.refinement.target.Target.predict"><tt class="xref py py-obj docutils literal"><span class="pre">predict</span></tt></a>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="dials.algorithms.refinement.target.Target.predict_for_free_reflections"><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></tt></a>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="dials.algorithms.refinement.target.Target.predict_for_reflection_table"><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt></a>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds" title="dials.algorithms.refinement.target.Target.rmsds"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt></a>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="dials.algorithms.refinement.target.Target.rmsds_for_experiment"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></tt></a>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="dials.algorithms.refinement.target.Target.rmsds_for_panel"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></tt></a>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table"><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt></a>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.set_prediction_parameterisation" title="dials.algorithms.refinement.target.Target.set_prediction_parameterisation"><tt class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></tt></a>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.set_restraints_parameterisation" title="dials.algorithms.refinement.target.Target.set_restraints_parameterisation"><tt class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></tt></a>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="dials.algorithms.refinement.target.Target.split_matches_into_blocks"><tt class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></tt></a>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target.Target.update_matches" title="dials.algorithms.refinement.target.Target.update_matches"><tt class="xref py py-obj docutils literal"><span class="pre">update_matches</span></tt></a>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.achieved">
<tt class="descname">achieved</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>return True to terminate the refinement.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.calculate_gradients">
<tt class="descname">calculate_gradients</tt><big>(</big><em>reflections=None</em>, <em>callback=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.calculate_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.calculate_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the prediction_parameterisation object to calculate
gradients for all the matched reflections, or just for those specified</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures">
<tt class="descname">compute_functional_gradients_and_curvatures</tt><big>(</big><em>block=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the value of the target function and its gradients. Set
approximate curvatures as a side-effect</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals">
<tt class="descname">compute_residuals</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their weights</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_residuals_and_gradients">
<tt class="descname">compute_residuals_and_gradients</tt><big>(</big><em>block=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>return the vector of residuals plus their gradients and weights for
non-linear least squares methods</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures">
<tt class="descname">compute_restraints_functional_gradients_and_curvatures</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_functional_gradients_and_curvatures"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_functional_gradients_and_curvatures" title="Permalink to this definition">¶</a></dt>
<dd><p>use the restraints_parameterisation object, if present, to
calculate the least squares restraints objective plus gradients and
approximate curvatures</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients">
<tt class="descname">compute_restraints_residuals_and_gradients</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.compute_restraints_residuals_and_gradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.compute_restraints_residuals_and_gradients" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate to the restraints_parameterisation object, if present, to
calculate the vector of restraints residuals plus their gradients and
weights for non-linear least squares methods</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches">
<tt class="descname">get_num_matches</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_experiment">
<tt class="descname">get_num_matches_for_experiment</tt><big>(</big><em>iexp=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.get_num_matches_for_panel">
<tt class="descname">get_num_matches_for_panel</tt><big>(</big><em>ipanel=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.get_num_matches_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.get_num_matches_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>return the number of reflections currently used in the calculation</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict">
<tt class="descname">predict</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>perform reflection prediction for the working reflections and update the
reflection manager</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_free_reflections">
<tt class="descname">predict_for_free_reflections</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_free_reflections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_free_reflections" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for the reflections not used for refinement</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.predict_for_reflection_table">
<tt class="descname">predict_for_reflection_table</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_names">
<tt class="descname">rmsd_names</tt><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_Phi']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target.Target.rmsd_units">
<tt class="descname">rmsd_units</tt><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds">
<tt class="descname">rmsds</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the matches</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_experiment">
<tt class="descname">rmsds_for_experiment</tt><big>(</big><em>iexp=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_experiment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_experiment" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected experiment.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_panel">
<tt class="descname">rmsds_for_panel</tt><big>(</big><em>ipanel=0</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the selected panel.</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.rmsds_for_reflection_table">
<tt class="descname">rmsds_for_reflection_table</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.rmsds_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.rmsds_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate unweighted RMSDs for the specified reflections. Caution: this
assumes that the table reflections has the keys expected by _rmsds_core</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.set_prediction_parameterisation">
<tt class="descname">set_prediction_parameterisation</tt><big>(</big><em>prediction_parameterisation</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.set_prediction_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.set_prediction_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>For circumstances where the PredictionParameterisation object was not
available at initialisation, set it with this method</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.set_restraints_parameterisation">
<tt class="descname">set_restraints_parameterisation</tt><big>(</big><em>restraints_parameterisation</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.set_restraints_parameterisation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.set_restraints_parameterisation" title="Permalink to this definition">¶</a></dt>
<dd><p>For circumstances where the RestraintsParameterisation object was not
available at initialisation, set it with this method</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.split_matches_into_blocks">
<tt class="descname">split_matches_into_blocks</tt><big>(</big><em>nproc=1</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.split_matches_into_blocks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.split_matches_into_blocks" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of the matches, split into blocks according to the
gradient_calculation_blocksize parameter and the number of processes (if relevant).
The number of blocks will be set such that the total number of reflections
being processed by concurrent processes does not exceed gradient_calculation_blocksize</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target.Target.update_matches">
<tt class="descname">update_matches</tt><big>(</big><em>force=False</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target.html#Target.update_matches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target.Target.update_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>ensure the observations matched to predictions are up to date</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-dials.algorithms.refinement.target_stills"></span><dl class="class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target_stills.</tt><tt class="descname">LeastSquaresStillsResidualWithRmsdCutoff</tt><big>(</big><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.Target" title="dials.algorithms.refinement.target.Target"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.Target</span></tt></a></p>
<p>An implementation of the target class providing a least squares residual
in terms of detector impact position X, Y and minimum rotation to the Ewald
sphere, DeltaPsi. Terminates refinement on achieved rmsd (or on intrisic
convergence of the chosen minimiser)</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved"><tt class="xref py py-obj docutils literal"><span class="pre">achieved</span></tt></a>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></tt>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></tt>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></tt>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></tt>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></tt>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></tt>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></tt>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></tt>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict</span></tt>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></tt>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt></a>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></tt>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></tt>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></tt>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></tt>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></tt>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_matches</span></tt>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved">
<tt class="descname">achieved</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.achieved"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.achieved" title="Permalink to this definition">¶</a></dt>
<dd><p>RMSD criterion for target achieved</p>
</dd></dl>

<dl class="method">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table">
<tt class="descname">predict_for_reflection_table</tt><big>(</big><em>reflections</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.predict_for_reflection_table" title="Permalink to this definition">¶</a></dt>
<dd><p>perform prediction for all reflections in the supplied table</p>
</dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names">
<tt class="descname">rmsd_names</tt><em class="property"> = ['RMSD_X', 'RMSD_Y', 'RMSD_DeltaPsi']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_names" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units">
<tt class="descname">rmsd_units</tt><em class="property"> = ['mm', 'mm', 'rad']</em><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff.rmsd_units" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse">
<em class="property">class </em><tt class="descclassname">dials.algorithms.refinement.target_stills.</tt><tt class="descname">LeastSquaresStillsResidualWithRmsdCutoffSparse</tt><big>(</big><em>experiments</em>, <em>reflection_predictor</em>, <em>ref_man</em>, <em>prediction_parameterisation</em>, <em>restraints_parameterisation</em>, <em>frac_binsize_cutoff=0.33333</em>, <em>absolute_cutoffs=None</em>, <em>gradient_calculation_blocksize=None</em><big>)</big><a class="reference internal" href="../../../_modules/dials/algorithms/refinement/target_stills.html#LeastSquaresStillsResidualWithRmsdCutoffSparse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoffSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dials.algorithms.refinement.target.SparseGradientsMixin" title="dials.algorithms.refinement.target.SparseGradientsMixin"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target.SparseGradientsMixin</span></tt></a>, <a class="reference internal" href="#dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff" title="dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff"><tt class="xref py py-class docutils literal"><span class="pre">dials.algorithms.refinement.target_stills.LeastSquaresStillsResidualWithRmsdCutoff</span></tt></a></p>
<p>A version of the LeastSquaresStillsResidualWithRmsdCutoff Target that
uses a sparse matrix data structure for memory efficiency when there are a
large number of Experiments</p>
<p class="rubric">Methods</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">achieved</span></tt>()</td>
<td>RMSD criterion for target achieved</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">calculate_gradients</span></tt>([reflections,&nbsp;callback])</td>
<td>delegate to the prediction_parameterisation object to calculate</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_functional_gradients_and_curvatures</span></tt>([block])</td>
<td>calculate the value of the target function and its gradients. Set</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals</span></tt>()</td>
<td>return the vector of residuals plus their weights</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_residuals_and_gradients</span></tt>([block])</td>
<td>return the vector of residuals plus their gradients and weights for</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_functional_gradients_and_curvatures</span></tt>()</td>
<td>use the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">compute_restraints_residuals_and_gradients</span></tt>()</td>
<td>delegate to the restraints_parameterisation object, if present, to</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches</span></tt>()</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_experiment</span></tt>([iexp])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">get_num_matches_for_panel</span></tt>([ipanel])</td>
<td>return the number of reflections currently used in the calculation</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict</span></tt>()</td>
<td>perform reflection prediction for the working reflections and update the</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_free_reflections</span></tt>()</td>
<td>perform prediction for the reflections not used for refinement</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">predict_for_reflection_table</span></tt>(reflections)</td>
<td>perform prediction for all reflections in the supplied table</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds</span></tt>()</td>
<td>calculate unweighted RMSDs for the matches</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_experiment</span></tt>([iexp])</td>
<td>calculate unweighted RMSDs for the selected experiment.</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_panel</span></tt>([ipanel])</td>
<td>calculate unweighted RMSDs for the selected panel.</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">rmsds_for_reflection_table</span></tt>(reflections)</td>
<td>calculate unweighted RMSDs for the specified reflections. Caution: this</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_prediction_parameterisation</span></tt>(...)</td>
<td>For circumstances where the PredictionParameterisation object was not</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">set_restraints_parameterisation</span></tt>(...)</td>
<td>For circumstances where the RestraintsParameterisation object was not</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">split_matches_into_blocks</span></tt>([nproc])</td>
<td>Return a list of the matches, split into blocks according to the gradient_calculation_blocksize parameter and the number of processes (if relevant).</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">update_matches</span></tt>([force])</td>
<td>ensure the observations matched to predictions are up to date</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><!--<h3>Navigation</h3>-->
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer container">
  <a href="http://www.diamond.ac.uk/"><img class="logofooter" alt="Diamond" src="../../../_static/diamond_logo.png" /></a>
  <a href="http://www.ccp4.ac.uk/"><img class="logofooter" alt="CCP4" src="../../../_static/CCP4-logo-plain.png" /></a>
  <a href="http://www.lbl.gov/"><img class="logofooter" alt="LBL" src="../../../_static/LBL-logo-wide.jpeg" /></a>
  <a href="https://www.stfc.ac.uk/"><img class="logofooter" alt="STFC" src="../../../_static/STFC_logo.png" /></a>
  </div>

  <script type="text/javascript">
     $(document).ready(function() {
         $(".toggle > *").hide();
         $(".toggle .header").show();
         $(".toggle .header").click(function() {
             $(this).parent().children().not(".header").toggle(400);
             $(this).parent().children(".header").toggleClass("open");
         })
     });
  </script>
  
    <div class="footer">
      &copy;2015, Diamond Light Source, Lawrence Berkeley National Laboratory and STFC.
      
    </div>

    

    

  </body>
</html>